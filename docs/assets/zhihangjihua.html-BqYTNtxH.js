import{_ as p}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as l,c,a as n,d as a,e,b as t}from"./app-qB9_Bjjp.js";const i={},r=n("h2",{id:"概述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#概述"},[n("span",null,"概述")])],-1),u=n("p",null,"每个sql语句都有自己的执行计划，通过explain指令获取执行计划。",-1),d={href:"https://stackoverflow.com/questions/40943835/postgresql-analyse-vs-analyze",target:"_blank",rel:"noopener noreferrer"},k=t(`<h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><p>语法如下</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>nsc<span class="token operator">=</span>## \\<span class="token class-name">h</span> explain<span class="token punctuation">;</span>
Command<span class="token punctuation">:</span>     <span class="token class-name">EXPLAIN</span>
Description<span class="token punctuation">:</span> show the execution plan of a <span class="token class-name">statement</span>
Syntax<span class="token punctuation">:</span>
EXPLAIN <span class="token punctuation">[</span> <span class="token punctuation">(</span> option <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token range operator">..</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">]</span> statement
EXPLAIN <span class="token punctuation">[</span> ANALYZE <span class="token punctuation">]</span> <span class="token punctuation">[</span> <span class="token attribute"><span class="token class-name">VERBOSE</span></span> <span class="token punctuation">]</span> statement
 
<span class="token keyword">where</span> <span class="token class-name">option</span> can be <span class="token class-name">one</span> of<span class="token punctuation">:</span>
 
    ANALYZE <span class="token punctuation">[</span> boolean <span class="token punctuation">]</span>  <span class="token operator">--</span> 是否真正执行，默认<span class="token boolean">false</span>
    VERBOSE <span class="token punctuation">[</span> boolean <span class="token punctuation">]</span>  <span class="token operator">--</span> 是否显示详细信息，默认<span class="token boolean">false</span>
    COSTS <span class="token punctuation">[</span> boolean <span class="token punctuation">]</span>    <span class="token operator">--</span> 是否显示代价信息，默认<span class="token boolean">true</span>
    BUFFERS <span class="token punctuation">[</span> boolean <span class="token punctuation">]</span>  <span class="token operator">--</span> 是否显示缓存信息，默认<span class="token boolean">false</span>，前置事件是analyze
    TIMING <span class="token punctuation">[</span> boolean <span class="token punctuation">]</span>   <span class="token operator">--</span> 是否显示时间信息
    FORMAT <span class="token punctuation">{</span> TEXT <span class="token operator">|</span> XML <span class="token operator">|</span> JSON <span class="token operator">|</span> YAML <span class="token punctuation">}</span>  <span class="token operator">--</span> 输格式，默认为text
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在explain后添加analyze关键字来通过执行这个SQL获得真实的执行计划和执行时间</p><h2 id="结果介绍" tabindex="-1"><a class="header-anchor" href="#结果介绍"><span>结果介绍</span></a></h2><p>执行</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>explain <span class="token keyword">select</span>  <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">.</span>user_info <span class="token keyword">where</span> <span class="token class-name">integral</span><span class="token operator">&gt;</span><span class="token number">500</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Index Scan using user_info_integral_index on user_info (cost=0.29..8.31 rows=1 width=165) 解析：cost=0.29..8.31，前一部分表示启动时间是0.29ms，执行到返回第一行需要的cost值，后面代表总时间是8.31ms。rows表示预测的行数(与实际的记录数可能有出入)。width表示查询结果的所有字段总宽度为165字节。</p><p>actual time中的第一个数字表示返回第一行需要的时间，第二个数字表示执行整个sql花费的时间。loops为该节点循环次数，当loops大于1时，总成本为：actual time * loops</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>explain analyze <span class="token keyword">select</span>  <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">.</span>user_info <span class="token keyword">where</span> <span class="token class-name">integral</span><span class="token operator">&gt;</span><span class="token number">200</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>结果</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>Seq Scan <span class="token keyword">on</span> user_info  <span class="token punctuation">(</span>cost<span class="token operator">=</span><span class="token number">0.00</span><span class="token range operator">..</span><span class="token number">5311.07</span> rows<span class="token operator">=</span><span class="token number">84760</span> width<span class="token operator">=</span><span class="token number">165</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">actual</span> time<span class="token operator">=</span><span class="token number">0.010</span><span class="token range operator">..</span><span class="token number">23.808</span> rows<span class="token operator">=</span><span class="token number">84600</span> loops<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
  Filter<span class="token punctuation">:</span> <span class="token punctuation">(</span>integral <span class="token operator">&gt;</span> <span class="token number">200</span><span class="token punctuation">)</span>
  Rows Removed <span class="token keyword">by</span> Filter<span class="token punctuation">:</span> <span class="token number">56686</span>
<span class="token class-name">Planning</span> Time<span class="token punctuation">:</span> <span class="token number">0.062</span> ms
<span class="token class-name">Execution</span> Time<span class="token punctuation">:</span> <span class="token number">27.366</span> ms
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="关键字注释" tabindex="-1"><a class="header-anchor" href="#关键字注释"><span>关键字注释</span></a></h2><h3 id="表访问方式" tabindex="-1"><a class="header-anchor" href="#表访问方式"><span>表访问方式</span></a></h3><p>Seq Scan：全表扫描 Index Scan：索引扫描 Bitmap Index Scan 位图索引 Index Only Scan：要查询的字段都有索引</p><h3 id="表连接方式" tabindex="-1"><a class="header-anchor" href="#表连接方式"><span>表连接方式</span></a></h3><p>Nested Loop 嵌套循环，适合被连接的数据子集较小的查询 Hash join 适用于数据量大的连接方式 Merge join 归并连接，执行性能差于哈希连接</p><h2 id="运算类型-explain" tabindex="-1"><a class="header-anchor" href="#运算类型-explain"><span>运算类型(explain)</span></a></h2>`,18),h={href:"https://blog.csdn.net/JAVA528416037/article/details/91998019",target:"_blank",rel:"noopener noreferrer"},m=t(`<h2 id="更新统计信息" tabindex="-1"><a class="header-anchor" href="#更新统计信息"><span>更新统计信息</span></a></h2><p>在数据库中，统计信息是规划器生成计划的源数据。没有收集统计信息或者统计信息陈旧往往会造成执行计划严重劣化，从而导致性能问题</p><p>更新统计信息：analyze ANALYZE语句可收集与数据库中表内容相关的统计信息，统计结果存储在系统表PG_STATISTIC中。 查询优化器会使用这些统计数据，以生成最有效的执行计划。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 更新单个表的统计信息</span>
<span class="token keyword">analyze</span> 表名<span class="token punctuation">;</span>

<span class="token comment">-- 更新全库的统计信息</span>
<span class="token keyword">analyze</span> <span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2>`,5),v={href:"https://zhuanlan.zhihu.com/p/99331255",target:"_blank",rel:"noopener noreferrer"},g={href:"https://mp.weixin.qq.com/s/6EPKkRMgVsOcy0-RGRDmUQ",target:"_blank",rel:"noopener noreferrer"};function b(y,f){const s=o("ExternalLinkIcon");return l(),c("div",null,[r,u,n("p",null,[a("analyse 对比 analyze：只是英式英语与美式英语的区别，功能上没有区别，资料："),n("a",d,[a("https://stackoverflow.com/questions/40943835/postgresql-analyse-vs-analyze"),e(s)])]),k,n("p",null,[n("a",h,[a("https://blog.csdn.net/JAVA528416037/article/details/91998019"),e(s)])]),m,n("p",null,[a("各种数据库SQL执行计划："),n("a",v,[a("https://zhuanlan.zhihu.com/p/99331255"),e(s)]),n("a",g,[a("https://mp.weixin.qq.com/s/6EPKkRMgVsOcy0-RGRDmUQ"),e(s)]),a(" | 【干货分享】PostgreSQL-查询执行计划浅析")])])}const z=p(i,[["render",b],["__file","zhihangjihua.html.vue"]]),q=JSON.parse('{"path":"/dataBase/postgresql/zhihangjihua.html","title":"执行计划","lang":"zh-CN","frontmatter":{"title":"执行计划","lang":"zh-CN","date":"2023-08-09T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dataBase"],"tag":["无"],"filename":"zhihangjihua","slug":"gpdl3d","docsId":"66575148","description":"概述 每个sql语句都有自己的执行计划，通过explain指令获取执行计划。 analyse 对比 analyze：只是英式英语与美式英语的区别，功能上没有区别，资料：https://stackoverflow.com/questions/40943835/postgresql-analyse-vs-analyze 使用 语法如下 在explain后添...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dataBase/postgresql/zhihangjihua.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"执行计划"}],["meta",{"property":"og:description","content":"概述 每个sql语句都有自己的执行计划，通过explain指令获取执行计划。 analyse 对比 analyze：只是英式英语与美式英语的区别，功能上没有区别，资料：https://stackoverflow.com/questions/40943835/postgresql-analyse-vs-analyze 使用 语法如下 在explain后添..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-09-23T15:53:24.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-08-09T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-09-23T15:53:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"执行计划\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-08-09T00:00:00.000Z\\",\\"dateModified\\":\\"2023-09-23T15:53:24.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"使用","slug":"使用","link":"#使用","children":[]},{"level":2,"title":"结果介绍","slug":"结果介绍","link":"#结果介绍","children":[]},{"level":2,"title":"关键字注释","slug":"关键字注释","link":"#关键字注释","children":[{"level":3,"title":"表访问方式","slug":"表访问方式","link":"#表访问方式","children":[]},{"level":3,"title":"表连接方式","slug":"表连接方式","link":"#表连接方式","children":[]}]},{"level":2,"title":"运算类型(explain)","slug":"运算类型-explain","link":"#运算类型-explain","children":[]},{"level":2,"title":"更新统计信息","slug":"更新统计信息","link":"#更新统计信息","children":[]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[]}],"git":{"createdTime":1695484404000,"updatedTime":1695484404000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":2.47,"words":741},"filePathRelative":"dataBase/postgresql/zhihangjihua.md","localizedDate":"2023年8月9日","excerpt":"<h2>概述</h2>\\n<p>每个sql语句都有自己的执行计划，通过explain指令获取执行计划。</p>\\n<p>analyse 对比 analyze：只是英式英语与美式英语的区别，功能上没有区别，资料：<a href=\\"https://stackoverflow.com/questions/40943835/postgresql-analyse-vs-analyze\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://stackoverflow.com/questions/40943835/postgresql-analyse-vs-analyze</a></p>","autoDesc":true}');export{z as comp,q as data};
