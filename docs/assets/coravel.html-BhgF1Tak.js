import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as t,o as p,c as o,a as n,d as s,e as c,b as l}from"./app-Bw62I61B.js";const i="/kbms/common/1641912866485-44edfc95-de73-4d44-82f3-d99fabdc9e2f.jpeg",u={},r=n("h2",{id:"介绍",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#介绍"},[n("span",null,"介绍")])],-1),d=n("p",null,"框架轻，使用简单，支持秒级定时任务。Coravel Pro可以连接数据库进行任务调度，Coravel Pro可以支持web可视化，将任务执行情况通过web显示出来。",-1),k={href:"https://github.com/jamesmh/coravel",target:"_blank",rel:"noopener noreferrer"},v=l('<h2 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h2><h3 id="nuget安装" tabindex="-1"><a class="header-anchor" href="#nuget安装"><span>Nuget安装</span></a></h3><p>在调用类库层安装Coravel。 <img src="'+i+`" alt="" loading="lazy"></p><h3 id="依赖注入" tabindex="-1"><a class="header-anchor" href="#依赖注入"><span>依赖注入</span></a></h3><p>在startup.cs中的ConfigureServices方法中进行依赖注入</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>services<span class="token punctuation">.</span><span class="token function">AddScheduler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="配置调度器" tabindex="-1"><a class="header-anchor" href="#配置调度器"><span>配置调度器</span></a></h3><p>在startup.cs中的Configure方法中配置链两个定时任务</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> provider <span class="token operator">=</span> app<span class="token punctuation">.</span>ApplicationServices<span class="token punctuation">;</span>
provider<span class="token punctuation">.</span><span class="token function">UseScheduler</span><span class="token punctuation">(</span>scheduler <span class="token operator">=&gt;</span>
       <span class="token punctuation">{</span>
           scheduler<span class="token punctuation">.</span><span class="token function">Schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Every second during the week.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
           
           <span class="token punctuation">.</span><span class="token function">EverySecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token function">Weekday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  provider<span class="token punctuation">.</span><span class="token function">UseScheduler</span><span class="token punctuation">(</span>scheduler <span class="token operator">=&gt;</span>
  <span class="token punctuation">{</span>
      scheduler<span class="token punctuation">.</span><span class="token function">Schedule</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Every 5 second during the week.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      
      <span class="token punctuation">.</span><span class="token function">EverySeconds</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">Weekday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>任务1每隔1秒打印输出；任务2每隔5秒打印输出，正确。</p><h3 id="cron-表达式" tabindex="-1"><a class="header-anchor" href="#cron-表达式"><span>Cron 表达式</span></a></h3><p>Coravel 支持Cron Expressions，有需要的可以根据应用场景设置Cron表达式</p><ul><li><ul><li><ul><li><ul><li><ul><li><ul><li>run every minute</li></ul></li></ul></li></ul></li></ul></li></ul></li><li>00 13 * * * run at 1:00 pm daily</li><li>00 1,2,3 * * * run at 1:00 pm, 2:00 pm and 3:00 pm daily</li><li>00 1-3 * * * same as above</li><li>00 _/2 _* * run every two hours on the hour</li></ul><h3 id="_3-7其他功能支持" tabindex="-1"><a class="header-anchor" href="#_3-7其他功能支持"><span>3.7其他功能支持</span></a></h3><p>此外，Coravel还支持任务队列，缓存，事件组播，邮件等。任务队列可依据读者使用情况，视情况另起一篇，缓存不建议用此组件，可用Easycache。事件组播亦不建议用此库，可参考 https://www.cnblogs.com/JerryMouseLi/p/11012839.html。邮件亦不建议用此组件。</p><h3 id="_3-8-coravel-pro" tabindex="-1"><a class="header-anchor" href="#_3-8-coravel-pro"><span>3.8 Coravel Pro</span></a></h3><p>Coravel Pro可以连接数据库进行任务调度，Coravel Pro可以支持web可视化，将任务执行情况通过web显示出来。在这里不做详细介绍，有需要的读者可自行研究。</p><h3 id="_4-1-依赖注入自定义类" tabindex="-1"><a class="header-anchor" href="#_4-1-依赖注入自定义类"><span>4.1 依赖注入自定义类</span></a></h3><p>ConfigureServices中对松耦合的类Statistic进行依赖注入</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code> services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddTransient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Statistic<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-2配置调度器" tabindex="-1"><a class="header-anchor" href="#_4-2配置调度器"><span>4.2配置调度器</span></a></h3><p>在startup.cs中的Configure方法中配置自定义松耦合任务</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>    <span class="token class-name"><span class="token keyword">var</span></span> provider <span class="token operator">=</span> app<span class="token punctuation">.</span>ApplicationServices<span class="token punctuation">;</span>
    provider<span class="token punctuation">.</span><span class="token function">UseScheduler</span><span class="token punctuation">(</span>scheduler <span class="token operator">=&gt;</span>
         <span class="token punctuation">{</span>
             scheduler<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Schedule</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Statistic<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">EverySecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">Weekday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-编写松耦合任务的代码" tabindex="-1"><a class="header-anchor" href="#_4-3-编写松耦合任务的代码"><span>4.3 编写松耦合任务的代码</span></a></h3><p>详细说明，见代码注释。</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Coravel<span class="token punctuation">.</span>Invocable</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">IBMS<span class="token punctuation">.</span>Infrastruct<span class="token punctuation">.</span>UoW</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">IBMS<span class="token punctuation">.</span>WEBAPI<span class="token punctuation">.</span>Extension</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Statistic</span><span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IInvocable</span></span>
    <span class="token punctuation">{</span>
        
        <span class="token class-name">UnitOfWork</span> _unitOfWork<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">Statistic</span><span class="token punctuation">(</span><span class="token class-name">UnitOfWork</span> unitOfWork<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _unitOfWork <span class="token operator">=</span> unitOfWork<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">public</span>  <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
           
            <span class="token class-name"><span class="token keyword">var</span></span> IPBoxCount <span class="token operator">=</span> _unitOfWork<span class="token punctuation">.</span>IPBoxRepository<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Every second during the week.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Count:{0}&quot;</span><span class="token punctuation">,</span> IPBoxCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意：1.编写的任务一定要在 Invoke中，这属于固定格式；public async Task Invoke() {}；2. 需要引入以下库:using Coravel.Invocable;</strong></p><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2><p>**原文链接：**https://www.cnblogs.com/JerryMouseLi/p/11012839.htm</p>`,29);function m(h,b){const a=t("ExternalLinkIcon");return p(),o("div",null,[r,d,n("blockquote",null,[n("p",null,[s("GitHub："),n("a",k,[s("https://github.com/jamesmh/coravel"),c(a)])])]),v])}const y=e(u,[["render",m],["__file","coravel.html.vue"]]),_=JSON.parse('{"path":"/middleware/renwudiaodu/coravel.html","title":"Coravel","lang":"zh-CN","frontmatter":{"title":"Coravel","lang":"zh-CN","date":"2022-02-25T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["middleware"],"tag":["无"],"filename":"coravel","slug":"vf8khm","docsId":"64679546","description":"介绍 框架轻，使用简单，支持秒级定时任务。Coravel Pro可以连接数据库进行任务调度，Coravel Pro可以支持web可视化，将任务执行情况通过web显示出来。 GitHub：https://github.com/jamesmh/coravel 操作 Nuget安装 在调用类库层安装Coravel。 依赖注入 在startup.cs中的Con...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/middleware/renwudiaodu/coravel.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"Coravel"}],["meta",{"property":"og:description","content":"介绍 框架轻，使用简单，支持秒级定时任务。Coravel Pro可以连接数据库进行任务调度，Coravel Pro可以支持web可视化，将任务执行情况通过web显示出来。 GitHub：https://github.com/jamesmh/coravel 操作 Nuget安装 在调用类库层安装Coravel。 依赖注入 在startup.cs中的Con..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/common/1641912866485-44edfc95-de73-4d44-82f3-d99fabdc9e2f.jpeg"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-10-19T14:00:28.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2022-02-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-10-19T14:00:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Coravel\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/common/1641912866485-44edfc95-de73-4d44-82f3-d99fabdc9e2f.jpeg\\"],\\"datePublished\\":\\"2022-02-25T00:00:00.000Z\\",\\"dateModified\\":\\"2023-10-19T14:00:28.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"操作","slug":"操作","link":"#操作","children":[{"level":3,"title":"Nuget安装","slug":"nuget安装","link":"#nuget安装","children":[]},{"level":3,"title":"依赖注入","slug":"依赖注入","link":"#依赖注入","children":[]},{"level":3,"title":"配置调度器","slug":"配置调度器","link":"#配置调度器","children":[]},{"level":3,"title":"Cron 表达式","slug":"cron-表达式","link":"#cron-表达式","children":[]},{"level":3,"title":"3.7其他功能支持","slug":"_3-7其他功能支持","link":"#_3-7其他功能支持","children":[]},{"level":3,"title":"3.8 Coravel Pro","slug":"_3-8-coravel-pro","link":"#_3-8-coravel-pro","children":[]},{"level":3,"title":"4.1 依赖注入自定义类","slug":"_4-1-依赖注入自定义类","link":"#_4-1-依赖注入自定义类","children":[]},{"level":3,"title":"4.2配置调度器","slug":"_4-2配置调度器","link":"#_4-2配置调度器","children":[]},{"level":3,"title":"4.3 编写松耦合任务的代码","slug":"_4-3-编写松耦合任务的代码","link":"#_4-3-编写松耦合任务的代码","children":[]}]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[]}],"git":{"createdTime":1697724028000,"updatedTime":1697724028000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":1.94,"words":583},"filePathRelative":"middleware/renwudiaodu/coravel.md","localizedDate":"2022年2月25日","excerpt":"<h2>介绍</h2>\\n<p>框架轻，使用简单，支持秒级定时任务。Coravel Pro可以连接数据库进行任务调度，Coravel Pro可以支持web可视化，将任务执行情况通过web显示出来。</p>\\n<blockquote>\\n<p>GitHub：<a href=\\"https://github.com/jamesmh/coravel\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/jamesmh/coravel</a></p>\\n</blockquote>\\n<h2>操作</h2>\\n<h3>Nuget安装</h3>\\n<p>在调用类库层安装Coravel。\\n<img src=\\"/common/1641912866485-44edfc95-de73-4d44-82f3-d99fabdc9e2f.jpeg\\" alt=\\"\\" loading=\\"lazy\\"></p>","autoDesc":true}');export{y as comp,_ as data};
