import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,d as n}from"./app-41nmD-Ik.js";const e="/kbms/dotnet/image-20240525154328740.png",t="/kbms/dotnet/image-20240526100739950.png",l={},h=n(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>.NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>.NET Aspire 的业务流程旨在通过简化云原生应用的配置和互连管理来增强<strong>本地开发</strong>体验。官方表示并不是用来替代比如K8s等系统。</p></div><p>官方文档：<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview</a></p><h3 id="为什么选择" tabindex="-1"><a class="header-anchor" href="#为什么选择"><span>为什么选择</span></a></h3><p>.NET Aspire 旨在改善生成 .NET 云原生应用的体验。它提供了一组一致的工具和模式，可帮助你构建和运行分布式应用。NET Aspire 旨在帮助您：</p><ul><li>业务流程：Aspire提供了用于运行和连接多项目应用程序以及本地开发环境依赖项的功能。</li><li>组件：Aspire提供了常用服务的Nuget包，具有标准化接口，可以确保它们与应用一致缺无缝连接</li><li>工具：Aspire覆盖了适用于VS和CLI的项目模板</li></ul><p>Aspire的目的是提供一组抽象，用来简化服务发现、环境变量配置和容器配置的设置，无需处理低级实现细节，这些抽象可以确保多个组件和服务之间的设置保持一致，然后在开发期间轻松管理复杂的应用程序。</p><h2 id="运行环境" tabindex="-1"><a class="header-anchor" href="#运行环境"><span>运行环境</span></a></h2><ul><li>.NET 8(强依赖，小于此版本无法运行）</li><li>Aspire的工作负载</li><li>Docker Desktop</li><li>VS 2022 17.10或者更高版本</li></ul><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 确认当前已安装项</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> workload</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 安装Aspire</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> workload</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> aspire</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 更新工作负载</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> workload</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> update</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h2><h3 id="项目模板" tabindex="-1"><a class="header-anchor" href="#项目模板"><span>项目模板</span></a></h3><p>.NET Aspire 应用遵循围绕默认 .NET Aspire 项目模板设计的标准化结构。大多数 .NET Aspire 应用至少有三个项目：</p><ul><li><strong>MyFirstAspireApp</strong>：入门应用，可以是任何常见的 .NET 项目，例如 Blazor UI 或最小 API。当应用扩展时，可以向应用添加更多项目，并使用 <strong>.AppHost</strong> 和 <strong>.ServiceDefaults</strong> 项目。</li><li><strong>MyFirstAspireApp.AppHost</strong>：<strong>.AppHost</strong> 项目用于管理应用的高级业务流程问题。业务流程涉及将应用的各个部分（如 API、服务容器和可执行文件）组合在一起，并设置它们如何相互查找和通信。</li><li><strong>MyFirstAspireApp.ServiceDefaults</strong>：<strong>.ServiceDefaults</strong> 项目包含默认的 .NET Aspire 应用配置，可以根据需要进行扩展和自定义。这些配置包括设置运行状况检查、OpenTelemetry 设置等问题。</li></ul><p>目前有两个 .NET Aspire 入门模板可用于帮助您开始使用此结构：</p><ul><li><strong>.NET Aspire 应用程序</strong>：仅包含 <strong>AspireSample.AppHost</strong> 和 <strong>AspireSample.ServiceDefaults</strong> 项目的基本入门模板。此模板旨在仅提供供您构建的基本要素。</li><li><strong>.NET Aspire 初学者应用程序</strong>：此模板包括 <strong>AspireSample.AppHost</strong> 和 <strong>AspireSample.ServiceDefaults</strong> 项目，但也包括样板 UI 和 API 项目。这些项目预先配置了服务发现和常见 .NET Aspire 功能的其他基本示例。</li></ul><h3 id="快速上手" tabindex="-1"><a class="header-anchor" href="#快速上手"><span>快速上手</span></a></h3><p>使用Vs创建.Net Aspire Starter应用程序，或者使用命令行创建</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dotnet</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> new</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> aspire-starter</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --use-redis-cache</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --output</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> AspireApp1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后在磁盘上就可以看到Aspire项目，项目内容如下</p><ul><li>AspireApp1.ApiService --- Api服务，向前端提供数据。此项目依赖于共享的AspireApp1.ServiceDefaults项目</li><li>AspireApp1.AppHost --- 一个业务流程协调程序，用于连接和配置应用的不同项目和服务，依赖于AspireApp1.ApiService和AspireApp1.Web项目</li><li>AspireApp1.ServiceDefaults ---Aspire共享项目，用于管理解决方案中复原能力、服务发现、遥测、健康检查等跨项目重复使用的配置</li><li>AspireApp1.Web --- 具有默认 .NET Aspire 服务配置的 ASP.NET Core Blazor 应用项目，此项目依赖于共享的AspireApp1.ServiceDefaults项目</li></ul><p>四个目录中，和Aspire关系最密切的项目就是中间的AppHost和ServiceDefaults这两个项目，另外两个项目（ApiService和Web）属于业务性项目。接下来我们分别来说说这两个项目。</p><p><strong>AppHost</strong>：这个项目从名字上我们就不难看出，这是个宿主项目，官方对这个项目的定义是协调器项目，用于协调Aspire项目中的各种资源。从个人在实践过程中的感觉来说，除了官方说的协调各种资源外，他还具备如下职责：</p><ul><li>在开发阶段中，他最重要的职责是，做为Aspire的可视化宿主，也叫Dashboard的启动器。</li><li>在发布阶段，他最重要的职责是，生成可以直接被容器化平台使用的脚本。目前原生支持Azure（毕竟是亲生的），有第三方工具提供了K8s和Docker Compose的支持（ Aspir8）</li></ul><p>**ServiceDefaults：**这个项目，属于公共库，他要被ApiService以及Web这两个业务项目引用，并在Program.cs中调用如下方法：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>builder.AddServiceDefaults();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过这个方法，把Aspire的相关特性，分别注入到两个业务项目中。</p><p>可以在启动docker的情况下，然后将<strong>AspireSample.AppHost</strong>项目设置为启动项目，然后运行应用程序，就可以在Aspire仪表盘上看到下面信息</p><ul><li><p><strong>资源</strong>：列出 .NET Aspire 应用中所有单个 .NET 项目的基本信息，例如应用状态、终结点地址和加载到的环境变量。</p></li><li><p><strong>控制台</strong>：显示应用中每个项目的控制台输出。</p></li><li><p><strong>结构化</strong>：以表格式显示结构化日志。这些日志还支持基本筛选、自由格式搜索和日志级别筛选。您应该会看到<code>apiservice</code> 和 <code>webfrontend</code>的日志。您可以通过选择行右端的**“查看**”按钮来展开每个日志条目的详细信息。</p></li><li><p><strong>跟踪</strong>：显示应用程序的跟踪，这些跟踪可以跟踪通过应用程序的请求路径。找到<strong>对 /weather</strong> 的请求，然后选择页面右侧的**“查看**”。仪表板应分阶段显示请求，因为它在应用的不同部分中传输。</p><p><img src="`+e+`" alt="image-20240525154328740"></p></li><li><p><strong>指标</strong>：显示应用公开的各种仪器和仪表及其相应的尺寸。指标会根据筛选条件的可用维度有条件地公开筛选条件。</p></li></ul><p>一个入门项目示例仓库：<a href="https://github.com/microsoftdocs/mslearn-dotnet-cloudnative-devops" target="_blank" rel="noopener noreferrer">https://github.com/microsoftdocs/mslearn-dotnet-cloudnative-devops</a></p><h3 id="已有项目中使用aspire" tabindex="-1"><a class="header-anchor" href="#已有项目中使用aspire"><span>已有项目中使用Aspire</span></a></h3><p>官方教程：<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/add-aspire-existing-app" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/add-aspire-existing-app</a></p><h2 id="visual-studio工具" tabindex="-1"><a class="header-anchor" href="#visual-studio工具"><span>Visual Studio工具</span></a></h2><p>通过UI界面添加组件包：<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/setup-tooling?tabs=windows&amp;pivots=visual-studio#add-a-component-package" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/setup-tooling?tabs=windows&amp;pivots=visual-studio#add-a-component-package</a></p><h2 id="常用术语" tabindex="-1"><a class="header-anchor" href="#常用术语"><span>常用术语</span></a></h2><h3 id="应用模型" tabindex="-1"><a class="header-anchor" href="#应用模型"><span>应用模型</span></a></h3><p>构成分布式应用程序 （<a href="https://learn.microsoft.com/en-us/dotnet/api/aspire.hosting.distributedapplication" target="_blank" rel="noopener noreferrer">DistributedApplication</a>） 的资源集合。有关更正式的定义，请参阅<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/app-host-overview#define-the-app-model" target="_blank" rel="noopener noreferrer">定义应用模型</a>。</p><h3 id="应用主机项目" tabindex="-1"><a class="header-anchor" href="#应用主机项目"><span>应用主机项目</span></a></h3><p>负责协调<em>应用模型</em>的所有应用程序，比如下面描述了一个具有两个项目和一个Redis缓存的应用程序</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> builder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> DistributedApplication</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CreateBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddRedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> apiservice</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddProject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Projects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AspireApp_ApiService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;apiservice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddProject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Projects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AspireApp_Web</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;webfrontend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithReference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithReference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">apiservice</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Build</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Run</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="资源" tabindex="-1"><a class="header-anchor" href="#资源"><span>资源</span></a></h3><p><a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/app-host-overview#built-in-resource-types" target="_blank" rel="noopener noreferrer">资源</a>表示应用程序的一部分，每个资源必须具有唯一的名称。，无论是 .NET 项目、容器或可执行文件，还是其他一些资源（如数据库、缓存或云服务）（如存储服务）。</p><p>公共资源：<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/app-host-overview#apis-for-adding-and-expressing-resources" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/app-host-overview#apis-for-adding-and-expressing-resources</a></p><h3 id="引用" tabindex="-1"><a class="header-anchor" href="#引用"><span>引用</span></a></h3><p>引用定义资源之间的连接，表示为依赖关系，比如</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddRedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddProject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Projects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AspireApp_Web</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;webfrontend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithReference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>“webfrontend”项目资源使用 WithReference 添加对“缓存”容器资源的依赖项。这些依赖项可以表示连接字符串或服务发现信息。在前面的示例中，将环境变量注入到名为 的“webfronend”资源中。此环境变量包含一个连接字符串，webfrontend 可以使用该字符串通过 .NET Aspire Redis 组件连接到 redis，例如 . <code>ConnectionStrings__cache</code> <code>ConnectionStrings__cache=&quot;localhost:62354&quot;</code></p><h4 id="终结点引用" tabindex="-1"><a class="header-anchor" href="#终结点引用"><span>终结点引用</span></a></h4><p>项目资源之间也可能存在依赖关系，比如下面代码</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> cache</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddRedis</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;cache&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> apiservice</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddProject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Projects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AspireApp_ApiService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;apiservice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddProject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Projects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AspireApp_Web</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;webfrontend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithReference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">cache</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">       .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithReference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">apiservice</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>项目到项目的引用是注入支持服务发现的环境变量</p><table><thead><tr><th style="text-align:left;">Method</th><th style="text-align:left;">Environment variable 环境变量</th></tr></thead><tbody><tr><td style="text-align:left;"><code>WithReference(cache)</code></td><td style="text-align:left;"><code>ConnectionStrings__cache=&quot;localhost:62354&quot;</code></td></tr><tr><td style="text-align:left;"><code>WithReference(apiservice)</code></td><td style="text-align:left;"><code>services__apiservice__http__0=&quot;http://localhost:5455&quot;</code> <code>services__apiservice__https__0=&quot;https://localhost:7356&quot;</code></td></tr></tbody></table><p>添加对“apiservice”项目的引用会导致将服务发现环境变量添加到前端。这是因为通常，项目到项目的通信是通过 HTTP/gRPC 进行的。</p><p>可以使用 WithEndpoint 并调用 GetEndpoint 从容器或可执行文件中获取特定终结点：</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> customContainer</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;myapp&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mycustomcontainer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                             .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithHttpEndpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">9043</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;endpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> endpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> customContainer</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">GetEndpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;endpoint&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> apiservice</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">AddProject</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Projects</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">AspireApp_ApiService</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;apiservice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WithReference</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">endpoint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">Method</th><th style="text-align:left;">Environment variable 环境变量</th></tr></thead><tbody><tr><td style="text-align:left;"><code>WithReference(endpoint)</code></td><td style="text-align:left;"><code>services__myapp__endpoint__0=https://localhost:9043</code></td></tr></tbody></table><p>该参数是容器正在侦听的端口。</p><h2 id="dashboard仪表盘" tabindex="-1"><a class="header-anchor" href="#dashboard仪表盘"><span>Dashboard仪表盘</span></a></h2><p>一个中心化的应用监控面板，，可以显示服务信息以及服务日志、指标和追踪信息。</p><p>使用教程：<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/dashboard/explore" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/dashboard/explore</a></p><p><img src="`+t+`" alt="image-20240526100739950"></p><p>该仪表盘界面将开发的时候所有诊断数据汇集在一起，可以方便我们进行故障排查</p><h3 id="独立部署" tabindex="-1"><a class="header-anchor" href="#独立部署"><span>独立部署</span></a></h3><p>独立部署仪表盘：<a href="https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/dashboard/standalone" target="_blank" rel="noopener noreferrer">https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/dashboard/standalone</a></p><p>通过下面内容可以部署出来一个支持日志、跟踪、指标的Dashboard</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">services</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  aspire_dashboard</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># aspire 可观测面板  登录界面的密码去容器内拷贝</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    image</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">mcr.microsoft.com/dotnet/nightly/aspire-dashboard:8.0.0-preview.6</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    container_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">aspire_dashboard</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">TZ=Asia/Shanghai</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DASHBOARD__OTLP__AUTHMODE=ApiKey</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 认证模式</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">DASHBOARD__OTLP__PRIMARYAPIKEY=rVmuMdaqCEruWEbKANjmcIQMnKIhDiLUYSFHaZAVlMktmwDhMUAPIZyfizmoLuSwAePPVhhPigpJUIsAsPZcwfmaMnBxxRuxatrrHNSOKUxUVGFlYQtGtbqtOPasMvPd</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 密钥</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;18888:18888&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;4317:18889&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="serilog对接" tabindex="-1"><a class="header-anchor" href="#serilog对接"><span>Serilog对接</span></a></h3><p>将日志输出到支持OTLP协议Aspire中展示，安装nuget包</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">ItemGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Include</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Serilog.AspNetCore&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;8.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Include</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Serilog.Sinks.Async&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;1.5.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Include</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Serilog.Sinks.OpenTelemetry&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;3.0.0-dev-00298&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">PackageReference</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Include</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Swashbuckle.AspNetCore&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#D19A66;"> Version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;6.4.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">ItemGroup</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例代码如下</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Host</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">UseSerilog</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">hbc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">lc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> logLevel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LogEventLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Error</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hbc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HostingEnvironment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">IsDevelopment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        logLevel</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> LogEventLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Information</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">    lc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ReadFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hbc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Configuration</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MinimumLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Override</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Microsoft&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">MinimumLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Override</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;System&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">logLevel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Enrich</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FromLogContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      .</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">WriteTo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Async</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">wt</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">          if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">hbc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">HostingEnvironment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">IsDevelopment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">              wt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Debug</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">          wt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">theme</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">AnsiConsoleTheme</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">          wt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">OpenTelemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">c</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">              c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Protocol</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> OtlpProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Grpc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">              c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Endpoint</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;http://localhost:4317&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">              c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Headers</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Dictionary</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                              [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;x-otlp-api-key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                  &quot;rVmuMdaqCEruWEbKANjmcIQMnKIhDiLUYSFHaZAVlMktmwDhMUAPIZyfizmoLuSwAePPVhhPigpJUIsAsPZcwfmaMnBxxRuxatrrHNSOKUxUVGFlYQtGtbqtOPasMvPd&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                          };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">              c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ResourceAttributes</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Dictionary</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">object</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                     {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                         [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;service.name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> builder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Environment</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ApplicationName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;service.version&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;1.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">                                     };</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">          });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="组件" tabindex="-1"><a class="header-anchor" href="#组件"><span>组件</span></a></h2><p>组件信息：<a href="">https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/components-overview?tabs=dotnet-cli</a>https://learn.microsoft.com/zh-cn/dotnet/aspire/fundamentals/components-overview?tabs=dotnet-cli</p><p>组件必须执行以下操作才能被视为可以使用：</p><ol><li>提供详细的架构化配置。</li><li>设置运行状况检查以跟踪和响应远程服务运行状况。</li><li>提供默认的、可配置的复原模式（重试、超时等），以最大限度地提高可用性。</li><li>提供集成的日志记录、指标和跟踪，使组件可观察。</li></ol><h2 id="部署" tabindex="-1"><a class="header-anchor" href="#部署"><span>部署</span></a></h2><p><a href="https://www.bilibili.com/video/BV1CN4y1m7gR?spm_id_from=333.1245.0.0" target="_blank" rel="noopener noreferrer">如何部署 .NET 8 的新 .NET Aspire 栈</a></p><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2><p><a href="https://www.bilibili.com/video/BV19a4y167Fr?spm_id_from=333.1245.0.0" target="_blank" rel="noopener noreferrer">在 .NET 中正确测量和可视化度量指标</a></p><h3 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h3><p>快速入门：构建您的第一个 .NET Aspire 应用程序https://www.cnblogs.com/powertoolsteam/p/17835864.html</p><p>.NET Aspire 的系列文章：https://qiita.com/takashiuesaka/items/137cb1450c3d9fbc8d1e</p><p>https://haacked.com/archive/2024/07/01/dotnet-aspire-vs-docker/比较使用 .NET Aspire 和 Docker 配置 .NET 项目和 PostgreSQL 的步骤。</p>`,85),p=[h];function k(r,d){return a(),i("div",null,p)}const c=s(l,[["render",k],["__file","dotNetAspire.html.vue"]]),B=JSON.parse('{"path":"/dotnet/dotNetAspire.html","title":".NET Aspire","lang":"zh-CN","frontmatter":{"title":".NET Aspire","lang":"zh-CN","date":"2023-11-25T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dotNET"],"tag":["aspire"],"description":"概述 .NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。 提示 .NET Aspire 的业务流程旨在通过简化云原生应用的配置和互连管理来增强本地开发体验。官方表示并不是用来替代比如K8s等系统。 官方文档：https://learn.microsoft.com/zh-cn/dotnet/aspire/get-sta...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dotnet/dotNetAspire.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":".NET Aspire"}],["meta",{"property":"og:description","content":"概述 .NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。 提示 .NET Aspire 的业务流程旨在通过简化云原生应用的配置和互连管理来增强本地开发体验。官方表示并不是用来替代比如K8s等系统。 官方文档：https://learn.microsoft.com/zh-cn/dotnet/aspire/get-sta..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/dotnet/image-20240525154328740.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-11T14:36:00.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"aspire"}],["meta",{"property":"article:published_time","content":"2023-11-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-11T14:36:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\".NET Aspire\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/dotnet/image-20240525154328740.png\\",\\"https://azrng.gitee.io/kbms/kbms/dotnet/image-20240526100739950.png\\"],\\"datePublished\\":\\"2023-11-25T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-11T14:36:00.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[{"level":3,"title":"为什么选择","slug":"为什么选择","link":"#为什么选择","children":[]}]},{"level":2,"title":"运行环境","slug":"运行环境","link":"#运行环境","children":[]},{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"操作","slug":"操作","link":"#操作","children":[{"level":3,"title":"项目模板","slug":"项目模板","link":"#项目模板","children":[]},{"level":3,"title":"快速上手","slug":"快速上手","link":"#快速上手","children":[]},{"level":3,"title":"已有项目中使用Aspire","slug":"已有项目中使用aspire","link":"#已有项目中使用aspire","children":[]}]},{"level":2,"title":"Visual Studio工具","slug":"visual-studio工具","link":"#visual-studio工具","children":[]},{"level":2,"title":"常用术语","slug":"常用术语","link":"#常用术语","children":[{"level":3,"title":"应用模型","slug":"应用模型","link":"#应用模型","children":[]},{"level":3,"title":"应用主机项目","slug":"应用主机项目","link":"#应用主机项目","children":[]},{"level":3,"title":"资源","slug":"资源","link":"#资源","children":[]},{"level":3,"title":"引用","slug":"引用","link":"#引用","children":[{"level":4,"title":"终结点引用","slug":"终结点引用","link":"#终结点引用","children":[]}]}]},{"level":2,"title":"Dashboard仪表盘","slug":"dashboard仪表盘","link":"#dashboard仪表盘","children":[{"level":3,"title":"独立部署","slug":"独立部署","link":"#独立部署","children":[]},{"level":3,"title":"Serilog对接","slug":"serilog对接","link":"#serilog对接","children":[]}]},{"level":2,"title":"组件","slug":"组件","link":"#组件","children":[]},{"level":2,"title":"部署","slug":"部署","link":"#部署","children":[]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[{"level":3,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}]}],"git":{"createdTime":1700920704000,"updatedTime":1723386960000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":12},{"name":"zhangyunpeng","email":"zhang.yunpeng@synyi.com","commits":2}]},"readingTime":{"minutes":8.95,"words":2686},"filePathRelative":"dotnet/dotNetAspire.md","localizedDate":"2023年11月25日","excerpt":"<h2>概述</h2>\\n<p>.NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。</p>\\n<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">提示</p>\\n<p>.NET Aspire 的业务流程旨在通过简化云原生应用的配置和互连管理来增强<strong>本地开发</strong>体验。官方表示并不是用来替代比如K8s等系统。</p>\\n</div>\\n<p>官方文档：<a href=\\"https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview</a></p>","autoDesc":true}');export{c as comp,B as data};
