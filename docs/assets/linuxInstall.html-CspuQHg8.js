import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as t,b as a}from"./app-qB9_Bjjp.js";const n="/kbms/common/9eb6bceb-0dca-463d-a20f-729ce879a038.png",i="/kbms/common/93c80018-ff7f-4471-9721-5eafdc0fbe70.png",r="/kbms/common/a1359e6e-5a18-4217-b255-2b9b1afde853.png",l="/kbms/common/f0755bce-2950-46ea-8261-5938478673e9.png",d="/kbms/common/aa575bfb-58d1-407e-a43d-9de0b10f10b3.png",o={},c=a(`<h2 id="sql-server-2022-安装" tabindex="-1"><a class="header-anchor" href="#sql-server-2022-安装"><span>SQL Server 2022 安装</span></a></h2><div class="hint-container tip"><p class="hint-container-title">提示</p><p>数据库选择SQL Server 2022，系统选择Ubuntu 20.04</p><p>文档地址：SQL Server 2022文档地址：https://learn.microsoft.com/zh-cn/sql/sql-server/?view=sql-server-ver16</p></div><p>SQL Server 2022先决条件：服务器内存至少需要2 GB 。</p><p><strong>1、导入公共存储库 GPG 密钥</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>$ <span class="token function">wget</span> -qO- https://packages.microsoft.com/keys/microsoft.asc <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /etc/apt/trusted.gpg.d/microsoft.asc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>2、注册 SQL Server Ubuntu 存储库</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> add-apt-repository <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">wget</span> -qO- https://packages.microsoft.com/config/ubuntu/20.04/mssql-server-2022.list<span class="token variable">)</span></span>&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>3、运行以下命令以安装 SQL Server</strong></p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> updatesudo <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> mssql-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>4、等待安装完成后，运行 mssql-conf setup</strong></p><p>按照提示选择数据库版本及设置 SA 密码。其中数据库版本Evaluation、Developer 和 Express 版为免费版本。</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">sudo</span> /opt/mssql/bin/mssql-conf setup
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：SA 账户密码需要最小长度为 8 个字符，包括大写和小写字母、十进制数字和/或非字母数字符号。</p><p>此时如果正常，那恭喜您！但我尝试了好几次，都卡在了这里，系统提示：error while loading shared libraries: liblber-2.4.so.2</p><figure><img src="`+n+`" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>网上查了一堆资料，最终找到了解决办法：</p><p>下载安装libldap-2.4-2_2.4.47+dfsg.4-1+eagle_amd64包</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>wget https://community-packages.deepin.com/deepin/pool/main/o/openldap/libldap-2.4-2_2.4.47%2Bdfsg.4-1%2Beagle_amd64.debsudo dpkg -i libldap-2.4-2_2.4.47+dfsg.4-1+eagle_amd64.deb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次运行 mssql-conf setup，继续设置，再次遇到问题，系统提示：error while loading shared libraries: libssl1.1，解决办法：</p><p>下载安装libssl1.1_1.1.1-1ubuntu2.1~18.04.23_amd64包</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>wget http://security.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1-1ubuntu2.1~18.04.23_amd64.debsudo dpkg -i libssl1.1_1.1.1-1ubuntu2.1~18.04.23_amd64.deb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>最后运行 mssql-conf setup，完成设置，没再报错。</p><p>5、验证服务是否正常运行</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>systemctl status mssql-server --no-pager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+i+`" alt="图片" loading="lazy">此时SQL Server 已在 Ubuntu 上正常运行。</p><p><strong>6、打开 SQL Server TCP 端口（默认值为 1433）</strong></p><p>开启内网远程访问，我们使用的是腾讯云，需要设置安全组，内网放行1433端口。</p><h2 id="sql-server-2022-配置" tabindex="-1"><a class="header-anchor" href="#sql-server-2022-配置"><span><strong>SQL Server 2022 配置</strong></span></a></h2><p>SQL Server 数据库安装完成后，还需要进行一些常规配置。</p><p><strong>1、启用 SQL Server 代理</strong></p><p>为了进行日常数据备份等任务，我们需要开启代理：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>sudo /opt/mssql/bin/mssql-conf set sqlagent.enabled true//重启服务生效sudo systemctl restart mssql-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>2、更改默认数据或日志目录位置</strong></p><p>使用 filelocation.defaultdatadir 和 filelocation.defaultlogdir 设置可更改创建新数据库和日志文件的位置。默认路径为：/var/opt/mssql/data。可以使用以下步骤进行修改：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>//为新的数据库数据和日志文件创建目标目录sudo mkdir /home/d/mssql/data
//将目录的所有者和组更改为 mssql 用户sudo chown mssql  /home/d/mssql/datasudo chgrp mssql  /home/d/mssql/data
//使用 mssql-conf 通过 set 命令更改默认数据目录sudo /opt/mssql/bin/mssql-conf set filelocation.defaultdatadir /home/d/mssql/data
//使用 mssql-conf 通过 set 命令更改默认日志文件目录sudo /opt/mssql/bin/mssql-conf set filelocation.defaultlogdir /home/d/mssql/data
//重启服务生效sudo systemctl restart mssql-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3、更改生成备份文件的默认位置</strong></p><p>使用 filelocation.defaultbackupdir 设置可更改生成备份文件位置。默认路径为：/var/opt/mssql/data。可以使用以下步骤进行修改：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>//为新的备份文件创建目标目录sudo mkdir /home/d/mssql/bak/ -p
//将目录的所有者和组更改为 mssql 用户sudo chown mssql /home/d/mssql/backupsudo chgrp mssql /home/d/mssql/backup
//使用 mssql-conf 通过 set 命令更改默认备份目录sudo /opt/mssql/bin/mssql-conf set filelocation.defaultbackupdir /home/d/mssql/backup
//重启 SQL Server 服务sudo systemctl restart mssql-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更多配置请查看文档：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>https://learn.microsoft.com/zh-cn/sql/linux/sql-server-linux-configure-mssql-conf?view=sql-server-ver16
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>4、设置数据库自动备份</strong></p><p>备份是保护数据的唯一方法，为了防止数据丢失和保障业务的持续性，需要对数据进行备份。这里采用的方案是按天进行完整备份，按小时进行差异备份，在还原数据时，只需要选择完全备份和差异备份集，打上勾后进行还原即可。</p><p><strong>完整备份</strong>是指备份整个数据库，包括表、索引、视图和存储过程等所有数据库对象，完整备份所需时间较长，占用空间也最多，但恢复数据时只需还原单个文件，因此最为简单和快速。</p><p><strong>差异备份</strong>是针对上一次完全备份来说的，它只备份自上次完全备份之后发生更改的数据。因此，差异备份比完全备份小，还原也比完全备份快且对性能影响最小。</p><p>我使用 SQL Server 代理中提供的作业来执行计划，新建两个作业，一个执行完整备份任务，一个执行差异备份任务。如下图所示</p><figure><img src="`+r+'" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>首先、设置作业的步骤，我们可以在步骤中添加执行备份任务的脚本。</p><figure><img src="'+l+'" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>然后、设置作业计划，指定脚本执行的时间周期及间隔。</p><figure><img src="'+d+`" alt="图片" tabindex="0" loading="lazy"><figcaption>图片</figcaption></figure><p>这样就可以了，以上为演示截图。</p><p>SQL Server 完整备份脚本：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>DECLARE @Path NVARCHAR(50) = &#39;/home/d/mssql/bak/test_&#39;;SET @Path= CONCAT(@Path,CONVERT(NVARCHAR(10),GETDATE() ,120),&#39;.bak&#39;);

BACKUP DATABASE test  TO DISK = @Path  WITH FORMAT;  GO
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这段脚本的功能是将名为 test 的数据库备份到指定路径下的文件，备份文件的路径是 /home/d/mssql/bak/test_YYYYMMDD.bak，其中 YYYYMMDD 是当前日期的形式。执行备份时，会覆盖原有备份文件，重新备份。</p><p>SQL Server 差异备份脚本：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>DECLARE @Path NVARCHAR(50) = &#39;/home/d/mssql/bak/test_&#39;;SET @Path= CONCAT(@Path,CONVERT(NVARCHAR(10),GETDATE() ,120),&#39;.bak&#39;);
BACKUP DATABASE test  TO DISK = @Path  WITH DIFFERENTIAL;  GO
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>这段代码的功能是在 test 数据库上一次完整备份的基础上，进行差异备份，通过 TO DISK = @Path 指定完整备份路径。执行备份时，SQL Server 会把差异备份的文件追加到有备份文件中。</p><p>在脚本中使用 EXPIREDATE 指令可以设置备份的过期日期，当备份文件超出指定的备份的过期日期时，SQL Server 将清除备份集中满足日期束缚的备份作业。例如：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>DECLARE @Path NVARCHAR(50) = &#39;/home/d/mssql/bak/test_&#39;;SET @Path= CONCAT(@Path,CONVERT(NVARCHAR(10),GETDATE() ,120),&#39;.bak&#39;);
DECLARE @ExpiryTime  DATETIME2(7)=DATEADD(mm, 1, GETDATE());
BACKUP DATABASE test  TO DISK = @Path  WITH  EXPIREDATE =@ExpiryTime;GO
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同时在脚本中使用 COMPRESSION 指令可设置备份文件自动压缩，还可以指定压缩的算法。例如：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>//参考文档：https://learn.microsoft.com/zh-cn/sql/relational-databases/integrated-acceleration/use-integrated-acceleration-and-offloading?view=sql-server-ver15
//使用默认MS_XPRESS压缩选项WITH COMPRESSION (ALGORITHM = MS_XPRESS);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>SQL Server 数据库的备份和还原文档：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>https://learn.microsoft.com/zh-cn/sql/relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases?view=sql-server-ver16
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Linux 上的 SQL Server 的性能最佳做法和配置指南：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>https://learn.microsoft.com/zh-cn/sql/linux/sql-server-linux-performance-best-practices?view=sql-server-linux-ver16
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h2><p>探索SQL Server 2022在Ubuntu 20.04上的安装、配置、备份与常见问题：https://mp.weixin.qq.com/s/68zSJ9CSl2V8XvG6-VGDMg</p>`,67),p=[c];function m(u,v){return s(),t("div",null,p)}const h=e(o,[["render",m],["__file","linuxInstall.html.vue"]]),f=JSON.parse('{"path":"/dataBase/sqlserver/install/linuxInstall.html","title":"Linux安装sqlserver","lang":"zh-CN","frontmatter":{"title":"Linux安装sqlserver","lang":"zh-CN","date":"2023-08-06T00:00:00.000Z","publish":true,"author":"惑豁猿","isOriginal":false,"category":["soft"],"tag":["sqlserver"],"filename":"sqlserverInstall","docsId":"6fd45f90-068e-422f-8b7a-8789a3271451","description":"SQL Server 2022 安装 提示 数据库选择SQL Server 2022，系统选择Ubuntu 20.04 文档地址：SQL Server 2022文档地址：https://learn.microsoft.com/zh-cn/sql/sql-server/?view=sql-server-ver16 SQL Server 2022先决条件：...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dataBase/sqlserver/install/linuxInstall.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"Linux安装sqlserver"}],["meta",{"property":"og:description","content":"SQL Server 2022 安装 提示 数据库选择SQL Server 2022，系统选择Ubuntu 20.04 文档地址：SQL Server 2022文档地址：https://learn.microsoft.com/zh-cn/sql/sql-server/?view=sql-server-ver16 SQL Server 2022先决条件：..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/common/9eb6bceb-0dca-463d-a20f-729ce879a038.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-09-24T09:09:34.000Z"}],["meta",{"property":"article:author","content":"惑豁猿"}],["meta",{"property":"article:tag","content":"sqlserver"}],["meta",{"property":"article:published_time","content":"2023-08-06T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-09-24T09:09:34.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux安装sqlserver\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/common/9eb6bceb-0dca-463d-a20f-729ce879a038.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/93c80018-ff7f-4471-9721-5eafdc0fbe70.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/a1359e6e-5a18-4217-b255-2b9b1afde853.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/f0755bce-2950-46ea-8261-5938478673e9.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/aa575bfb-58d1-407e-a43d-9de0b10f10b3.png\\"],\\"datePublished\\":\\"2023-08-06T00:00:00.000Z\\",\\"dateModified\\":\\"2023-09-24T09:09:34.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"惑豁猿\\"}]}"]]},"headers":[{"level":2,"title":"SQL Server 2022 安装","slug":"sql-server-2022-安装","link":"#sql-server-2022-安装","children":[]},{"level":2,"title":"SQL Server 2022 配置","slug":"sql-server-2022-配置","link":"#sql-server-2022-配置","children":[]},{"level":2,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}],"git":{"createdTime":1691299184000,"updatedTime":1695546574000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":5.59,"words":1676},"filePathRelative":"dataBase/sqlserver/install/linuxInstall.md","localizedDate":"2023年8月6日","excerpt":"<h2>SQL Server 2022 安装</h2>\\n<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">提示</p>\\n<p>数据库选择SQL Server 2022，系统选择Ubuntu 20.04</p>\\n<p>文档地址：SQL Server 2022文档地址：https://learn.microsoft.com/zh-cn/sql/sql-server/?view=sql-server-ver16</p>\\n</div>\\n<p>SQL Server 2022先决条件：服务器内存至少需要2 GB 。</p>\\n<p><strong>1、导入公共存储库 GPG 密钥</strong></p>","autoDesc":true}');export{h as comp,f as data};
