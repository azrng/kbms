import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as n,c as a,d as e}from"./app-CBxp4zeL.js";const t={},p=e(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>脚本默认备份全库，也可以备份某个表，可以设置保留周期，结果压缩，将备份结果发送邮件通知。</p><h2 id="内容" tabindex="-1"><a class="header-anchor" href="#内容"><span>内容</span></a></h2><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code>
<span class="token comment">#!/bin/bash</span>

<span class="token comment">## 数据表名称，可以为空</span>
table_name<span class="token operator">=</span>$<span class="token number">1</span>

<span class="token comment">## 数据库名称</span>
database_name<span class="token operator">=</span>test_data
<span class="token comment">## 备份周期，单位为天</span>
backup_period<span class="token operator">=</span><span class="token number">30</span>
<span class="token comment">## 备份目录</span>
backup_dir<span class="token operator">=</span><span class="token operator">/</span>date<span class="token operator">/</span>mysql<span class="token operator">/</span>backup
<span class="token comment">## 邮箱地址</span>
email_address<span class="token operator">=</span>xxxxx@mail<span class="token punctuation">.</span>qq
<span class="token comment">## MySQL账号</span>
mysql_user<span class="token operator">=</span>root
<span class="token comment">## MySQL密码</span>
mysql_password<span class="token operator">=</span>root1234

<span class="token comment">## 获取当前日期</span>
date_str<span class="token operator">=</span>\`date <span class="token operator">+</span><span class="token operator">%</span>Y<span class="token operator">-</span><span class="token operator">%</span>m<span class="token operator">-</span><span class="token operator">%</span>d\`

<span class="token comment">## 备份文件名</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span>z <span class="token string">&quot;$table_name&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> then
    backup_file_name<span class="token operator">=</span><span class="token string">&quot;\${database_name}_\${date_str}.sql&quot;</span>
<span class="token keyword">else</span>
    backup_file_name<span class="token operator">=</span><span class="token string">&quot;\${database_name}_\${table_name}_\${date_str}.sql&quot;</span>
fi

<span class="token comment">## 压缩后备份文件名</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span>z <span class="token string">&quot;$table_name&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> then
    compressed_backup_file_name<span class="token operator">=</span><span class="token string">&quot;\${database_name}_\${date_str}.tar.gz&quot;</span>
<span class="token keyword">else</span>
    compressed_backup_file_name<span class="token operator">=</span><span class="token string">&quot;\${database_name}_\${table_name}_\${date_str}.tar.gz&quot;</span>
fi

<span class="token comment">## 备份文件路径</span>
backup_file_path<span class="token operator">=</span><span class="token string">&quot;\${backup_dir}/\${backup_file_name}&quot;</span>

<span class="token comment">## 压缩后备份文件路径</span>
compressed_backup_file_path<span class="token operator">=</span><span class="token string">&quot;\${backup_dir}/\${compressed_backup_file_name}&quot;</span>

<span class="token comment">## 检查备份目录是否存在，如果不存在则创建</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> ! <span class="token operator">-</span>d <span class="token string">&quot;$backup_dir&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> then
    mkdir <span class="token operator">-</span>p <span class="token string">&quot;$backup_dir&quot;</span>
fi

<span class="token comment">## 备份MySQL数据表</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span>z <span class="token string">&quot;$table_name&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> then
    mysqldump <span class="token operator">-</span><span class="token string">u&quot;$mysql_user&quot;</span> <span class="token operator">-</span>p<span class="token string">&quot;$mysql_password&quot;</span> <span class="token string">&quot;$database_name&quot;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;$backup_file_path&quot;</span>
<span class="token keyword">else</span>
    mysqldump <span class="token operator">-</span><span class="token string">u&quot;$mysql_user&quot;</span> <span class="token operator">-</span>p<span class="token string">&quot;$mysql_password&quot;</span> <span class="token string">&quot;$database_name&quot;</span> <span class="token string">&quot;$table_name&quot;</span> <span class="token operator">&gt;</span> <span class="token string">&quot;$backup_file_path&quot;</span>
fi

<span class="token comment">## 压缩备份文件</span>
tar <span class="token operator">-</span>czvf <span class="token string">&quot;$compressed_backup_file_path&quot;</span> <span class="token string">&quot;$backup_file_path&quot;</span>

<span class="token comment">## 删除备份文件</span>
rm <span class="token operator">-</span>f <span class="token string">&quot;$backup_file_path&quot;</span>

<span class="token comment">## 检查备份结果</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span>f <span class="token string">&quot;$compressed_backup_file_path&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> then
    echo <span class="token string">&quot;备份成功！&quot;</span>
    echo <span class="token string">&quot;备份文件路径：$compressed_backup_file_path&quot;</span>
    subject<span class="token operator">=</span><span class="token string">&quot;MySQL备份成功&quot;</span>
    body<span class="token operator">=</span><span class="token string">&quot;MySQL备份成功，备份文件路径：$compressed_backup_file_path&quot;</span>
<span class="token keyword">else</span>
    echo <span class="token string">&quot;备份失败！&quot;</span>
    subject<span class="token operator">=</span><span class="token string">&quot;MySQL备份失败&quot;</span>
    body<span class="token operator">=</span><span class="token string">&quot;MySQL备份失败！&quot;</span>
fi

<span class="token comment">## 发送备份结果到指定邮箱</span>
echo <span class="token string">&quot;$body&quot;</span> <span class="token operator">|</span> mail <span class="token operator">-</span>s <span class="token string">&quot;$subject&quot;</span> <span class="token string">&quot;$email_address&quot;</span>

<span class="token comment">## 删除过期备份文件</span>
find <span class="token string">&quot;$backup_dir&quot;</span> <span class="token operator">-</span>mtime <span class="token operator">+</span><span class="token string">&quot;$backup_period&quot;</span> <span class="token operator">-</span>name <span class="token string">&quot;*.tar.gz&quot;</span> <span class="token operator">-</span><span class="token keyword">exec</span> rm <span class="token punctuation">{</span><span class="token punctuation">}</span> \\<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行示例</p><div class="language-python line-numbers-mode" data-ext="py" data-title="py"><pre class="language-python"><code><span class="token comment">#默认备份整库</span>
<span class="token punctuation">.</span><span class="token operator">/</span>mysql_back<span class="token punctuation">.</span>sh
<span class="token comment">#备份test_table_name表</span>
<span class="token punctuation">.</span><span class="token operator">/</span>mysql_back<span class="token punctuation">.</span>sh test_table_name  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6),o=[p];function c(l,i){return n(),a("div",null,o)}const k=s(t,[["render",c],["__file","mysqlbeifenjiaoben.html.vue"]]),d=JSON.parse('{"path":"/dataBase/mysql/jiaoben/mysqlbeifenjiaoben.html","title":"MySQL备份脚本","lang":"zh-CN","frontmatter":{"title":"MySQL备份脚本","lang":"zh-CN","date":"2023-02-27T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dataBase"],"tag":["无"],"filename":"mysqlbeifenjiaoben","slug":"qt6gbnn483gtqi6r","docsId":"115947937","description":"概述 脚本默认备份全库，也可以备份某个表，可以设置保留周期，结果压缩，将备份结果发送邮件通知。 内容 执行示例","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dataBase/mysql/jiaoben/mysqlbeifenjiaoben.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"MySQL备份脚本"}],["meta",{"property":"og:description","content":"概述 脚本默认备份全库，也可以备份某个表，可以设置保留周期，结果压缩，将备份结果发送邮件通知。 内容 执行示例"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-09-23T15:53:24.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-02-27T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-09-23T15:53:24.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL备份脚本\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-02-27T00:00:00.000Z\\",\\"dateModified\\":\\"2023-09-23T15:53:24.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"内容","slug":"内容","link":"#内容","children":[]}],"git":{"createdTime":1695484404000,"updatedTime":1695484404000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":1.3,"words":391},"filePathRelative":"dataBase/mysql/jiaoben/mysqlbeifenjiaoben.md","localizedDate":"2023年2月27日","excerpt":"<h2>概述</h2>\\n<p>脚本默认备份全库，也可以备份某个表，可以设置保留周期，结果压缩，将备份结果发送邮件通知。</p>\\n<h2>内容</h2>\\n<div class=\\"language-python\\" data-ext=\\"py\\" data-title=\\"py\\"><pre class=\\"language-python\\"><code>\\n<span class=\\"token comment\\">#!/bin/bash</span>\\n\\n<span class=\\"token comment\\">## 数据表名称，可以为空</span>\\ntable_name<span class=\\"token operator\\">=</span>$<span class=\\"token number\\">1</span>\\n\\n<span class=\\"token comment\\">## 数据库名称</span>\\ndatabase_name<span class=\\"token operator\\">=</span>test_data\\n<span class=\\"token comment\\">## 备份周期，单位为天</span>\\nbackup_period<span class=\\"token operator\\">=</span><span class=\\"token number\\">30</span>\\n<span class=\\"token comment\\">## 备份目录</span>\\nbackup_dir<span class=\\"token operator\\">=</span><span class=\\"token operator\\">/</span>date<span class=\\"token operator\\">/</span>mysql<span class=\\"token operator\\">/</span>backup\\n<span class=\\"token comment\\">## 邮箱地址</span>\\nemail_address<span class=\\"token operator\\">=</span>xxxxx@mail<span class=\\"token punctuation\\">.</span>qq\\n<span class=\\"token comment\\">## MySQL账号</span>\\nmysql_user<span class=\\"token operator\\">=</span>root\\n<span class=\\"token comment\\">## MySQL密码</span>\\nmysql_password<span class=\\"token operator\\">=</span>root1234\\n\\n<span class=\\"token comment\\">## 获取当前日期</span>\\ndate_str<span class=\\"token operator\\">=</span>`date <span class=\\"token operator\\">+</span><span class=\\"token operator\\">%</span>Y<span class=\\"token operator\\">-</span><span class=\\"token operator\\">%</span>m<span class=\\"token operator\\">-</span><span class=\\"token operator\\">%</span>d`\\n\\n<span class=\\"token comment\\">## 备份文件名</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token operator\\">-</span>z <span class=\\"token string\\">\\"$table_name\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span> then\\n    backup_file_name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"${database_name}_${date_str}.sql\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n    backup_file_name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"${database_name}_${table_name}_${date_str}.sql\\"</span>\\nfi\\n\\n<span class=\\"token comment\\">## 压缩后备份文件名</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token operator\\">-</span>z <span class=\\"token string\\">\\"$table_name\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span> then\\n    compressed_backup_file_name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"${database_name}_${date_str}.tar.gz\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n    compressed_backup_file_name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"${database_name}_${table_name}_${date_str}.tar.gz\\"</span>\\nfi\\n\\n<span class=\\"token comment\\">## 备份文件路径</span>\\nbackup_file_path<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"${backup_dir}/${backup_file_name}\\"</span>\\n\\n<span class=\\"token comment\\">## 压缩后备份文件路径</span>\\ncompressed_backup_file_path<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"${backup_dir}/${compressed_backup_file_name}\\"</span>\\n\\n<span class=\\"token comment\\">## 检查备份目录是否存在，如果不存在则创建</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> ! <span class=\\"token operator\\">-</span>d <span class=\\"token string\\">\\"$backup_dir\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span> then\\n    mkdir <span class=\\"token operator\\">-</span>p <span class=\\"token string\\">\\"$backup_dir\\"</span>\\nfi\\n\\n<span class=\\"token comment\\">## 备份MySQL数据表</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token operator\\">-</span>z <span class=\\"token string\\">\\"$table_name\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span> then\\n    mysqldump <span class=\\"token operator\\">-</span><span class=\\"token string\\">u\\"$mysql_user\\"</span> <span class=\\"token operator\\">-</span>p<span class=\\"token string\\">\\"$mysql_password\\"</span> <span class=\\"token string\\">\\"$database_name\\"</span> <span class=\\"token operator\\">&gt;</span> <span class=\\"token string\\">\\"$backup_file_path\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n    mysqldump <span class=\\"token operator\\">-</span><span class=\\"token string\\">u\\"$mysql_user\\"</span> <span class=\\"token operator\\">-</span>p<span class=\\"token string\\">\\"$mysql_password\\"</span> <span class=\\"token string\\">\\"$database_name\\"</span> <span class=\\"token string\\">\\"$table_name\\"</span> <span class=\\"token operator\\">&gt;</span> <span class=\\"token string\\">\\"$backup_file_path\\"</span>\\nfi\\n\\n<span class=\\"token comment\\">## 压缩备份文件</span>\\ntar <span class=\\"token operator\\">-</span>czvf <span class=\\"token string\\">\\"$compressed_backup_file_path\\"</span> <span class=\\"token string\\">\\"$backup_file_path\\"</span>\\n\\n<span class=\\"token comment\\">## 删除备份文件</span>\\nrm <span class=\\"token operator\\">-</span>f <span class=\\"token string\\">\\"$backup_file_path\\"</span>\\n\\n<span class=\\"token comment\\">## 检查备份结果</span>\\n<span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">[</span> <span class=\\"token operator\\">-</span>f <span class=\\"token string\\">\\"$compressed_backup_file_path\\"</span> <span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">;</span> then\\n    echo <span class=\\"token string\\">\\"备份成功！\\"</span>\\n    echo <span class=\\"token string\\">\\"备份文件路径：$compressed_backup_file_path\\"</span>\\n    subject<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"MySQL备份成功\\"</span>\\n    body<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"MySQL备份成功，备份文件路径：$compressed_backup_file_path\\"</span>\\n<span class=\\"token keyword\\">else</span>\\n    echo <span class=\\"token string\\">\\"备份失败！\\"</span>\\n    subject<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"MySQL备份失败\\"</span>\\n    body<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"MySQL备份失败！\\"</span>\\nfi\\n\\n<span class=\\"token comment\\">## 发送备份结果到指定邮箱</span>\\necho <span class=\\"token string\\">\\"$body\\"</span> <span class=\\"token operator\\">|</span> mail <span class=\\"token operator\\">-</span>s <span class=\\"token string\\">\\"$subject\\"</span> <span class=\\"token string\\">\\"$email_address\\"</span>\\n\\n<span class=\\"token comment\\">## 删除过期备份文件</span>\\nfind <span class=\\"token string\\">\\"$backup_dir\\"</span> <span class=\\"token operator\\">-</span>mtime <span class=\\"token operator\\">+</span><span class=\\"token string\\">\\"$backup_period\\"</span> <span class=\\"token operator\\">-</span>name <span class=\\"token string\\">\\"*.tar.gz\\"</span> <span class=\\"token operator\\">-</span><span class=\\"token keyword\\">exec</span> rm <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span> \\\\<span class=\\"token punctuation\\">;</span>\\n</code></pre></div>","autoDesc":true}');export{k as comp,d as data};
