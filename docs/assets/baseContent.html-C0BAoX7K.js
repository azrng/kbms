import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,d as n}from"./app-S-drW72G.js";const l={},h=n(`<div class="hint-container tip"><p class="hint-container-title">提示</p><p>遇到数据库关键字需要加双引号，比如select &quot;model_id&quot; from meta_data.model</p></div><h2 id="基本操作" tabindex="-1"><a class="header-anchor" href="#基本操作"><span>基本操作</span></a></h2><h3 id="程序连接" tabindex="-1"><a class="header-anchor" href="#程序连接"><span>程序连接</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># .Net连接数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">host</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">localhost</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">port</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">5432</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">database</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">username</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">123456</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Maximum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Size=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># jdbc连接数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">jdbc:postgresql://localhost:5432/azrng?user</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">=postgres</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据库等操作" tabindex="-1"><a class="header-anchor" href="#数据库等操作"><span>数据库等操作</span></a></h2><h3 id="表" tabindex="-1"><a class="header-anchor" href="#表"><span>表</span></a></h3><h4 id="创建表" tabindex="-1"><a class="header-anchor" href="#创建表"><span>创建表</span></a></h4><p>创建表并且授予所有者，创建注释</p><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 如果不存在就创建</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> exists</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> search.userinfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	id serial</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">		constraint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> userinfo_pk</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">			primary key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 主键自增</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> text </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 创建表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> search.userinfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	id serial</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">		constraint</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> userinfo_pk</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">			primary key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> text </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">default</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> not</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> null</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 添加注释</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">comment</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> on</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> search.userinfo </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;用户表&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">comment</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> on</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> column</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> search.userinfo.id </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;主键&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">comment</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> on</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> column</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> search.userinfo.</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;姓名&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 授权</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> search.userinfo </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  OWNER TO </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;postgres&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="添加列" tabindex="-1"><a class="header-anchor" href="#添加列"><span>添加列</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> config.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;SqlConfig&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;TableName&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 添加列</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">comment on column config.&quot;SqlConfig&quot;.&quot;TableName&quot; is </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;表名&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">--设置备注</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 添加列并且设置默认值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">alter</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> table</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> other</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">blood_transfusion_record</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> blood_apply_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> not null</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 添加列如果列不存在就添加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> checks</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">ecg_report</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> column  </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> link_show_type </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当一个列之前不是自增，现在修改为自定模式，那么需要创建队列并设置队列的值为当前表最大值，然后将主键设置为自增</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 创建序列</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SEQUENCE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> osp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.system_dictionary_id_seq;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 重置序列的当前值为表中的最大 id 值</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> setval(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;osp.system_dictionary_id_seq&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> MAX</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(id) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> osp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">system_dictionary</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 将序列与主键列关联</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> osp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">system_dictionary</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ALTER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> COLUMN id </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> nextval(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;osp.system_dictionary_id_seq&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="添加数据" tabindex="-1"><a class="header-anchor" href="#添加数据"><span>添加数据</span></a></h4><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INSERT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INTO</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;user&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.userinfo(id, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, status) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;1&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;张三&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 批量添加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INSERT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> into</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> other.blood_apply_test_details(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,blood_apply_id)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> patient_name,blood_apply_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  other.blood_apply </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> patient_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">716</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> visit_id</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">100182490</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 要插入的SQL中code数据不存在就添加，存在就不添加，注意，该code列需要是唯一索引的列</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INSERT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> public.operation_log (id, code, content, create_time, version) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;version&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;none&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, now(), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;3.10.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> CONFLICT (code) DO NOTHING;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 添加的时候如果存在就更新，该code列需要是唯一索引的列</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INSERT</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> public.operation_log (id, code, content, create_time, version) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">default</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;version&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;none&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, now(), </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;3.10.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> CONFLICT (code) DO </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">update</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> content</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;v3.10.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="批量添加数据" tabindex="-1"><a class="header-anchor" href="#批量添加数据"><span>批量添加数据</span></a></h4><p>通过pgsql copy的方式批量添加数据</p><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- FROM STDIN (FORMAT BINARY): 指定数据来源为标准输入，并且数据格式为二进制。这意味着你需要将二进制数据提供给 COPY 命令</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">COPY cda.document_generation_log (task_batch_number,document_type,document_serial_number,generation_status,error_message,created_time) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> STDIN (FORMAT BINARY)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>资料：<a href="http://postgres.cn/docs/12/sql-copy.html" target="_blank" rel="noopener noreferrer">http://postgres.cn/docs/12/sql-copy.html</a></p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> stopwatch</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Stopwatch</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">StartNew</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> list</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> GetUserList</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">$&quot;构造数据:{</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">list</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Count</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}  结束：{</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">stopwatch</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ElapsedMilliseconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}  &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> using</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> db</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> OpenDbContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> using</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> dbConnect</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">NpgsqlConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">db</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">GetDbConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">dbConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">State</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ConnectionState</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Closed</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> dbConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">OpenAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">await</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> using</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> copyImport</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> dbConnect</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">BeginBinaryImportAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    &quot;COPY sample.</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">user</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> (id,account, pass_word, name, sex, credit, group_id, deleted, create_time, modify_time) FROM STDIN (FORMAT BINARY)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> list</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">StartRowAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Account</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">PassWord</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Sex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Credit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">GroupId</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Deleted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CreateTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NpgsqlTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NpgsqlDbType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ModifyTime</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NpgsqlTypes</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">NpgsqlDbType</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> num</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> copyImport</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CompleteAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Console</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WriteLine</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">$&quot;插入成功 数据量：{</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">num</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="更新数据" tabindex="-1"><a class="header-anchor" href="#更新数据"><span>更新数据</span></a></h4><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> 查询一个表</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">closed_loop_relation</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">的数据去更新另一个表</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">closed_loop_process_copy1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">的数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">closed_loop_process_copy1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> clp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">set</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> parent_node_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">clr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">main_process_code</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">closed_loop_relation</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> clr</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> clr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sub_process_code</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> clp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">process_code</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> t1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">SET</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> column1</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">columnname1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    column2</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">columnname2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> columnname1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">columnname2</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">t2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">column3</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> t2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">column3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AND</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> t1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">column</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;111&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>特殊的列</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 更新bytea类型数据</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> platform</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_config</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">  set</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> desc_html</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">E</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;我是测试数据&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;traceSource_sql_parser_config&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="批量更新" tabindex="-1"><a class="header-anchor" href="#批量更新"><span>批量更新</span></a></h4><ul><li>使用<a href="https://www.postgresql.org/docs/10/sql-insert.html#SQL-ON-CONFLICT" target="_blank" rel="noopener noreferrer">ON CONFLICT </a> 进行添加冲突后进行更新</li><li>使用Values List更新部分列</li><li>使用临时表去批量更新(创建一个临时表，插入临时表，然后通过表链接去更新，然后删除临时表)</li></ul><h4 id="删除数据" tabindex="-1"><a class="header-anchor" href="#删除数据"><span>删除数据</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- DELETE 命令用于逐行删除表中的数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">DELETE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- TRUNCATE 命令将删除表中的所有行，并重置自增主键（如果有）。它比 DELETE 命令更快，因为它是通过释放存储空间来实现的，而不是逐行删除</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">truncate</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> dr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">drug_info_1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="序列" tabindex="-1"><a class="header-anchor" href="#序列"><span>序列</span></a></h4><p>更新序列的值</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-- 查询序列值(查询的时候会递增)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">select nextval(&#39;cr.record_folder_info_id_seq&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-- 更新序列的值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">alter sequence 队列名 restart with </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1058</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-- 示例</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">alter sequence cr.record_folder_info_id_seq restart with </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">142</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-- 设置序列为表最大的主键值</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">SELECT setval(&#39;osp.system_dictionary_id_seq&#39;, (SELECT MAX(id) FROM osp.system_dictionary));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="提前获取序列值" tabindex="-1"><a class="header-anchor" href="#提前获取序列值"><span>提前获取序列值</span></a></h5><div class="language-c# line-numbers-mode" data-highlighter="shiki" data-ext="c#" data-title="c#" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Task</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;&gt; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">TakeIdsAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> sqls</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> Enumerable</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Range</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;select nextval(&#39;meta_data.model_struct_id_seq&#39;)&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> sql</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> string</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot; union &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sqls</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> ret</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> _dbContext</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">Database</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">GetDbConnection</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">QueryAsync</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">sql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> queue</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> Queue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	foreach</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> ret</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">OrderBy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">x</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> x</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	{</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">		queue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Enqueue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> queue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="索引" tabindex="-1"><a class="header-anchor" href="#索引"><span>索引</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 创建索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> index</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> request_log_module_index</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">on</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">request_log</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (module);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 联合索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> unique index</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> chart_review_config_key_version_number_uindex</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">on</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">chart_review_config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> asc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, version_number </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 删除索引</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> index</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">chart_review_config_key_uindex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 存在删除，不存在跳过</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">trace_source_target_config_name_uindex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 部分索引</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- https://www.postgresql.org/docs/16/indexes-partial.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模糊查询走索引</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> EXTENSION pg_bigm;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 支持  &#39;%张三%&#39;  走索引查询</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> lab_report_report_name_index</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> lab_report </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> gin (report_name </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">public</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">gin_bigm_ops</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>pg_bigm文档：<a href="http://pgbigm.osdn.jp/pg_bigm_en-1-2.html" target="_blank" rel="noopener noreferrer">http://pgbigm.osdn.jp/pg_bigm_en-1-2.html</a></p><p>重建索引 下面解释下说明情况下需要： 1、 当由于软件bug或者硬件原因导致的索引不再可用，索引的数据不再可用； 2、 当索引包含许多空的或者近似于空的页，这个在b-tree索引会发生。Reindex会腾出空间释放哪些无用的页(页就是存放数据的一个单位，类似于block)。 3、 PostgreSql数据库系统修改了存储参数，需要重建不然就会失效(如修改了fillfactor参数)； 4、 创建并发索引时失败，遗留了一个失效的索引。这样的索引不会被使用，但重构后能用。一个索引的重构不能并发的执行。</p><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- REINDEX { INDEX | TABLE | DATABASE | SYSTEM } name [ FORCE ];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 重建指定索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">reindex index my_index;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 重建指定表的所有索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">REINDEX </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> my_table;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 重建指定数据库的所有索引</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">REINDEX DATABASE broken_db;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">--  SYSTEM 重构这个系统的索引包含当前的数据库。共享系统中的索引页是被包含的，但是用户自己的表是不处理的，同样也不能在一个事务块中执行。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重建索引不同的级别的重构需要不同的权限，比如table那么就需要有这个表的权限即需要有操作索引的权限，如超级用户postgres拥有这个权限。</li><li>重构索引的目的是为了当索引的数据不可信时，即对于成本的计算会出现偏差较大，无益于优化器得到最优的执行计划以至于性能优化失败。</li><li>重构索引类似于先删除所有再创建一个索引，但是索引的条目是重新开始的。重构时当前索引是不能写的，因为此时有排他锁。</li><li>在8,1版本之前REINDEX DATABASE 只包含系统索引，并不是期望的所有指定数据库的索引。7.4版本之前REINDEX TABLE不会自动执行下级TOAST tables</li></ul><p>视图创建索引 PostgreSQL的视图（View）可以像表一样创建索引。当在视图上执行查询时，PostgreSQL会使用该视图的索引来加速查询。但请注意，与表不同，视图本身并不存储数据，因此视图索引仅存储对基础表的引用，并且可能受到基础表中数据更改的影响。 在创建视图时，可以使用CREATE INDEX语句为其添加索引，就像在表上创建索引一样。例如：</p><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> VIEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> myview </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> mytable </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">WHERE</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> column</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;value&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> INDEX myview_index </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">ON</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> myview (column1, column2);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>这将在myview视图上创建名为myview_index的索引，以加速满足WHERE语句中条件的查询。</p><h4 id="约束" tabindex="-1"><a class="header-anchor" href="#约束"><span>约束</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 创建唯一约束(对key和version_number)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">create</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> unique index</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> chart_review_config_key_version_number_uindex</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	on</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">chart_review_config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> desc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, version_number </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 删除约束</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">drop</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> index</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> cr</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">chart_review_config_key_uindex</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>不能直接更新，如果要修改需要删除之前的然后添加新的约束</p></blockquote><h2 id="系统表操作" tabindex="-1"><a class="header-anchor" href="#系统表操作"><span>系统表操作</span></a></h2><h3 id="监控程序活动" tabindex="-1"><a class="header-anchor" href="#监控程序活动"><span>监控程序活动</span></a></h3><p>pg_stat_activity 是 PostgreSQL 内置的一个系统视图， 是 PostgreSQL 实例维护的一个进程相关的视图，是实时变化的。</p><p>关于该表的字段说明可以查看：https://www.cnblogs.com/zhuminghui/p/14421501.html</p><p>查询慢SQL可以执行下面sql</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_stat_activity </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&lt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;idle&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">query_start </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> interval </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;5 s&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> order by</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> query_start;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查询连接字符串中应用名查询该应用活动信息</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pg_stat_activity</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> application_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> like</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;fss%&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>需要在原来的SQL最后拼接东西，如连接字符串中拼接<code>Application Name=app1</code>,或者使用下面c#代码拼接</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">var</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> conStrBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> NpgsqlConnectionStringBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">connectionString</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">conStrBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">ApplicationName</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> appName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取表分区下表" tabindex="-1"><a class="header-anchor" href="#获取表分区下表"><span>获取表分区下表</span></a></h3><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">tables</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> where</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> table_catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;zyp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="查询指定表备注" tabindex="-1"><a class="header-anchor" href="#查询指定表备注"><span>查询指定表备注</span></a></h3><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> relname</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> tabname</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">cast</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">obj_description</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">oid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,&#39;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">pg_class</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&#39;) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> varchar</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> comment</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pg_class</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">where</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">  relname</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;表名字&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="结构查询" tabindex="-1"><a class="header-anchor" href="#结构查询"><span>结构查询</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>-- 查询指定数据库下是否存在某一个schema</span></span>
<span class="line"><span>SELECT count(1) FROM information_schema.schemata where catalog_name=&#39;cdr&#39; and schema_name=&#39;meta_data&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="获取表结构信息" tabindex="-1"><a class="header-anchor" href="#获取表结构信息"><span>获取表结构信息</span></a></h3><p>根据schema和表名称获取表结构信息</p><div class="language-c# line-numbers-mode" data-highlighter="shiki" data-ext="c#" data-title="c#" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> distinct</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> column_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ColName</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    character_maximum_length</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> Length</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    ordinal_position</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> Sort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    udt_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SubLength</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    data_type</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ColType</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    from</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">columns</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    where</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;patient_master_info&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> Your</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    and</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table_schema</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;patient&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">col</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">  --</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> Your</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> here</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">    inner</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> join</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">SELECT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> distinct</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> col_description(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">attrelid</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">attnum</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> Comment,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">    a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">attname</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> name,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">    a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">attnotnull</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> Is_Null,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    (case</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    when (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">select</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> count</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">from</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> pg_constraint</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> conrelid </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> a</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">attrelid</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> conkey</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">attnum</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> contype</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;p&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)&gt;0 then a.attname</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    else &#39;&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    end) as pkName</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    FROM pg_class as c,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    pg_attribute as a</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    where c.relname = &#39;patient_master_info&#39; -- Your table name here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    and c.relnamespace = (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">SELECT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> oid</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> FROM</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> pg_namespace</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> WHERE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> nspname</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;patient&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) -- Your schema name here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    and a.attrelid = c.oid</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    and a.attnum &gt; 0) colInfo</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">on colInfo.name = col.ColName</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">order by Sort;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查询数据库指定schema下每个表的数据量</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  schemaname, relname tableName, n_live_tup </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_stat_user_tables </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> schemaname </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;user&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="磁盘统计" tabindex="-1"><a class="header-anchor" href="#磁盘统计"><span>磁盘统计</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 计算某一个表某一个列的存储量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">SUM</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(pg_column_size(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;config_code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)))  CSIZE </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> meta_data</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">meta_config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema, table_name,  column_name ColName,pg_column_size(table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  column_name)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">columns</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;department&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  -- Your table name here</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;sample&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 查询指定数据库指定schema下所有表的存储量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog,table_schema,table_name ,pg_total_relation_size(table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">tables</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;consoletest&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;sample&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog,table_schema,table_name ,pg_table_size(table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">tables</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;consoletest&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;sample&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog,table_schema,table_name ,pg_total_relation_size(  table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.&quot;&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">tables</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;cdr&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;meta_data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 获取指定数据库的大小</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog,</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(pg_total_relation_size(table_catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_schema </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">||</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;.&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name) ) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> total_size</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">FROM</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> information_schema</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">tables</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;consoletest&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_name</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;__EFMigrationsHistory&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">group by</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> table_catalog;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 查询数据库的大小</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_database_size(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;consoletest&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 求每个表下的记录数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 方案一：类似于批量count</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> schemaname, tablename, (xpath(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;/row/cnt/text()&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, xml_count))</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">[1]</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">::</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> row_count</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> schemaname,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">             tablename,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">             query_to_xml(</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">format</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;select count(1) as cnt from %I.%I&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, schemaname, tablename), false, true,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                          &#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> xml_count</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_tables</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">      where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> schemaname </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;blog&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> count;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 方案二：不太准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> schemaname, relname tableName, n_live_tup count</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_stat_user_tables;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 方案三：不太准</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> relname </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> TABLE_NAME, reltuples </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> rowCounts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_class</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> relkind </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;r&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  and</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> relnamespace </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> oid</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> pg_namespace </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> nspname </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;blog&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">order by</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> rowCounts </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">desc</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="进阶" tabindex="-1"><a class="header-anchor" href="#进阶"><span>进阶</span></a></h2><h3 id="视图" tabindex="-1"><a class="header-anchor" href="#视图"><span>视图</span></a></h3><p>视图(VIEW)是一个伪表。 它不是物理表，而是作为普通表选择查询。视图也可以表示连接的表。 它可以包含表的所有行或来自一个或多个表的所选行。 <strong>视图便于用户执行以下操作</strong>：</p><ul><li>它以自然和直观的方式构建数据，并使其易于查找。</li><li>它限制对数据的访问，使得用户只能看到有限的数据而不是完整的数据。</li><li>它归总来自各种表中的数据以生成报告。</li></ul><p>语法 可以使用CREATE VIEW语句来在PostgreSQL中创建视图。 您可以从单个表，多个表以及另一个视图创建它。</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TEMP</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TEMPORARY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">VIEW</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> view_name</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">SELECT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> column1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">column2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.....  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">FROM</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> table_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">WHERE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">condition</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">];</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例 从sqlconfig表创建一个视图(该视图属于config表分区)，此视图将包含querycolumn,sqlcode,tablename,alias这几个列</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> REPLACE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> VIEW</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sqlconfig_view</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> as</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">select</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">  querycolumn</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">sqlcode</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">tablename</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">alias</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> from</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;">sqlconfig</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>从视图中检索带条件的数据</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">select</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sqlconfig_view</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> where</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> alias</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;x&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>删除视图</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 语法</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> DROP</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> VIEW</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> view_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">drop</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> view</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">sqlconfig_view</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="临时表" tabindex="-1"><a class="header-anchor" href="#临时表"><span>临时表</span></a></h3><p>一、根据原表创建临时表</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TEMP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> temp_testbulkcopy</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (select * </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">from</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> testbulkcopy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> limit 0);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>二、本次使用完临时表后自动删除</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TEMP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> temp_testbulkcopy</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> COMMIT</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> DROP</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> as</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (select * </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">from</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> testbulkcopy</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> limit 0);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ON COMMIT DROP 表示本次事务提交后就自动删掉</p><h3 id="触发器" tabindex="-1"><a class="header-anchor" href="#触发器"><span>触发器</span></a></h3><p>一般格式</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> trigger_name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">before</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">after</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">instead</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> of</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] [</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> insert</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> delete</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table_name</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> each [row | statement]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">execute [function | procedure] function_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>举例创建触发器当更新system_config表的value列的时候触发</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TRIGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> IF</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> EXISTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;trigger_AddSystemConfigFlow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> sample1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_config</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> FUNCTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> IF</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sample1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;func_addSystemConfigFlow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> REPLACE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> FUNCTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sample1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;func_addSystemConfigFlow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">RETURNS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">BODY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">BEGIN</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">        INSERT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> sample1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">system_config_history</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">update_user_id</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">update_time</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        VALUES</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">value</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">version</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CURRENT_TIMESTAMP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">    RETURN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">BODY</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">LANGUAGE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> plpgsql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TRIGGER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;trigger_AddSystemConfigFlow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AFTER</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OF</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> sample1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_config</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> EACH</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ROW</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">EXECUTE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> sample1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;func_addSystemConfigFlow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>增加创建更新一个表就让另一个表插入备份数据的触发器脚本</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">创建备份表</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">（</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">只需更新chart_review_config_bk表名即可</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> as</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> select</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> from</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Alter</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> column</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> operation</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Alter</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> column</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> operation_time</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> timestamp</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Alter</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> column</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> user_name</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">Alter</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> table</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> add</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> column</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;"> old_content</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> text</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">创建备份trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> （</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">只需更新cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 表名即可</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> REPLACE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> FUNCTION</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">system_dictionary_log_audit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">RETURNS</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TRIGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    BEGIN</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">        --</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 在</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> log_audit</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 中创建日志来记录操作</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> ，</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">        --</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 使用特殊变量</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TG_OP</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 来得到操作</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TG_OP</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;DELETE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">THEN</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            INSERT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TG_OP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">            RETURN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        ELSIF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TG_OP</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;UPDATE&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">THEN</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            INSERT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TG_OP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">row_to_json</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">OLD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">            RETURN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        ELSIF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TG_OP</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;INSERT&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">THEN</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">            INSERT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INTO</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">TG_OP</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">            RETURN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> NEW</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">        END</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> IF</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">        RETURN</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 因为这是一个</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> AFTER</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> 触发器</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">，</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">结果被忽略</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">system_dictionary_bk</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$ </span><span style="--shiki-light:#6F42C1;--shiki-dark:#E5C07B;">LANGUAGE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#E06C75;"> plpgsql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">--</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">表关联触发器</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">（</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">只需更新system_dictionary_bk表名即可</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> TRIGGER</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> system_dictionary_audit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">AFTER</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSERT</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> UPDATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> OR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> DELETE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">system_dictionary</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">    FOR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> EACH</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> ROW</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> EXECUTE</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> PROCEDURE</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> cda</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">system_dictionary_log_audit</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="函数" tabindex="-1"><a class="header-anchor" href="#函数"><span>函数</span></a></h3><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">OR</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> REPLACE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">] FUNCTION function_name (arguments)   </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">RETURNS return_datatype </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $variable_name$  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  DECLARE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    declaration;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    [...]  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  BEGIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> function_body </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 函数逻辑 &gt;  </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    [...]  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    RETURN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> { variable_name | value }  </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">  LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> plpgsql;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">---------------------------------------------------------</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> FUNCTION function_name(p1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, p2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> RETURNS </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;"> AS</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">BEGIN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> -- 函数逻辑</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">END</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">LANGUAGE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> language_name;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建简单函数例子</p><div class="language-plsql line-numbers-mode" data-highlighter="shiki" data-ext="plsql" data-title="plsql" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">CREATE OR REPLACE</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> FUNCTION </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(a </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">INTEGER</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">, b NUMERIC)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">RETURNS NUMERIC </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">AS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $$</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">	SELECT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> a</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">b;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">$$</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">LANGUAGE</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> SQL</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">-- 调用方法</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  public.</span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,99),k=[h];function t(e,p){return a(),i("div",null,k)}const g=s(l,[["render",t],["__file","baseContent.html.vue"]]),B=JSON.parse('{"path":"/dataBase/postgresql/baseContent.html","title":"基础知识","lang":"zh-CN","frontmatter":{"title":"基础知识","lang":"zh-CN","date":"2023-09-01T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dataBase"],"tag":["base"],"description":"提示 遇到数据库关键字需要加双引号，比如select \\"model_id\\" from meta_data.model 基本操作 程序连接 数据库等操作 表 创建表 创建表并且授予所有者，创建注释 添加列 当一个列之前不是自增，现在修改为自定模式，那么需要创建队列并设置队列的值为当前表最大值，然后将主键设置为自增 添加数据 批量添加数据 通过pgsql ...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dataBase/postgresql/baseContent.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"基础知识"}],["meta",{"property":"og:description","content":"提示 遇到数据库关键字需要加双引号，比如select \\"model_id\\" from meta_data.model 基本操作 程序连接 数据库等操作 表 创建表 创建表并且授予所有者，创建注释 添加列 当一个列之前不是自增，现在修改为自定模式，那么需要创建队列并设置队列的值为当前表最大值，然后将主键设置为自增 添加数据 批量添加数据 通过pgsql ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-26T14:54:00.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"base"}],["meta",{"property":"article:published_time","content":"2023-09-01T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-26T14:54:00.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"基础知识\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-09-01T00:00:00.000Z\\",\\"dateModified\\":\\"2024-08-26T14:54:00.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"基本操作","slug":"基本操作","link":"#基本操作","children":[{"level":3,"title":"程序连接","slug":"程序连接","link":"#程序连接","children":[]}]},{"level":2,"title":"数据库等操作","slug":"数据库等操作","link":"#数据库等操作","children":[{"level":3,"title":"表","slug":"表","link":"#表","children":[{"level":4,"title":"创建表","slug":"创建表","link":"#创建表","children":[]},{"level":4,"title":"添加列","slug":"添加列","link":"#添加列","children":[]},{"level":4,"title":"添加数据","slug":"添加数据","link":"#添加数据","children":[]},{"level":4,"title":"批量添加数据","slug":"批量添加数据","link":"#批量添加数据","children":[]},{"level":4,"title":"更新数据","slug":"更新数据","link":"#更新数据","children":[]},{"level":4,"title":"批量更新","slug":"批量更新","link":"#批量更新","children":[]},{"level":4,"title":"删除数据","slug":"删除数据","link":"#删除数据","children":[]},{"level":4,"title":"序列","slug":"序列","link":"#序列","children":[{"level":5,"title":"提前获取序列值","slug":"提前获取序列值","link":"#提前获取序列值","children":[]}]},{"level":4,"title":"索引","slug":"索引","link":"#索引","children":[]},{"level":4,"title":"约束","slug":"约束","link":"#约束","children":[]}]}]},{"level":2,"title":"系统表操作","slug":"系统表操作","link":"#系统表操作","children":[{"level":3,"title":"监控程序活动","slug":"监控程序活动","link":"#监控程序活动","children":[]},{"level":3,"title":"获取表分区下表","slug":"获取表分区下表","link":"#获取表分区下表","children":[]},{"level":3,"title":"查询指定表备注","slug":"查询指定表备注","link":"#查询指定表备注","children":[]},{"level":3,"title":"结构查询","slug":"结构查询","link":"#结构查询","children":[]},{"level":3,"title":"获取表结构信息","slug":"获取表结构信息","link":"#获取表结构信息","children":[]},{"level":3,"title":"磁盘统计","slug":"磁盘统计","link":"#磁盘统计","children":[]}]},{"level":2,"title":"进阶","slug":"进阶","link":"#进阶","children":[{"level":3,"title":"视图","slug":"视图","link":"#视图","children":[]},{"level":3,"title":"临时表","slug":"临时表","link":"#临时表","children":[]},{"level":3,"title":"触发器","slug":"触发器","link":"#触发器","children":[]},{"level":3,"title":"函数","slug":"函数","link":"#函数","children":[]}]}],"git":{"createdTime":1695484404000,"updatedTime":1724684040000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":3}]},"readingTime":{"minutes":11,"words":3301},"filePathRelative":"dataBase/postgresql/baseContent.md","localizedDate":"2023年9月1日","excerpt":"<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">提示</p>\\n<p>遇到数据库关键字需要加双引号，比如select \\"model_id\\" from meta_data.model</p>\\n</div>\\n<h2>基本操作</h2>\\n<h3>程序连接</h3>\\n<div class=\\"language-shell line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"shell\\" data-title=\\"shell\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic\\"># .Net连接数据库</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">host</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">localhost</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">;</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">port</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">5432</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">;</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">database</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">test</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">;</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">username</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">postgres</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">;</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">password</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">123456</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">;</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">Maximum</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> Pool</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> Size=</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\">100</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">;</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic\\"># jdbc连接数据库</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">jdbc:postgresql://localhost:5432/azrng?user</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">=postgres</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">&amp;</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">password</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">123456</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{g as comp,B as data};
