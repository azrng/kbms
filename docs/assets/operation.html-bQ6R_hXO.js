import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as l,c,a as s,d as n,e,b as p}from"./app-Bw62I61B.js";const i="/kbms/common/1609039130466-8deaa803-2249-40ac-972f-9bc44f6ef339.png",r={},k=p(`<h2 id="系统操作" tabindex="-1"><a class="header-anchor" href="#系统操作"><span>系统操作</span></a></h2><h3 id="数据库版本" tabindex="-1"><a class="header-anchor" href="#数据库版本"><span>数据库版本</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 查看数据库版本</span>
<span class="token keyword">select</span> @<span class="token variable">@version</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="检索执行sql时间" tabindex="-1"><a class="header-anchor" href="#检索执行sql时间"><span>检索执行SQL时间</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">declare</span> <span class="token variable">@begin_date</span> <span class="token keyword">datetime</span> 
<span class="token keyword">declare</span> <span class="token variable">@end_date</span> <span class="token keyword">datetime</span> 
<span class="token keyword">select</span> <span class="token variable">@begin_date</span> <span class="token operator">=</span> getdate<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token comment">-----------需要执行的sql语句</span>
<span class="token keyword">select</span> AC_ID <span class="token keyword">from</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>ys_tb_Collection51<span class="token punctuation">]</span> <span class="token keyword">where</span> AC_ID<span class="token operator">=</span><span class="token number">4273</span>  <span class="token operator">or</span> AC_ID<span class="token operator">=</span><span class="token number">4274</span>
<span class="token comment">----------</span>
<span class="token keyword">select</span> <span class="token variable">@end_date</span> <span class="token operator">=</span> getdate<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token keyword">select</span> datediff<span class="token punctuation">(</span>ms<span class="token punctuation">,</span><span class="token variable">@begin_date</span><span class="token punctuation">,</span><span class="token variable">@end_date</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token string">&#39;用时/毫秒&#39;</span>

<span class="token comment">-- sqlserver查询慢sql  </span>
<span class="token keyword">SELECT</span> t<span class="token punctuation">.</span><span class="token keyword">text</span><span class="token punctuation">,</span>
       <span class="token punctuation">(</span>qs<span class="token punctuation">.</span>total_elapsed_time <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count                                                          <span class="token keyword">AS</span> avg_elapsed_time<span class="token punctuation">,</span>
       <span class="token punctuation">(</span>qs<span class="token punctuation">.</span>total_worker_time <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count                                                           <span class="token keyword">AS</span> avg_cpu_time<span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token punctuation">(</span>qs<span class="token punctuation">.</span>total_elapsed_time <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count<span class="token punctuation">)</span> <span class="token operator">-</span>
       <span class="token punctuation">(</span><span class="token punctuation">(</span>qs<span class="token punctuation">.</span>total_worker_time <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count<span class="token punctuation">)</span>                                                         <span class="token keyword">AS</span> avg_wait_time<span class="token punctuation">,</span>
       qs<span class="token punctuation">.</span>total_logical_reads <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count                                                                  <span class="token keyword">AS</span> avg_logical_reads<span class="token punctuation">,</span>
       qs<span class="token punctuation">.</span>total_logical_writes <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count                                                                 <span class="token keyword">AS</span> avg_writes<span class="token punctuation">,</span>
       <span class="token punctuation">(</span>qs<span class="token punctuation">.</span>total_elapsed_time <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span>                                                                               <span class="token keyword">AS</span> cumulative_elapsed_time_all_executions
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_exec_query_stats qs
         <span class="token keyword">CROSS</span> <span class="token keyword">apply</span> sys<span class="token punctuation">.</span>Dm_exec_sql_text <span class="token punctuation">(</span>sql_handle<span class="token punctuation">)</span> t
<span class="token keyword">WHERE</span> t<span class="token punctuation">.</span><span class="token keyword">text</span> <span class="token operator">like</span> <span class="token string">&#39;%具体的表名%&#39;</span>
  <span class="token operator">and</span> qs<span class="token punctuation">.</span>creation_time
    <span class="token operator">&gt;</span> <span class="token string">&#39;2023-12-05 16:00:00&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>qs<span class="token punctuation">.</span>total_elapsed_time <span class="token operator">/</span> qs<span class="token punctuation">.</span>execution_count<span class="token punctuation">)</span> <span class="token keyword">DESC</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),u={href:"https://www.cnblogs.com/wangguowen27/p/SqlServer_Select_wgw.html",target:"_blank",rel:"noopener noreferrer"},d=p(`<h3 id="连接数" tabindex="-1"><a class="header-anchor" href="#连接数"><span>连接数</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 查询数据库连接数语句：</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> SYSPROCESSES <span class="token keyword">WHERE</span> DBID <span class="token operator">=</span> DB_ID<span class="token punctuation">(</span><span class="token string">&#39;数据库名&#39;</span><span class="token punctuation">)</span>
<span class="token comment">--手动设置连接池的最大(小)数量： &quot;Server=localhost;Database=Test;Trusted_Connection=True;Max Pool Size=100;Min Pool Size=5&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="表结构" tabindex="-1"><a class="header-anchor" href="#表结构"><span>表结构</span></a></h3><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>-- 查询表备注
 use zyp; 
SELECT DISTINCT
    d.name,
    f.value 
FROM
    syscolumns a
    LEFT JOIN systypes b ON a.xusertype= b.xusertype
    INNER JOIN sysobjects d ON a.id= d.id 
    AND d.xtype= &#39;U&#39; 
    AND d.name&lt;&gt; &#39;dtproperties&#39;
    LEFT JOIN syscomments e ON a.cdefault= e.id
    LEFT JOIN sys.extended_properties g ON a.id= G.major_id 
    AND a.colid= g.minor_id
    LEFT JOIN sys.extended_properties f ON d.id= f.major_id 
    AND f.minor_id= 0
WHERE d.name=&#39;user_info&#39;

-- 查询一个表详细结构信息
SELECT  obj.name AS 表名,
        col.colorder AS 序号 ,
        col.name AS 列名 ,
        ISNULL(ep.[value], &#39;&#39;) AS 列说明 ,
        t.name AS 数据类型 ,
        col.length AS 长度 ,
        ISNULL(COLUMNPROPERTY(col.id, col.name, &#39;Scale&#39;), 0) AS 小数位数 ,
        CASE WHEN COLUMNPROPERTY(col.id, col.name, &#39;IsIdentity&#39;) = 1 THEN &#39;√&#39;
             ELSE &#39;&#39;
        END AS 标识 ,
        CASE WHEN EXISTS ( SELECT   1
                           FROM     dbo.sysindexes si
                                    INNER JOIN dbo.sysindexkeys sik ON si.id = sik.id
                                                              AND si.indid = sik.indid
                                    INNER JOIN dbo.syscolumns sc ON sc.id = sik.id
                                                              AND sc.colid = sik.colid
                                    INNER JOIN dbo.sysobjects so ON so.name = si.name
                                                              AND so.xtype = &#39;PK&#39;
                           WHERE    sc.id = col.id
                                    AND sc.colid = col.colid ) THEN &#39;√&#39;
             ELSE &#39;&#39;
        END AS 主键 ,
        CASE WHEN col.isnullable = 1 THEN &#39;√&#39;
             ELSE &#39;&#39;
        END AS 允许空 ,
        ISNULL(comm.text, &#39;&#39;) AS 默认值
FROM    dbo.syscolumns col
        LEFT  JOIN dbo.systypes t ON col.xtype = t.xusertype
        inner JOIN dbo.sysobjects obj ON col.id = obj.id
                                         AND obj.xtype = &#39;U&#39;
                                         AND obj.status &gt;= 0
        LEFT  JOIN dbo.syscomments comm ON col.cdefault = comm.id
        LEFT  JOIN sys.extended_properties ep ON col.id = ep.major_id
                                                      AND col.colid = ep.minor_id
                                                      AND ep.name = &#39;MS_Description&#39;
        LEFT  JOIN sys.extended_properties epTwo ON obj.id = epTwo.major_id
                                                         AND epTwo.minor_id = 0
                                                         AND epTwo.name = &#39;MS_Description&#39;
WHERE   obj.name = &#39;user_info&#39;--表名
ORDER BY obj.name,col.colorder ;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="磁盘统计" tabindex="-1"><a class="header-anchor" href="#磁盘统计"><span>磁盘统计</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 查询所有表大小、占用空间</span>
<span class="token keyword">SELECT</span> 　db_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> DbName<span class="token punctuation">,</span>
    t<span class="token punctuation">.</span>NAME <span class="token keyword">AS</span> TableName<span class="token punctuation">,</span>
    s<span class="token punctuation">.</span>Name <span class="token keyword">AS</span> SchemaName<span class="token punctuation">,</span>
    p<span class="token punctuation">.</span><span class="token keyword">rows</span> <span class="token keyword">AS</span> RowCounts<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>total_pages<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token keyword">AS</span> TotalSpaceKB<span class="token punctuation">,</span> 
    CAST<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>total_pages<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> 总共占用空间MB<span class="token punctuation">,</span>
    <span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>used_pages<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token keyword">AS</span> UsedSpaceKB<span class="token punctuation">,</span> 
    CAST<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>used_pages<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.00</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> UsedSpaceMB<span class="token punctuation">,</span> 
    <span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>total_pages<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>used_pages<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token keyword">AS</span> UnusedSpaceKB<span class="token punctuation">,</span>
    CAST<span class="token punctuation">(</span><span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>total_pages<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">SUM</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>used_pages<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024.00</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token keyword">NUMERIC</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> UnusedSpaceMB
<span class="token keyword">FROM</span> 
    sys<span class="token punctuation">.</span><span class="token keyword">tables</span> t
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>      
    sys<span class="token punctuation">.</span>indexes i <span class="token keyword">ON</span> t<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">=</span> i<span class="token punctuation">.</span>object_id
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 
    sys<span class="token punctuation">.</span>partitions p <span class="token keyword">ON</span> i<span class="token punctuation">.</span>object_id <span class="token operator">=</span> p<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">AND</span> i<span class="token punctuation">.</span>index_id <span class="token operator">=</span> p<span class="token punctuation">.</span>index_id
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> 
    sys<span class="token punctuation">.</span>allocation_units a <span class="token keyword">ON</span> p<span class="token punctuation">.</span>partition_id <span class="token operator">=</span> a<span class="token punctuation">.</span>container_id
<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 
    sys<span class="token punctuation">.</span>schemas s <span class="token keyword">ON</span> t<span class="token punctuation">.</span>schema_id <span class="token operator">=</span> s<span class="token punctuation">.</span>schema_id
<span class="token keyword">WHERE</span> 
    t<span class="token punctuation">.</span>NAME <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">&#39;dt%&#39;</span> 
    <span class="token operator">AND</span> t<span class="token punctuation">.</span>is_ms_shipped <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token operator">AND</span> i<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">&gt;</span> <span class="token number">0</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 
    t<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token keyword">Rows</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 
    总共占用空间MB <span class="token keyword">desc</span>
    
    
<span class="token comment">-- 查询存在表的schema</span>
<span class="token keyword">SELECT</span> <span class="token keyword">distinct</span> b<span class="token punctuation">.</span>name <span class="token keyword">as</span> Schema_name
<span class="token keyword">from</span> sys<span class="token punctuation">.</span><span class="token keyword">tables</span> a
         <span class="token keyword">inner</span> <span class="token keyword">join</span> sys<span class="token punctuation">.</span>schemas b <span class="token keyword">on</span> a<span class="token punctuation">.</span>schema_id<span class="token operator">=</span>b<span class="token punctuation">.</span>schema_id<span class="token punctuation">;</span>

<span class="token comment">-- 查询指定schema下所有的表</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>name <span class="token keyword">as</span> TableName<span class="token punctuation">,</span>
       id<span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token keyword">top</span> <span class="token number">1</span> <span class="token keyword">value</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>extended_properties <span class="token keyword">where</span> id <span class="token operator">=</span> major_id<span class="token punctuation">)</span> <span class="token keyword">as</span> TableComment
<span class="token keyword">from</span> sys<span class="token punctuation">.</span>sysobjects a
         <span class="token keyword">inner</span> <span class="token keyword">join</span> sys<span class="token punctuation">.</span><span class="token keyword">tables</span> b <span class="token keyword">on</span> a<span class="token punctuation">.</span>id <span class="token operator">=</span> b<span class="token punctuation">.</span>object_id
         <span class="token keyword">inner</span> <span class="token keyword">join</span> sys<span class="token punctuation">.</span>schemas c <span class="token keyword">on</span> b<span class="token punctuation">.</span>schema_id <span class="token operator">=</span> c<span class="token punctuation">.</span>schema_id
<span class="token keyword">where</span> a<span class="token punctuation">.</span>xtype <span class="token operator">=</span> <span class="token string">&#39;U&#39;</span>
  <span class="token operator">and</span> c<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;dbo&#39;</span>
  
  
<span class="token comment">-- 查询每个表的记录行数</span>
<span class="token keyword">SELECT</span> db_name<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> DbName<span class="token punctuation">,</span> t<span class="token punctuation">.</span>NAME <span class="token keyword">AS</span> TableName<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Name <span class="token keyword">AS</span> SchemaName<span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token keyword">rows</span> <span class="token keyword">AS</span> RowCounts
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span><span class="token keyword">tables</span> t
         <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>indexes i <span class="token keyword">ON</span> t<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">=</span> i<span class="token punctuation">.</span>object_id
         <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>partitions p <span class="token keyword">ON</span> i<span class="token punctuation">.</span>object_id <span class="token operator">=</span> p<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">AND</span> i<span class="token punctuation">.</span>index_id <span class="token operator">=</span> p<span class="token punctuation">.</span>index_id
         <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>schemas s <span class="token keyword">ON</span> t<span class="token punctuation">.</span>schema_id <span class="token operator">=</span> s<span class="token punctuation">.</span>schema_id
<span class="token keyword">WHERE</span> t<span class="token punctuation">.</span>NAME <span class="token operator">NOT</span> <span class="token operator">LIKE</span> <span class="token string">&#39;dt%&#39;</span>
  <span class="token operator">AND</span> t<span class="token punctuation">.</span>is_ms_shipped <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token operator">AND</span> i<span class="token punctuation">.</span>OBJECT_ID <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
  
 <span class="token comment">-- 查询指定数据库下指定的表详细信息(列名、类型、备注等)</span>
 <span class="token keyword">SELECT</span> <span class="token punctuation">[</span>Is_IDENTITY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">case</span>
                           <span class="token keyword">when</span> COLUMNPROPERTY<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>object_id<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">&#39;IsIdentity&#39;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">then</span> <span class="token number">1</span>
                           <span class="token keyword">else</span> <span class="token number">0</span> <span class="token keyword">end</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span>ColName<span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
       <span class="token punctuation">[</span>ColType<span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Types</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
       <span class="token punctuation">[</span>Length<span class="token punctuation">]</span>      <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>max_length<span class="token punctuation">,</span>
       <span class="token punctuation">[</span>Is_Null<span class="token punctuation">]</span>     <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>is_nullable<span class="token punctuation">,</span>
       <span class="token punctuation">[</span>ColComment<span class="token punctuation">]</span>  <span class="token operator">=</span> <span class="token punctuation">[</span>Properties<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">value</span><span class="token punctuation">,</span>
                       <span class="token punctuation">[</span>INFORMATION<span class="token punctuation">]</span><span class="token punctuation">.</span>COLUMN_DEFAULT <span class="token keyword">as</span> ColDefault
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">Tables</span><span class="token punctuation">]</span>
         <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">Tables</span><span class="token punctuation">]</span><span class="token punctuation">.</span>object_id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>object_id
         <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span><span class="token keyword">types</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span><span class="token keyword">Types</span><span class="token punctuation">]</span>
                    <span class="token keyword">ON</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system_type_id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Types</span><span class="token punctuation">]</span><span class="token punctuation">.</span>system_type_id <span class="token operator">AND</span> is_user_defined <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">AND</span>
                       <span class="token punctuation">[</span><span class="token keyword">Types</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;sysname&#39;</span>
         <span class="token keyword">inner</span> <span class="token keyword">join</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span> <span class="token punctuation">[</span>INFORMATION<span class="token punctuation">]</span>
                    <span class="token keyword">on</span> <span class="token punctuation">[</span>INFORMATION<span class="token punctuation">]</span><span class="token punctuation">.</span>TABLE_NAME <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Tables</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">and</span> <span class="token punctuation">[</span>INFORMATION<span class="token punctuation">]</span><span class="token punctuation">.</span>COLUMN_NAME <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name
         <span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>extended_properties <span class="token keyword">AS</span> <span class="token punctuation">[</span>Properties<span class="token punctuation">]</span> <span class="token keyword">ON</span> <span class="token punctuation">[</span>Properties<span class="token punctuation">]</span><span class="token punctuation">.</span>major_id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Tables</span><span class="token punctuation">]</span><span class="token punctuation">.</span>object_id <span class="token operator">AND</span>
                                                                    <span class="token punctuation">[</span>Properties<span class="token punctuation">]</span><span class="token punctuation">.</span>minor_id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>column_id <span class="token operator">AND</span>
                                                                    <span class="token punctuation">[</span>Properties<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;MS_Description&#39;</span>
<span class="token keyword">WHERE</span> <span class="token punctuation">[</span>INFORMATION<span class="token punctuation">]</span><span class="token punctuation">.</span>TABLE_SCHEMA <span class="token operator">=</span> <span class="token string">&#39;dbo&#39;</span>
  <span class="token operator">and</span> <span class="token punctuation">[</span><span class="token keyword">Tables</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;user&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">[</span><span class="token keyword">Columns</span><span class="token punctuation">]</span><span class="token punctuation">.</span>column_id

<span class="token comment">-- 查询数据库文件大小</span>
<span class="token keyword">SELECT</span> name                                                <span class="token keyword">AS</span> 文件名<span class="token punctuation">,</span>
       size <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">/</span> <span class="token number">1024</span>                                     <span class="token keyword">AS</span> 文件大小_MB<span class="token punctuation">,</span>
       FILEPROPERTY<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&#39;SpaceUsed&#39;</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">/</span> <span class="token number">1024</span>          <span class="token keyword">AS</span> 使用空间_MB<span class="token punctuation">,</span>
       <span class="token punctuation">(</span>size <span class="token operator">-</span> FILEPROPERTY<span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token string">&#39;SpaceUsed&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token keyword">AS</span> 剩余空间_MB
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>database_files<span class="token punctuation">;</span>

<span class="token comment">--  查询指定库下所有表的字段占用</span>
<span class="token keyword">SELECT</span> TABLE_SCHEMA                   schemaName<span class="token punctuation">,</span>
       TABLE_NAME                     TableName<span class="token punctuation">,</span>
       COLUMN_NAME                    ColumnName<span class="token punctuation">,</span>
       <span class="token punctuation">(</span><span class="token function">SUM</span><span class="token punctuation">(</span>DATALENGTH<span class="token punctuation">(</span>COLUMN_NAME<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> diskSize
<span class="token keyword">FROM</span> INFORMATION_SCHEMA<span class="token punctuation">.</span><span class="token keyword">COLUMNS</span>
<span class="token keyword">WHERE</span> TABLE_CATALOG <span class="token operator">=</span> <span class="token string">&#39;sample&#39;</span>
<span class="token keyword">group</span> <span class="token keyword">by</span> TABLE_SCHEMA<span class="token punctuation">,</span> TABLE_NAME<span class="token punctuation">,</span> COLUMN_NAME<span class="token punctuation">;</span>

<span class="token comment">-- 查询指定数据库下的所有schema</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata <span class="token keyword">where</span> CATALOG_NAME<span class="token operator">=</span><span class="token string">&#39;meta_test&#39;</span> <span class="token operator">and</span> SCHEMA_NAME<span class="token operator">=</span><span class="token string">&#39;aa&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>资料：https://www.cnblogs.com/gered/p/9009513.html</p><h2 id="程序连接" tabindex="-1"><a class="header-anchor" href="#程序连接"><span>程序连接</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># jdbc连接 localhost:1433 表示数据库的地址和端口号，mydatabase是数据库名称，sa是用户名，123456是密码</span>
jdbc:sqlserver://localhost:1433<span class="token punctuation">;</span><span class="token assign-left variable">databaseName</span><span class="token operator">=</span>mydatabase<span class="token punctuation">;</span><span class="token assign-left variable">user</span><span class="token operator">=</span>sa<span class="token punctuation">;</span><span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token number">123456</span>
<span class="token comment"># sqlserver Windows 身份验证模式登录</span>
jdbc:sqlserver://localhost:1433<span class="token punctuation">;</span><span class="token assign-left variable">databaseName</span><span class="token operator">=</span>mydatabase<span class="token punctuation">;</span><span class="token assign-left variable">integratedSecurity</span><span class="token operator">=</span>true<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="net连接" tabindex="-1"><a class="header-anchor" href="#net连接"><span>.Net连接</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># .Net连接</span>
Data <span class="token assign-left variable">Source</span><span class="token operator">=</span>localhost<span class="token punctuation">;</span>Initial <span class="token assign-left variable">Catalog</span><span class="token operator">=</span>test<span class="token punctuation">;</span><span class="token assign-left variable">uid</span><span class="token operator">=</span>sa<span class="token punctuation">;</span><span class="token assign-left variable">pwd</span><span class="token operator">=</span>Sql987654<span class="token punctuation">;</span>Persist Security <span class="token assign-left variable">Info</span><span class="token operator">=</span>True<span class="token punctuation">;</span>
<span class="token assign-left variable">Server</span><span class="token operator">=</span>localhost<span class="token punctuation">;</span><span class="token assign-left variable">Database</span><span class="token operator">=</span>dbname<span class="token punctuation">;</span><span class="token assign-left variable">User</span><span class="token operator">=</span>sa<span class="token punctuation">;</span><span class="token assign-left variable">Password</span><span class="token operator">=</span>000000<span class="token punctuation">;</span><span class="token assign-left variable">MultipleActiveResultSets</span><span class="token operator">=</span>True<span class="token punctuation">;</span>

<span class="token comment"># 指定实例名和端口</span>
<span class="token assign-left variable">Server</span><span class="token operator">=</span>myServerName<span class="token punctuation">\\</span>instanceName,portNumber<span class="token punctuation">;</span><span class="token assign-left variable">Database</span><span class="token operator">=</span>myDataBase<span class="token punctuation">;</span>User <span class="token assign-left variable">Id</span><span class="token operator">=</span>myUsername<span class="token punctuation">;</span><span class="token assign-left variable">Password</span><span class="token operator">=</span>myPassword<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用Nuget包<code>Microsoft.Data.SqlClient</code>连接Microsoft SQL Server 2008 R2 (RTM)，示例如下(连接其他高版本一样的操作只不过2008在Linux容器中连接需要搞ODBC的方案 才可以)</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlClient</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> conn <span class="token operator">=</span> <span class="token string">&quot;Server=172.16.70.53\\\\MSSQLSERVER,1433;Database=cdr;User Id=sa;Password=Synyi123;trustServerCertificate=true;&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">string</span></span> sqlQuery <span class="token operator">=</span> <span class="token string">&quot;Select @@version&quot;</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> command <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sqlQuery<span class="token punctuation">,</span> connection<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> reader <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">ExecuteScalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// outputs</span>
安全警告<span class="token punctuation">:</span>协商的 TLS <span class="token number">1.0</span> 是非安全协议，只有在为了实现向后兼容性才受支持。建议的协议版本为 TLS <span class="token number">1.2</span> 及更高版本。
Microsoft SQL Server <span class="token number">2008</span> R2 <span class="token punctuation">(</span>RTM<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">10.50</span><span class="token number">.1600</span><span class="token number">.1</span> <span class="token punctuation">(</span>X64<span class="token punctuation">)</span>                                
        Apr  <span class="token number">2</span> <span class="token number">2010</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">48</span><span class="token punctuation">:</span><span class="token number">46</span>                                                           
        Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> Microsoft Corporation                                            
        <span class="token return-type class-name">Enterprise</span> Edition <span class="token punctuation">(</span><span class="token number">64</span><span class="token operator">-</span>bit<span class="token punctuation">)</span> <span class="token keyword">on</span> Windows NT <span class="token number">6.2</span> <span class="token operator">&lt;</span>X64<span class="token operator">&gt;</span> <span class="token punctuation">(</span>Build <span class="token number">9200</span><span class="token punctuation">:</span> <span class="token punctuation">)</span> <span class="token punctuation">(</span>Hypervisor<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="数据库" tabindex="-1"><a class="header-anchor" href="#数据库"><span>数据库</span></a></h2><p>查询数据库大小</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> ISNULL<span class="token punctuation">(</span>DB_NAME<span class="token punctuation">(</span>database_id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39; &#39;</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> DatabaseName<span class="token punctuation">,</span>
CAST<span class="token punctuation">(</span><span class="token function">COUNT</span><span class="token punctuation">(</span>row_count<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">8.0</span><span class="token operator">/</span><span class="token number">1024.0</span> <span class="token keyword">AS</span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token punctuation">[</span>Size<span class="token punctuation">(</span>MB<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_os_buffer_descriptors
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> database_id
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">[</span>Size<span class="token punctuation">(</span>MB<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">DESC</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建数据库</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token operator">--</span> 创建数据库并使用中文编码
CREATE DATABASE 数据库名 COLLATE Chinese_PRC_CI_AS
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="表" tabindex="-1"><a class="header-anchor" href="#表"><span>表</span></a></h2><h3 id="操作表" tabindex="-1"><a class="header-anchor" href="#操作表"><span>操作表</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">--新建表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> 仓库  
<span class="token punctuation">(</span>  
  仓库编号 <span class="token keyword">int</span> <span class="token punctuation">,</span>   
  仓库号 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>   
  城市 <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>   
  面积 <span class="token keyword">int</span>  
<span class="token punctuation">)</span> 

<span class="token comment">-- 重命名表</span>
sp_rename <span class="token string">&#39;表名&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;新表名&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;OBJECT&#39;</span>

<span class="token comment">-- 新增字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">ADD</span> <span class="token punctuation">[</span>字段名<span class="token punctuation">]</span> NVARCHAR <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span>
<span class="token comment">--添加多个字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">ADD</span> <span class="token punctuation">[</span>字段名<span class="token punctuation">]</span> NVARCHAR <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span>，<span class="token punctuation">[</span>字段名<span class="token punctuation">]</span> NVARCHAR <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span>
<span class="token comment">-- 新建默认值</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 默认值名 <span class="token keyword">DEFAULT</span> <span class="token string">&#39;ABC&#39;</span> <span class="token keyword">FOR</span> <span class="token punctuation">[</span>字段名<span class="token punctuation">]</span>
<span class="token comment">-- 删除默认值</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> 默认值名


<span class="token comment">-- 修改字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">ALTER</span> <span class="token keyword">COLUMN</span> <span class="token punctuation">[</span>字段名<span class="token punctuation">]</span> NVARCHAR <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span>


<span class="token comment">--删除字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> <span class="token punctuation">[</span>字段名<span class="token punctuation">]</span>

修改字段
<span class="token keyword">alter</span> <span class="token keyword">table</span> Grade <span class="token keyword">alter</span> <span class="token keyword">column</span> <span class="token punctuation">[</span>Name<span class="token punctuation">]</span> nvarchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>
添加字段
<span class="token keyword">alter</span> <span class="token keyword">table</span> Grade <span class="token keyword">add</span> <span class="token punctuation">[</span><span class="token keyword">Year</span><span class="token punctuation">]</span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span>
删除字段
<span class="token keyword">alter</span> <span class="token keyword">table</span> Grade <span class="token keyword">drop</span> <span class="token keyword">column</span> <span class="token punctuation">[</span><span class="token keyword">Year</span><span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询" tabindex="-1"><a class="header-anchor" href="#查询"><span>查询</span></a></h3><h4 id="联合查询" tabindex="-1"><a class="header-anchor" href="#联合查询"><span>联合查询</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>联合查询
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span>  <span class="token punctuation">(</span><span class="token keyword">select</span>   <span class="token operator">*</span>  <span class="token keyword">from</span> b_sys_user <span class="token keyword">where</span> create_user<span class="token operator">=</span><span class="token string">&#39;11111&#39;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> a 
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span>  
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span>  <span class="token operator">*</span> <span class="token keyword">from</span>  t_sys_circle_user   <span class="token keyword">where</span>  user_id<span class="token operator">=</span><span class="token string">&#39;111&#39;</span><span class="token punctuation">)</span><span class="token keyword">as</span> b  
<span class="token keyword">on</span> a<span class="token punctuation">.</span>user_id<span class="token operator">=</span>b<span class="token punctuation">.</span>user_id
这样 直接两个表把自己所需要的参数全部带进去后再关联 速度很快  


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="分页" tabindex="-1"><a class="header-anchor" href="#分页"><span>分页</span></a></h4><h4 id="sql结构" tabindex="-1"><a class="header-anchor" href="#sql结构"><span>SQL结构</span></a></h4><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">select</span> <span class="token operator">*</span> from <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">row_number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">over</span><span class="token punctuation">(</span>order <span class="token keyword">by</span> Id<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">num</span><span class="token punctuation">,</span><span class="token operator">*</span> <span class="token keyword">from</span> dbo<span class="token punctuation">.</span>TBLogins<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token class-name">temp</span> <span class="token keyword">where</span> <span class="token class-name">num</span><span class="token operator">&gt;</span><span class="token number">2</span> <span class="token keyword">and</span> num<span class="token operator">&lt;=</span><span class="token number">4</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="存储过程" tabindex="-1"><a class="header-anchor" href="#存储过程"><span>存储过程</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">set</span> ANSI_NULLS <span class="token keyword">ON</span>
<span class="token keyword">set</span> QUOTED_IDENTIFIER <span class="token keyword">ON</span>
go



<span class="token keyword">CREATE</span> <span class="token keyword">PROC</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PROC_GetPageData<span class="token punctuation">]</span>
    <span class="token variable">@pageIndex</span> <span class="token keyword">INT</span> <span class="token punctuation">,</span><span class="token comment">--当前的页码值</span>
    <span class="token variable">@pageSize</span> <span class="token keyword">INT</span> <span class="token punctuation">,</span><span class="token comment">--每页显示的记录数.(每页显示几行数据)</span>
    <span class="token variable">@rowCount</span> <span class="token keyword">INT</span> OUTPUT <span class="token punctuation">,</span><span class="token comment">--表示总的记录数</span>
    <span class="token variable">@pageCount</span> <span class="token keyword">INT</span> OUTPUT <span class="token punctuation">,</span><span class="token comment">--表示总页数</span>
    <span class="token variable">@tableName</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token comment">--表名</span>
    <span class="token variable">@idName</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token comment">--排序字段</span>
    <span class="token variable">@whereStr</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token punctuation">,</span><span class="token comment">--where条件</span>
    <span class="token variable">@isDesc</span> <span class="token keyword">BIT</span><span class="token comment">--是否降序</span>
<span class="token keyword">AS</span> 
    <span class="token keyword">BEGIN</span>
        <span class="token keyword">DECLARE</span> <span class="token variable">@sql</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
        <span class="token keyword">DECLARE</span> <span class="token variable">@where</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span>
        <span class="token keyword">DECLARE</span> <span class="token variable">@orderBy</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
        <span class="token keyword">SET</span> <span class="token variable">@where</span><span class="token operator">=</span><span class="token string">&#39;&#39;</span>
        <span class="token keyword">IF</span> <span class="token variable">@whereStr</span> <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;&#39;</span> <span class="token operator">AND</span> <span class="token variable">@whereStr</span> <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
            <span class="token keyword">BEGIN</span>
                <span class="token keyword">SET</span> <span class="token variable">@where</span> <span class="token operator">=</span> <span class="token variable">@whereStr</span>
            <span class="token keyword">END</span>
        <span class="token keyword">IF</span> <span class="token variable">@isDesc</span> <span class="token operator">&lt;&gt;</span> <span class="token number">0</span> 
            <span class="token keyword">BEGIN</span>
                <span class="token keyword">SET</span> <span class="token variable">@orderBy</span> <span class="token operator">=</span> <span class="token string">&#39; desc&#39;</span>
            <span class="token keyword">END</span>
        <span class="token keyword">ELSE</span> 
            <span class="token keyword">BEGIN</span>
                <span class="token keyword">SET</span> <span class="token variable">@orderBy</span> <span class="token operator">=</span> <span class="token string">&#39; asc&#39;</span>
            <span class="token keyword">END</span>
        <span class="token keyword">SET</span> <span class="token variable">@sql</span> <span class="token operator">=</span> <span class="token string">&#39;select @totalRowCount=count(*) from &#39;</span> <span class="token operator">+</span> <span class="token variable">@tableName</span> <span class="token operator">+</span> <span class="token variable">@where</span>

        <span class="token keyword">EXEC</span> sp_executesql <span class="token variable">@sql</span><span class="token punctuation">,</span> N<span class="token string">&#39;@totalRowCount int output&#39;</span><span class="token punctuation">,</span> <span class="token variable">@rowCount</span> OUTPUT
        <span class="token keyword">SET</span> <span class="token variable">@sql</span> <span class="token operator">=</span> <span class="token string">&#39;select @totalPageCount=&#39;</span> <span class="token operator">+</span> <span class="token keyword">CONVERT</span><span class="token punctuation">(</span>NVARCHAR<span class="token punctuation">,</span> CEILING<span class="token punctuation">(</span><span class="token variable">@rowCount</span> <span class="token operator">/</span> <span class="token keyword">CONVERT</span><span class="token punctuation">(</span><span class="token keyword">FLOAT</span><span class="token punctuation">,</span> <span class="token variable">@pageSize</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">EXEC</span> sp_executesql <span class="token variable">@sql</span><span class="token punctuation">,</span> N<span class="token string">&#39;@totalPageCount int output&#39;</span><span class="token punctuation">,</span> <span class="token variable">@pageCount</span> OUTPUT

        <span class="token keyword">IF</span> <span class="token variable">@pageIndex</span> <span class="token operator">&lt;=</span> <span class="token number">1</span> 
            <span class="token keyword">BEGIN</span>

                <span class="token keyword">SET</span> <span class="token variable">@pageIndex</span> <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">END</span>
        <span class="token keyword">IF</span> <span class="token variable">@pageIndex</span> <span class="token operator">&gt;=</span> <span class="token variable">@pageCount</span> 
            <span class="token keyword">BEGIN</span>

                <span class="token keyword">SET</span> <span class="token variable">@pageIndex</span> <span class="token operator">=</span> <span class="token variable">@pageCount</span>
            <span class="token keyword">END</span>
        <span class="token keyword">SET</span> <span class="token variable">@sql</span> <span class="token operator">=</span> <span class="token string">&#39;select * from (select row_number() over(order by &#39;</span>
            <span class="token operator">+</span> <span class="token variable">@idName</span> <span class="token operator">+</span> <span class="token variable">@orderBy</span> <span class="token operator">+</span> <span class="token string">&#39; ) as num,* from &#39;</span> <span class="token operator">+</span> <span class="token variable">@tableName</span> <span class="token operator">+</span> <span class="token variable">@where</span>
            <span class="token operator">+</span> <span class="token string">&#39;) as temp where num&gt;&#39;</span> <span class="token operator">+</span> <span class="token keyword">CONVERT</span><span class="token punctuation">(</span>NVARCHAR<span class="token punctuation">,</span> <span class="token punctuation">(</span> <span class="token variable">@pageIndex</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span>
            <span class="token operator">*</span> <span class="token variable">@pageSize</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39; and num&lt;=&#39;</span> <span class="token operator">+</span> <span class="token keyword">CONVERT</span><span class="token punctuation">(</span>NVARCHAR<span class="token punctuation">,</span> <span class="token variable">@pageIndex</span>
            <span class="token operator">*</span> <span class="token variable">@pageSize</span><span class="token punctuation">)</span> 

    <span class="token keyword">END</span>
    <span class="token keyword">EXEC</span> sp_executesql <span class="token variable">@sql</span>


调用dbhelper中方法   包含有输出参数
 <span class="token keyword">public</span> List<span class="token operator">&lt;</span>BusinessTypeInfo<span class="token operator">&gt;</span> pageBusinessTypeShow<span class="token punctuation">(</span>PageModel info<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">int</span> <span class="token keyword">rowcount</span><span class="token punctuation">)</span>
        {
            SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span> parm <span class="token operator">=</span>{
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@PageSize&quot;</span><span class="token punctuation">,</span>info<span class="token punctuation">.</span>PageSize<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@PageIndex&quot;</span><span class="token punctuation">,</span>info<span class="token punctuation">.</span>PageIndex<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@tableName&quot;</span><span class="token punctuation">,</span>info<span class="token punctuation">.</span>tableName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@rowCount&quot;</span><span class="token punctuation">,</span>DbType<span class="token punctuation">.</span>Int32<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@pageCount&quot;</span><span class="token punctuation">,</span>DbType<span class="token punctuation">.</span>Int32<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@idName&quot;</span><span class="token punctuation">,</span>info<span class="token punctuation">.</span>idName<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@whereStr&quot;</span><span class="token punctuation">,</span>info<span class="token punctuation">.</span>whereStr<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                new SqlParameter<span class="token punctuation">(</span><span class="token string">&quot;@isDesc&quot;</span><span class="token punctuation">,</span>info<span class="token punctuation">.</span>isDesc<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                }<span class="token punctuation">;</span>
            parm<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Direction <span class="token operator">=</span> ParameterDirection<span class="token punctuation">.</span>Output<span class="token punctuation">;</span>
            <span class="token comment">// parm[4].Direction = ParameterDirection.Output;</span>
            List<span class="token operator">&lt;</span>BusinessTypeInfo<span class="token operator">&gt;</span> Binfo <span class="token operator">=</span> new List<span class="token operator">&lt;</span>BusinessTypeInfo<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span>SqlDataReader dr <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span>DataReaderByProc<span class="token punctuation">(</span><span class="token string">&quot;PROC_GetPageData&quot;</span><span class="token punctuation">,</span> parm<span class="token punctuation">)</span><span class="token punctuation">)</span>
            {
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dr<span class="token punctuation">.</span>HasRows<span class="token punctuation">)</span>
                {
                    <span class="token keyword">while</span> <span class="token punctuation">(</span>dr<span class="token punctuation">.</span><span class="token keyword">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    {
                        Binfo<span class="token punctuation">.</span><span class="token keyword">Add</span><span class="token punctuation">(</span>new BusinessTypeInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        {
                            Bid <span class="token operator">=</span> <span class="token keyword">Convert</span><span class="token punctuation">.</span>ToInt32<span class="token punctuation">(</span>dr<span class="token punctuation">[</span><span class="token string">&quot;Bid&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            Bname <span class="token operator">=</span> dr<span class="token punctuation">[</span><span class="token string">&quot;Bname&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ToString<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        }<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    }
                }
                <span class="token keyword">else</span>
                {
                    <span class="token keyword">rowcount</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    Binfo <span class="token operator">=</span> <span class="token boolean">null</span><span class="token punctuation">;</span>
                }
            }
            <span class="token keyword">rowcount</span> <span class="token operator">=</span> <span class="token keyword">Convert</span><span class="token punctuation">.</span>ToInt32<span class="token punctuation">(</span>parm<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">Value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Binfo<span class="token punctuation">;</span>
        }

前台传值界面
          BLLpage bllpage <span class="token operator">=</span> new BLLpage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> <span class="token keyword">rowcount</span><span class="token punctuation">;</span><span class="token comment">//分页总条数</span>
            AspNetPager1<span class="token punctuation">.</span>PageSize <span class="token operator">=</span> pagesize<span class="token punctuation">;</span>
            PageModel page <span class="token operator">=</span> new PageModel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            page<span class="token punctuation">.</span>isDesc <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            page<span class="token punctuation">.</span>idName <span class="token operator">=</span> <span class="token string">&quot;uid&quot;</span><span class="token punctuation">;</span>
            page<span class="token punctuation">.</span>tableName <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">;</span>
            page<span class="token punctuation">.</span>whereStr <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>string<span class="token punctuation">.</span>IsNullOrEmpty<span class="token punctuation">(</span>uname<span class="token punctuation">)</span><span class="token punctuation">)</span>
            {
                <span class="token comment">//page.whereStr = string.Format(&quot; where uname=&#39;{0}&#39;&quot;,txtUname.Text.Trim());</span>
                page<span class="token punctuation">.</span>whereStr <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">&quot; where  uname like &#39;%{0}%&#39;&quot;</span><span class="token punctuation">,</span> uname<span class="token punctuation">)</span><span class="token punctuation">;</span>
            }
            page<span class="token punctuation">.</span>PageIndex <span class="token operator">=</span> AspNetPager1<span class="token punctuation">.</span>CurrentPageIndex<span class="token punctuation">;</span>
            page<span class="token punctuation">.</span>PageSize <span class="token operator">=</span> AspNetPager1<span class="token punctuation">.</span>PageSize<span class="token punctuation">;</span>
            rptShow<span class="token punctuation">.</span>DataSource <span class="token operator">=</span> bllpage<span class="token punctuation">.</span>pageUserShow<span class="token punctuation">(</span>page<span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">rowcount</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            AspNetPager1<span class="token punctuation">.</span>RecordCount <span class="token operator">=</span> <span class="token keyword">rowcount</span><span class="token punctuation">;</span>
            rptShow<span class="token punctuation">.</span>DataBind<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>





dbhelp方法
 <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 执行存储过程</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;procname&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name=&quot;parm&quot;&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> static SqlDataReader DataReaderByProc<span class="token punctuation">(</span>string procname<span class="token punctuation">,</span> params SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span> parm<span class="token punctuation">)</span>
        {
            SqlConnection con <span class="token operator">=</span> new SqlConnection<span class="token punctuation">(</span>conn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span>SqlCommand cmd <span class="token operator">=</span> new SqlCommand<span class="token punctuation">(</span>procname<span class="token punctuation">,</span> con<span class="token punctuation">)</span><span class="token punctuation">)</span>
            {
                <span class="token keyword">if</span> <span class="token punctuation">(</span>con<span class="token punctuation">.</span>State <span class="token operator">=</span><span class="token operator">=</span> ConnectionState<span class="token punctuation">.</span>Closed<span class="token punctuation">)</span>
                {
                    con<span class="token punctuation">.</span><span class="token keyword">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                }
                <span class="token keyword">if</span> <span class="token punctuation">(</span>parm <span class="token operator">!=</span> <span class="token boolean">null</span><span class="token punctuation">)</span>
                {
                    cmd<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span>AddRange<span class="token punctuation">(</span>parm<span class="token punctuation">)</span><span class="token punctuation">;</span>
                }
                cmd<span class="token punctuation">.</span>CommandType <span class="token operator">=</span> CommandType<span class="token punctuation">.</span>StoredProcedure<span class="token punctuation">;</span>
                <span class="token keyword">return</span> cmd<span class="token punctuation">.</span>ExecuteReader<span class="token punctuation">(</span>CommandBehavior<span class="token punctuation">.</span>CloseConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
            }
        }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="添加数据" tabindex="-1"><a class="header-anchor" href="#添加数据"><span>添加数据</span></a></h3><p>1.如果表有自动增长列，那么需要先打开自动增长的写入，然后插入数据结束以后在关闭</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">SET</span> <span class="token keyword">IDENTITY_INSERT</span> <span class="token punctuation">[</span>ys_tb_Role<span class="token punctuation">]</span> <span class="token keyword">ON</span>
<span class="token keyword">INSERT</span> <span class="token punctuation">[</span>ys_tb_Role<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>r_id<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>r_rolename<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>r_powers<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span>N<span class="token string">&#39;总经理&#39;</span><span class="token punctuation">,</span>N<span class="token string">&#39;,1,2,3,4,5,6,7,8,&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">SET</span> <span class="token keyword">IDENTITY_INSERT</span> <span class="token punctuation">[</span>ys_tb_Role<span class="token punctuation">]</span> <span class="token keyword">OFF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.插入多条数据</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">Insert</span> <span class="token keyword">into</span> 表名字<span class="token punctuation">(</span>id<span class="token punctuation">,</span>name<span class="token punctuation">,</span>sale<span class="token punctuation">,</span>salesdate<span class="token punctuation">)</span>
<span class="token keyword">Select</span>  <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;营销一部&#39;</span>，<span class="token number">300</span><span class="token punctuation">,</span><span class="token string">&#39;2007-1-1&#39;</span>
<span class="token keyword">Union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;营销二部&#39;</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token string">&#39;2006-1-1&#39;</span>
<span class="token keyword">Union</span> <span class="token keyword">all</span> <span class="token keyword">select</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;营销三部&#39;</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token string">&#39;2011-1-1&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.插入一条数据</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>user_info<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>user_name<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">status</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;11&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;111&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>数据插入到另一个表</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>一：如果要插入目标表不存在：
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> 目标表 <span class="token keyword">from</span> 表 <span class="token keyword">where</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
二：如果要插入目标表已经存在：
<span class="token keyword">insert</span> <span class="token keyword">into</span> 目的表 <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> 表 <span class="token keyword">where</span> 条件
三：如果是跨数据库操作的话： 怎么把A数据库的atable表所查询的东西，全部插入到B 数据库的btable表中
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> B<span class="token punctuation">.</span>btable <span class="token keyword">from</span> A<span class="token punctuation">.</span>atable <span class="token keyword">where</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="更新数据" tabindex="-1"><a class="header-anchor" href="#更新数据"><span>更新数据</span></a></h3><div class="language-plsql line-numbers-mode" data-ext="plsql" data-title="plsql"><pre class="language-plsql"><code><span class="token comment">-- 更新查询出来的数据</span>
<span class="token keyword">Update</span> t1 
　　　　<span class="token keyword">set</span> t1<span class="token punctuation">.</span>c2 <span class="token operator">=</span> t2<span class="token punctuation">.</span>c2
fro m t1 inner join t2 
　　　　<span class="token keyword">on</span> t1<span class="token punctuation">.</span>c1 <span class="token operator">=</span> t2<span class="token punctuation">.</span>c1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除数据" tabindex="-1"><a class="header-anchor" href="#删除数据"><span>删除数据</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>删除后再添加id从<span class="token number">1</span>开始
<span class="token keyword">truncate</span> <span class="token keyword">table</span> <span class="token punctuation">[</span>tablename<span class="token punctuation">]</span> 即可
删除后再添加，从之前的最大id后面加<span class="token number">1</span>
<span class="token keyword">Drop</span> <span class="token keyword">table</span> 表名

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="约束" tabindex="-1"><a class="header-anchor" href="#约束"><span>约束</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">-- 新建约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> 约束名 <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>约束字段<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token string">&#39;2010-12-1&#39;</span><span class="token punctuation">)</span>

<span class="token comment">--删除约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>表名<span class="token punctuation">]</span> <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> 约束名

<span class="token keyword">IF</span>  <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dbo<span class="token punctuation">.</span>sysobjects <span class="token keyword">WHERE</span> id <span class="token operator">=</span> OBJECT_ID<span class="token punctuation">(</span>N<span class="token string">&#39;[dbo].[FK_BuiAddProType_BuildFunction]&#39;</span><span class="token punctuation">)</span> <span class="token operator">AND</span> <span class="token keyword">type</span> <span class="token operator">=</span> <span class="token string">&#39;F&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>BuiAddProType<span class="token punctuation">]</span> <span class="token keyword">DROP</span> <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">[</span>FK_BuiAddProType_BuildFunction<span class="token punctuation">]</span>


外键约束
<span class="token keyword">alter</span> <span class="token keyword">table</span> dbo<span class="token punctuation">.</span>ys_tb_Admin 
<span class="token keyword">Add</span> <span class="token keyword">constraint</span> FK_ys_tb_Admin_ys_tb_Role <span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>a_rid<span class="token punctuation">)</span> <span class="token keyword">references</span> dbo<span class="token punctuation">.</span>ys_tb_Role<span class="token punctuation">(</span>r_id<span class="token punctuation">)</span>
主键约束
<span class="token keyword">alter</span> <span class="token keyword">table</span> Grade <span class="token keyword">Add</span> <span class="token keyword">constraint</span> <span class="token punctuation">[</span>PK_Grade<span class="token punctuation">]</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>Id<span class="token punctuation">)</span>
唯一约束
<span class="token keyword">alter</span> <span class="token keyword">table</span> Grade <span class="token keyword">add</span> <span class="token keyword">constraint</span> <span class="token punctuation">[</span>IX_Grade_Name<span class="token punctuation">]</span> <span class="token keyword">unique</span> <span class="token punctuation">(</span>Id <span class="token keyword">asc</span><span class="token punctuation">)</span>
<span class="token keyword">check</span>约束
<span class="token keyword">alter</span> <span class="token keyword">table</span> Student <span class="token keyword">add</span> <span class="token keyword">constraint</span> CK_Student_Gender <span class="token keyword">CHECK</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>Gender<span class="token punctuation">]</span><span class="token operator">=</span>N<span class="token string">&#39;男&#39;</span> <span class="token operator">OR</span> <span class="token punctuation">[</span>Gender<span class="token punctuation">]</span><span class="token operator">=</span>N<span class="token string">&#39;女&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
删除约束
<span class="token keyword">alter</span> <span class="token keyword">table</span> Student <span class="token keyword">drop</span> <span class="token keyword">constraint</span> IX_Student_Name


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="游标" tabindex="-1"><a class="header-anchor" href="#游标"><span>游标</span></a></h2><p>对处理结果集(查询之后返回的所有行数据的集合)的一种机制，可以定位到结果集找那个的某一行，然后操作数据。 静态游标的完整结果集将打开游标时建立的结果集存储在临时表中，（静态游标始终是只读的）。</p><p>静态游标具有以下特点：总是按照打开游标时的原样显示结果集；不反映数据库中作的任何修改，也不反映对结果集行的列值所作的更改；不显示打开游标后在数据库中新插入的行；组成结果集的行被其他用户更新，新的数据值不会显示在静态游标中；但是静态游标会显示打开游标以后从数据库中删除的行。</p><p><strong>动态游标</strong>与静态游标相反，当滚动游标时动态游标反映结果集中的所有更改。结果集中的行数据值、顺序和成员每次提取时都会改变。 <strong>只进游标</strong>不支持滚动，它只支持游标从头到尾顺序提取数据行。注意：只进游标也反映对结果集所做的所有更改。 <strong>键集驱动游标</strong>同时具有静态游标和动态游标的特点。当打开游标时，该游标中的成员以及行的顺序是固定的，键集在游标打开时也会存储到临时工作表中，对非键集列的数据值的更改在用户游标滚动的时候可以看见，在游标打开以后对数据库中插入的行是不可见的，除非关闭重新打开游标。</p><p>动态游标：将一个表的数据查询出来插入另一个表</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">---1.声明游标</span>
<span class="token keyword">declare</span> orderNum_03_cursor <span class="token keyword">cursor</span> scroll
<span class="token keyword">for</span> <span class="token keyword">select</span> <span class="token punctuation">[</span>AdPageId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>AdPageName<span class="token punctuation">]</span> <span class="token keyword">from</span> AdPage_copy1
<span class="token comment">--2.打开游标</span>
<span class="token keyword">open</span> orderNum_03_cursor
<span class="token comment">--3.声明游标提取数据所要存放的变量</span>
<span class="token keyword">declare</span> <span class="token variable">@AdPageId</span> <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token variable">@AdPageName</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token comment">--4.定位游标到哪一行</span>
<span class="token keyword">fetch</span> <span class="token keyword">First</span> <span class="token keyword">from</span> orderNum_03_cursor <span class="token keyword">into</span> <span class="token variable">@AdPageId</span><span class="token punctuation">,</span><span class="token variable">@AdPageName</span>  <span class="token comment">--into的变量数量必须与游标查询结果集的列数相同</span>
<span class="token keyword">while</span> @<span class="token variable">@fetch_status</span><span class="token operator">=</span><span class="token number">0</span>  <span class="token comment">--提取成功，进行下一条数据的提取操作 </span>
 <span class="token keyword">begin</span>
   <span class="token keyword">if</span> <span class="token variable">@AdPageName</span> <span class="token operator">LIKE</span> <span class="token string">&#39;%资讯%&#39;</span>
     <span class="token keyword">begin</span>
		 
		 <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>AdPage_copy1_copy1<span class="token punctuation">]</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>AdPageName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token variable">@AdPageName</span><span class="token punctuation">)</span>   

     <span class="token keyword">end</span>
   <span class="token keyword">fetch</span> <span class="token keyword">next</span> <span class="token keyword">from</span> orderNum_03_cursor <span class="token keyword">into</span> <span class="token variable">@AdPageId</span><span class="token punctuation">,</span><span class="token variable">@AdPageName</span>  <span class="token comment">--移动游标</span>
 <span class="token keyword">end</span>
<span class="token comment">--游标结束 </span>
 
 

 <span class="token comment">--删除游标</span>
<span class="token keyword">deallocate</span> orderNum_03_cursor

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="函数" tabindex="-1"><a class="header-anchor" href="#函数"><span>函数</span></a></h2><h3 id="标量函数" tabindex="-1"><a class="header-anchor" href="#标量函数"><span>标量函数</span></a></h3><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">Create</span> <span class="token keyword">function</span> 函数名（参数）
<span class="token keyword">Returns</span> 返回值数据类型
<span class="token punctuation">[</span><span class="token keyword">with</span> {Encryption <span class="token operator">|</span> Schemabinding }<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">as</span><span class="token punctuation">]</span>
<span class="token keyword">begin</span>
<span class="token keyword">SQL</span>语句<span class="token punctuation">(</span>必须有<span class="token keyword">return</span> 变量或值<span class="token punctuation">)</span>
 <span class="token keyword">End</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Schemabinding :将函数绑定到它引用的对象上（注：函数一旦绑定，则不能删除、修改，除非删除绑定）</p><h3 id="表格值函数" tabindex="-1"><a class="header-anchor" href="#表格值函数"><span>表格值函数</span></a></h3><h4 id="内联表格值函数" tabindex="-1"><a class="header-anchor" href="#内联表格值函数"><span>内联表格值函数</span></a></h4><p>格式：</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> 函数名（参数）
<span class="token keyword">returns</span> <span class="token keyword">table</span>
<span class="token punctuation">[</span><span class="token keyword">with</span> {Encryption <span class="token operator">|</span> Schemabinding }<span class="token punctuation">]</span>
<span class="token keyword">as</span>
<span class="token keyword">return</span><span class="token punctuation">(</span>一条<span class="token keyword">SQL</span>语句<span class="token punctuation">)</span>

<span class="token keyword">create</span> <span class="token keyword">function</span> tabcmess<span class="token punctuation">(</span><span class="token variable">@code</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">returns</span> <span class="token keyword">table</span>
<span class="token keyword">as</span>
<span class="token keyword">return</span><span class="token punctuation">(</span><span class="token keyword">select</span> ccode<span class="token punctuation">,</span>scode <span class="token keyword">from</span> cmessage <span class="token keyword">where</span> ccode <span class="token operator">like</span> <span class="token variable">@ccode</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="多句表格值函数" tabindex="-1"><a class="header-anchor" href="#多句表格值函数"><span>多句表格值函数</span></a></h4><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>   <span class="token keyword">create</span> <span class="token keyword">function</span> 函数名（参数）
   <span class="token keyword">returns</span> 表格变量名<span class="token keyword">table</span> <span class="token punctuation">(</span>表格变量定义<span class="token punctuation">)</span>
   <span class="token punctuation">[</span><span class="token keyword">with</span> {Encryption <span class="token operator">|</span> Schemabinding }<span class="token punctuation">]</span>
<span class="token keyword">as</span>
   <span class="token keyword">begin</span>
    <span class="token keyword">SQL</span>语句
   <span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>简单例子</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code> <span class="token keyword">create</span> <span class="token keyword">function</span> jiafa<span class="token punctuation">(</span>
 <span class="token variable">@a</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
 <span class="token variable">@b</span> <span class="token keyword">int</span>
 <span class="token punctuation">)</span>
 <span class="token keyword">returns</span> <span class="token keyword">int</span>
 <span class="token keyword">as</span>
 <span class="token keyword">begin</span>
 <span class="token keyword">declare</span> <span class="token variable">@d</span> <span class="token keyword">int</span>
 <span class="token keyword">set</span> <span class="token variable">@d</span><span class="token operator">=</span><span class="token variable">@a</span><span class="token operator">+</span><span class="token variable">@b</span><span class="token punctuation">;</span>
 <span class="token keyword">return</span> <span class="token variable">@b</span><span class="token punctuation">;</span>
 <span class="token keyword">end</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>是一个加法的函数</p><h2 id="视图" tabindex="-1"><a class="header-anchor" href="#视图"><span>视图</span></a></h2>`,64),v={href:"https://www.baidu.com/s?wd=%E7%A4%BE%E4%BC%9A%E4%BF%9D%E9%99%A9%E5%9F%BA%E9%87%91&tn=44039180_cpr&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1dWuAm3mW7WPvfsPAfvuhN-0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3EPH6dPW6LPHm",target:"_blank",rel:"noopener noreferrer"},m=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;stuinfo&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> stuinfo
<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;exam&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> exam
<span class="token keyword">create</span> <span class="token keyword">table</span> stuinfo<span class="token punctuation">(</span>stuid <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>stuName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>stusex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>classid <span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> exam<span class="token punctuation">(</span>examno <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span>stuid <span class="token keyword">int</span><span class="token punctuation">,</span>subject <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>score <span class="token keyword">int</span><span class="token punctuation">)</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> stuinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;张三&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stuinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;李四&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;女&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stuinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;王五&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stuinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;赵六&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;女&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> stuinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;田七&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;男&#39;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;HTML&#39;</span><span class="token punctuation">,</span><span class="token number">85</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;JAVA&#39;</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;SQL&#39;</span><span class="token punctuation">,</span><span class="token number">82</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;HTML&#39;</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;JAVA&#39;</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;SQL&#39;</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;HTML&#39;</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;JAVA&#39;</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;SQL&#39;</span><span class="token punctuation">,</span><span class="token number">85</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;HTML&#39;</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;JAVA&#39;</span><span class="token punctuation">,</span><span class="token number">68</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;SQL&#39;</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;HTML&#39;</span><span class="token punctuation">,</span><span class="token number">81</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;JAVA&#39;</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">)</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> exam <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;SQL&#39;</span><span class="token punctuation">,</span><span class="token number">75</span><span class="token punctuation">)</span>

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stuinfo
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> exam

<span class="token comment">--创建视图</span>
            <span class="token comment">--如果存在该视图就删除</span>
<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;vive_stuinfo_exam&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">view</span> vive_stuinfo_exam   <span class="token comment">--删除视图的语句</span>
go

<span class="token keyword">create</span> <span class="token keyword">view</span> vive_stuinfo_exam <span class="token comment">--创建名字是vive_stuinfo_exam的视图</span>
<span class="token comment">--对视图进行加密with encryption</span>
<span class="token keyword">as</span>
  <span class="token keyword">select</span> stuname<span class="token punctuation">,</span>stuinfo<span class="token punctuation">.</span>stuid<span class="token punctuation">,</span>score <span class="token keyword">from</span> stuinfo <span class="token keyword">left</span> <span class="token keyword">join</span> exam <span class="token keyword">on</span> stuinfo<span class="token punctuation">.</span>stuid<span class="token operator">=</span>exam<span class="token punctuation">.</span>stuid
go
  <span class="token comment">--查看视图</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> vive_stuinfo_exam

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="事务" tabindex="-1"><a class="header-anchor" href="#事务"><span>事务</span></a></h2><p>**悲观锁:**悲观锁悲观的认为每一次操作都会造成更新丢失问题,在每次查询时就加上排他锁。 **乐观锁:**乐观锁会乐观的认为每次查询都不会造成更新丢失.利用一个版本字段进行控制。 查询非常多,修改非常少,使用乐观锁。修改非常多,查询非常少,使用悲观锁。</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">--张三转账1000给李四</span>
 
<span class="token comment">--开始一个事务</span>
<span class="token keyword">begin</span>  <span class="token keyword">tran</span> tran_bank
<span class="token comment">--定义一个错误变量</span>
<span class="token keyword">declare</span> <span class="token variable">@tranerr</span> <span class="token keyword">int</span>
<span class="token comment">--赋初始值</span>
<span class="token keyword">set</span> <span class="token variable">@tranerr</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token comment">--执行转账操作</span>
<span class="token keyword">update</span> bank <span class="token keyword">set</span> customaccount<span class="token operator">=</span>customaccount<span class="token operator">-</span><span class="token number">1000</span> <span class="token keyword">where</span> customName<span class="token operator">=</span><span class="token string">&#39;张三&#39;</span>
<span class="token comment">--使用全局错误变量得到上一条sql语句是否出现错误</span>
<span class="token keyword">set</span> <span class="token variable">@tranerr</span><span class="token operator">=</span><span class="token variable">@tranerr</span><span class="token operator">+</span>@<span class="token variable">@error</span>
<span class="token keyword">update</span> bank <span class="token keyword">set</span> customaccount<span class="token operator">=</span>customaccount<span class="token operator">+</span><span class="token number">1000</span> <span class="token keyword">where</span> customName<span class="token operator">=</span><span class="token string">&#39;李四&#39;</span>
<span class="token comment">--使用全局错误变量得到上一条sql语句是否出现错误</span>
<span class="token keyword">set</span> <span class="token variable">@tranerr</span><span class="token operator">=</span><span class="token variable">@tranerr</span><span class="token operator">+</span>@<span class="token variable">@error</span>
<span class="token keyword">if</span> <span class="token variable">@tranerr</span><span class="token operator">&lt;&gt;</span><span class="token number">0</span>
   <span class="token keyword">begin</span>
     <span class="token keyword">rollback</span> <span class="token keyword">tran</span>   
     <span class="token keyword">print</span> <span class="token string">&#39;转账失败，交易已取消&#39;</span>
   <span class="token keyword">end</span>
<span class="token keyword">else</span>
  <span class="token keyword">begin</span>
   <span class="token keyword">commit</span> <span class="token keyword">tran</span>
   <span class="token keyword">print</span> <span class="token string">&#39;转账成功，请注意查收&#39;</span>
  <span class="token keyword">end</span>
 
 
 
存储过程中使用事务：
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;JayJayToTest&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">drop</span> <span class="token keyword">proc</span> JayJayToTest
go 
<span class="token keyword">create</span> <span class="token keyword">proc</span> JayJayToTest
    <span class="token variable">@GiveMoney</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token variable">@UserName</span> nvarchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">as</span> 
beginset nocount <span class="token keyword">on</span><span class="token punctuation">;</span>
    <span class="token keyword">begin</span> <span class="token keyword">tran</span><span class="token punctuation">;</span>
    <span class="token keyword">begin</span> try
        <span class="token keyword">update</span> BankTest <span class="token keyword">set</span> Money <span class="token operator">=</span> Money<span class="token operator">-</span><span class="token variable">@GiveMoney</span> <span class="token keyword">where</span> Name<span class="token operator">=</span><span class="token variable">@UserName</span><span class="token punctuation">;</span>
        <span class="token keyword">update</span> BankTest <span class="token keyword">set</span> Money <span class="token operator">=</span> Money<span class="token operator">+</span><span class="token variable">@GiveMoney</span> <span class="token keyword">where</span> Name<span class="token operator">=</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">commit</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> try   
    <span class="token keyword">begin</span> catch        
        <span class="token keyword">rollback</span> <span class="token keyword">tran</span><span class="token punctuation">;</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;发生异常，事务进行回滚&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> catch   
<span class="token keyword">end</span>
go
<span class="token keyword">exec</span> JayJayToTest <span class="token number">10</span><span class="token punctuation">,</span><span class="token string">&#39;jayjay&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="存储过程-1" tabindex="-1"><a class="header-anchor" href="#存储过程-1"><span>存储过程</span></a></h2><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code>创建存储过程的基本语法：
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">exists</span> <span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name <span class="token operator">=</span> <span class="token string">&#39;USP_GetAllUser&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">drop</span> <span class="token keyword">proc</span> USP_GetAllUser
go
<span class="token keyword">create</span> <span class="token keyword">proc</span> USP_GetAllUser
<span class="token variable">@UserId</span> <span class="token keyword">int</span> <span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">as</span> 
<span class="token keyword">set</span> nocount <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">begin</span>
    <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> UserInfo <span class="token keyword">where</span> Id<span class="token operator">=</span><span class="token variable">@UserId</span>
<span class="token keyword">end</span>

调用存储过程：
<span class="token keyword">exec</span> dbo<span class="token punctuation">.</span>USP_GetAllUser <span class="token number">2</span><span class="token punctuation">;</span>

修改存储过程
<span class="token keyword">alter</span> <span class="token keyword">proc</span> proc_name
<span class="token keyword">as</span>
<span class="token keyword">sql</span>语句

存储过程中输出参数的使用
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;GetUser&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">drop</span> <span class="token keyword">proc</span> GetUser
go 
<span class="token keyword">create</span> <span class="token keyword">proc</span> GetUser
    <span class="token variable">@id</span> <span class="token keyword">int</span> output<span class="token punctuation">,</span>
    <span class="token variable">@name</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">out</span>
<span class="token keyword">as</span> 
<span class="token keyword">begin</span> 
    <span class="token keyword">select</span> <span class="token variable">@id</span><span class="token operator">=</span>Id<span class="token punctuation">,</span><span class="token variable">@name</span><span class="token operator">=</span>Name <span class="token keyword">from</span> UserInfo <span class="token keyword">where</span> Id<span class="token operator">=</span><span class="token variable">@id</span>
<span class="token keyword">end</span>

go 
<span class="token keyword">declare</span> 
<span class="token variable">@name</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token variable">@id</span> <span class="token keyword">int</span><span class="token punctuation">;</span>
<span class="token keyword">set</span> <span class="token variable">@id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">exec</span> dbo<span class="token punctuation">.</span>GetUser <span class="token variable">@id</span><span class="token punctuation">,</span><span class="token variable">@name</span> <span class="token keyword">out</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token variable">@id</span><span class="token punctuation">,</span><span class="token variable">@name</span><span class="token punctuation">;</span>
<span class="token keyword">print</span> Cast<span class="token punctuation">(</span><span class="token variable">@id</span> <span class="token keyword">as</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&#39;-&#39;</span><span class="token operator">+</span><span class="token variable">@name</span><span class="token punctuation">;</span>


存储过程中事务的创建
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span>  sys<span class="token punctuation">.</span>objects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;JayJayToTest&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">drop</span> <span class="token keyword">proc</span> JayJayToTest
go 
<span class="token keyword">create</span> <span class="token keyword">proc</span> JayJayToTest
    <span class="token variable">@GiveMoney</span> <span class="token keyword">int</span><span class="token punctuation">,</span>
    <span class="token variable">@UserName</span> nvarchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">as</span> 
beginset nocount <span class="token keyword">on</span><span class="token punctuation">;</span>
    <span class="token keyword">begin</span> <span class="token keyword">tran</span><span class="token punctuation">;</span>
    <span class="token keyword">begin</span> try
        <span class="token keyword">update</span> BankTest <span class="token keyword">set</span> Money <span class="token operator">=</span> Money<span class="token operator">-</span><span class="token variable">@GiveMoney</span> <span class="token keyword">where</span> Name<span class="token operator">=</span><span class="token variable">@UserName</span><span class="token punctuation">;</span>
        <span class="token keyword">update</span> BankTest <span class="token keyword">set</span> Money <span class="token operator">=</span> Money<span class="token operator">+</span><span class="token variable">@GiveMoney</span> <span class="token keyword">where</span> Name<span class="token operator">=</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">;</span>
        <span class="token keyword">commit</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> try    
    <span class="token keyword">begin</span> catch        
        <span class="token keyword">rollback</span> <span class="token keyword">tran</span><span class="token punctuation">;</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&#39;发生异常，事务进行回滚&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">end</span> catch    
<span class="token keyword">end</span>
go
<span class="token keyword">exec</span> JayJayToTest <span class="token number">10</span><span class="token punctuation">,</span><span class="token string">&#39;jayjay&#39;</span>

存储过程详细解释：https:<span class="token comment">//www.cnblogs.com/sunniest/p/4386296.html</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="触发器" tabindex="-1"><a class="header-anchor" href="#触发器"><span>触发器</span></a></h2>`,7),b={href:"https://baike.baidu.com/item/%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B",target:"_blank",rel:"noopener noreferrer"},y=p(`<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token keyword">if</span>  <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span><span class="token keyword">databases</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;shopinfo&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> shopinfo
go

<span class="token keyword">create</span>  <span class="token keyword">database</span> shopinfo
go
<span class="token keyword">use</span> shopinfo
go
<span class="token keyword">create</span> <span class="token keyword">table</span> orderinfo
<span class="token punctuation">(</span>
  goodsid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  goodsname <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  salesamount <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  orderdate <span class="token keyword">datetime</span> 
<span class="token punctuation">)</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> stock
<span class="token punctuation">(</span>
  goodsid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
  stockamount <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> stock <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span>

<span class="token comment">---添加新增创建触发器-----</span>
<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;trigger_insert&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">trigger</span> trigger_insert
go
<span class="token keyword">create</span> <span class="token keyword">trigger</span>  trigger_insert
<span class="token keyword">on</span>  orderinfo
<span class="token keyword">for</span> <span class="token keyword">insert</span>
<span class="token keyword">as</span>
<span class="token keyword">declare</span> <span class="token variable">@goodsid</span> <span class="token keyword">int</span>
<span class="token keyword">declare</span> <span class="token variable">@ordercount</span> <span class="token keyword">int</span>
<span class="token keyword">select</span> <span class="token variable">@goodsid</span><span class="token operator">=</span>goodsid<span class="token punctuation">,</span><span class="token variable">@ordercount</span><span class="token operator">=</span>salesamount <span class="token keyword">from</span> inserted 
<span class="token keyword">update</span> stock <span class="token keyword">set</span> stockamount<span class="token operator">=</span>stockamount<span class="token operator">-</span><span class="token variable">@ordercount</span> <span class="token keyword">where</span> goodsid<span class="token operator">=</span><span class="token variable">@goodsid</span>
go
<span class="token keyword">set</span> nocount <span class="token keyword">on</span><span class="token comment">--不返回受影响行数</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> orderinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;mp3&#39;</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>getdate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">select</span><span class="token operator">*</span> <span class="token keyword">from</span> orderinfo
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stock

<span class="token comment">-------创建一个删除的触发器---------------------</span>
<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;trigger_delete&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">trigger</span> trigger_delete
go
<span class="token keyword">create</span>  <span class="token keyword">trigger</span> trigger_delete
<span class="token keyword">on</span> orderinfo
<span class="token keyword">for</span> <span class="token keyword">delete</span>
<span class="token keyword">as</span>
<span class="token keyword">print</span> <span class="token string">&#39;备份中.......&#39;</span>
<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;banckinfo&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> banckinfo <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> deleted
<span class="token keyword">end</span>
<span class="token keyword">else</span>
<span class="token keyword">begin</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">into</span> banckinfo <span class="token keyword">from</span> deleted
<span class="token keyword">end</span>

go
<span class="token keyword">set</span> nocount <span class="token keyword">on</span>

<span class="token keyword">delete</span> <span class="token keyword">from</span> orderinfo

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orderinfo

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> banckinfo

<span class="token comment">-----update触发器------</span>
<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;trigger_update&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">trigger</span> trigger_update
go
<span class="token keyword">create</span> <span class="token keyword">trigger</span> trigger_update
<span class="token keyword">on</span> stock
<span class="token keyword">for</span> <span class="token keyword">update</span>
<span class="token keyword">as</span>
<span class="token comment">----定义变量分别代表交易之前的量和交易之后的量</span>
<span class="token keyword">declare</span> <span class="token variable">@salecount</span> <span class="token keyword">int</span><span class="token comment">-------交易之前的量</span>
<span class="token keyword">declare</span> <span class="token variable">@stockcount</span> <span class="token keyword">int</span> <span class="token comment">-----交易之后的量</span>

<span class="token keyword">select</span> <span class="token variable">@salecount</span><span class="token operator">=</span>stockamount   <span class="token keyword">from</span>  deleted<span class="token comment">-----从删除临时表中得到交易之前的库存量</span>

<span class="token keyword">select</span> <span class="token variable">@stockcount</span><span class="token operator">=</span>stockamount <span class="token keyword">from</span> inserted <span class="token comment">------从新增临时表中得到交易之后的库存量</span>

<span class="token keyword">if</span> <span class="token variable">@stockcount</span><span class="token operator">&lt;</span><span class="token number">0</span>
 <span class="token keyword">begin</span> 
  <span class="token keyword">raiserror</span><span class="token punctuation">(</span><span class="token string">&#39;库存不足&#39;</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">rollback</span> <span class="token keyword">transaction</span> 
 <span class="token keyword">end</span>
go

<span class="token keyword">set</span> nocount <span class="token keyword">on</span>

<span class="token keyword">update</span> stock <span class="token keyword">set</span> stockamount<span class="token operator">=</span>stockamount<span class="token operator">-</span><span class="token number">50</span> <span class="token keyword">where</span> goodsid<span class="token operator">=</span><span class="token number">1</span>


<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stock



<span class="token comment">--------inseted of 触发器-----</span>

<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">&#39;trigger_insetedof&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">drop</span> <span class="token keyword">trigger</span> trigger_insetedof
go
<span class="token keyword">create</span> <span class="token keyword">trigger</span> trigger_insetedof
<span class="token keyword">on</span> stuinfo
instead <span class="token keyword">of</span> <span class="token keyword">delete</span>
<span class="token keyword">as</span>
<span class="token keyword">declare</span> <span class="token variable">@stuid</span> <span class="token keyword">int</span> 

<span class="token keyword">select</span>  <span class="token variable">@stuid</span><span class="token operator">=</span>stuid  <span class="token keyword">from</span>  deleted

<span class="token keyword">delete</span> <span class="token keyword">from</span> exam <span class="token keyword">where</span> stuid<span class="token operator">=</span><span class="token variable">@stuid</span>

<span class="token keyword">delete</span> <span class="token keyword">from</span> stuinfo <span class="token keyword">where</span> stuid<span class="token operator">=</span><span class="token variable">@stuid</span>

go

<span class="token keyword">set</span> nocount <span class="token keyword">on</span>



<span class="token comment">----</span>

<span class="token keyword">delete</span> <span class="token keyword">from</span> stuinfo <span class="token keyword">where</span> stuid<span class="token operator">=</span><span class="token number">1</span>



<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> stuinfo

<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> exam 

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+i+'" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2>',3),w={href:"https://blog.csdn.net/qq_42756590/article/details/119904117",target:"_blank",rel:"noopener noreferrer"},g={href:"https://mp.weixin.qq.com/s/Qh4ZsPrWi8JeEOeCQGygHg",target:"_blank",rel:"noopener noreferrer"};function h(_,N){const a=o("ExternalLinkIcon");return l(),c("div",null,[k,s("blockquote",null,[s("p",null,[n("参考资料 "),s("a",u,[n("https://www.cnblogs.com/wangguowen27/p/SqlServer_Select_wgw.html"),e(a)])])]),d,s("p",null,[n("视图是存储在数据库中的查询的SQL 语句，它主要出于两种原因：安全原因， 视图可以隐藏一些数据，如："),s("a",v,[n("社会保险基金"),e(a)]),n("表，可以用视图只显示姓名，地址，而不显示社会保险号和工资数等，另一原因是可使复杂的查询易于理解和使用。")]),m,s("p",null,[n("触发器是与表事件相关的特殊的"),s("a",b,[n("存储过程"),e(a)]),n("，它的执行不是由程序调用，也不是手工启动，而是由事件来触发")]),y,s("p",null,[s("a",w,[n("https://blog.csdn.net/qq_42756590/article/details/119904117"),e(a)]),n(" 修改表结构，增加注释等等 四大事务隔离级别原理："),s("a",g,[n("https://mp.weixin.qq.com/s/Qh4ZsPrWi8JeEOeCQGygHg"),e(a)])])])}const S=t(r,[["render",h],["__file","operation.html.vue"]]),q=JSON.parse(`{"path":"/dataBase/sqlserver/base/operation.html","title":"基础操作","lang":"zh-CN","frontmatter":{"title":"基础操作","lang":"zh-CN","date":"2023-09-23T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dataBase"],"tag":["无"],"filename":"jichucaozuo","slug":"eiw29x","docsId":"78355755","description":"系统操作 数据库版本 检索执行SQL时间 参考资料 https://www.cnblogs.com/wangguowen27/p/SqlServer_Select_wgw.html 连接数 表结构 磁盘统计 资料：https://www.cnblogs.com/gered/p/9009513.html 程序连接 .Net连接 使用Nuget包Micro...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dataBase/sqlserver/base/operation.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"基础操作"}],["meta",{"property":"og:description","content":"系统操作 数据库版本 检索执行SQL时间 参考资料 https://www.cnblogs.com/wangguowen27/p/SqlServer_Select_wgw.html 连接数 表结构 磁盘统计 资料：https://www.cnblogs.com/gered/p/9009513.html 程序连接 .Net连接 使用Nuget包Micro..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/common/1609039130466-8deaa803-2249-40ac-972f-9bc44f6ef339.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-09T06:18:23.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-09-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-09T06:18:23.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"基础操作\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/common/1609039130466-8deaa803-2249-40ac-972f-9bc44f6ef339.png\\"],\\"datePublished\\":\\"2023-09-23T00:00:00.000Z\\",\\"dateModified\\":\\"2024-04-09T06:18:23.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"系统操作","slug":"系统操作","link":"#系统操作","children":[{"level":3,"title":"数据库版本","slug":"数据库版本","link":"#数据库版本","children":[]},{"level":3,"title":"检索执行SQL时间","slug":"检索执行sql时间","link":"#检索执行sql时间","children":[]},{"level":3,"title":"连接数","slug":"连接数","link":"#连接数","children":[]},{"level":3,"title":"表结构","slug":"表结构","link":"#表结构","children":[]},{"level":3,"title":"磁盘统计","slug":"磁盘统计","link":"#磁盘统计","children":[]}]},{"level":2,"title":"程序连接","slug":"程序连接","link":"#程序连接","children":[{"level":3,"title":".Net连接","slug":"net连接","link":"#net连接","children":[]}]},{"level":2,"title":"数据库","slug":"数据库","link":"#数据库","children":[]},{"level":2,"title":"表","slug":"表","link":"#表","children":[{"level":3,"title":"操作表","slug":"操作表","link":"#操作表","children":[]},{"level":3,"title":"查询","slug":"查询","link":"#查询","children":[{"level":4,"title":"联合查询","slug":"联合查询","link":"#联合查询","children":[]},{"level":4,"title":"分页","slug":"分页","link":"#分页","children":[]},{"level":4,"title":"SQL结构","slug":"sql结构","link":"#sql结构","children":[]},{"level":4,"title":"存储过程","slug":"存储过程","link":"#存储过程","children":[]}]},{"level":3,"title":"添加数据","slug":"添加数据","link":"#添加数据","children":[]},{"level":3,"title":"更新数据","slug":"更新数据","link":"#更新数据","children":[]},{"level":3,"title":"删除数据","slug":"删除数据","link":"#删除数据","children":[]},{"level":3,"title":"约束","slug":"约束","link":"#约束","children":[]}]},{"level":2,"title":"游标","slug":"游标","link":"#游标","children":[]},{"level":2,"title":"函数","slug":"函数","link":"#函数","children":[{"level":3,"title":"标量函数","slug":"标量函数","link":"#标量函数","children":[]},{"level":3,"title":"表格值函数","slug":"表格值函数","link":"#表格值函数","children":[{"level":4,"title":"内联表格值函数","slug":"内联表格值函数","link":"#内联表格值函数","children":[]},{"level":4,"title":"多句表格值函数","slug":"多句表格值函数","link":"#多句表格值函数","children":[]}]}]},{"level":2,"title":"视图","slug":"视图","link":"#视图","children":[]},{"level":2,"title":"事务","slug":"事务","link":"#事务","children":[]},{"level":2,"title":"存储过程","slug":"存储过程-1","link":"#存储过程-1","children":[]},{"level":2,"title":"触发器","slug":"触发器","link":"#触发器","children":[]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[]}],"git":{"createdTime":1695484404000,"updatedTime":1712643503000,"contributors":[{"name":"zhangyunpeng","email":"zhang.yunpeng@synyi.com","commits":4},{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":16.09,"words":4826},"filePathRelative":"dataBase/sqlserver/base/operation.md","localizedDate":"2023年9月23日","excerpt":"<h2>系统操作</h2>\\n<h3>数据库版本</h3>\\n<div class=\\"language-sql\\" data-ext=\\"sql\\" data-title=\\"sql\\"><pre class=\\"language-sql\\"><code><span class=\\"token comment\\">-- 查看数据库版本</span>\\n<span class=\\"token keyword\\">select</span> @<span class=\\"token variable\\">@version</span>\\n</code></pre></div><h3>检索执行SQL时间</h3>\\n<div class=\\"language-sql\\" data-ext=\\"sql\\" data-title=\\"sql\\"><pre class=\\"language-sql\\"><code><span class=\\"token keyword\\">declare</span> <span class=\\"token variable\\">@begin_date</span> <span class=\\"token keyword\\">datetime</span> \\n<span class=\\"token keyword\\">declare</span> <span class=\\"token variable\\">@end_date</span> <span class=\\"token keyword\\">datetime</span> \\n<span class=\\"token keyword\\">select</span> <span class=\\"token variable\\">@begin_date</span> <span class=\\"token operator\\">=</span> getdate<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> \\n<span class=\\"token comment\\">-----------需要执行的sql语句</span>\\n<span class=\\"token keyword\\">select</span> AC_ID <span class=\\"token keyword\\">from</span> <span class=\\"token punctuation\\">[</span>dbo<span class=\\"token punctuation\\">]</span><span class=\\"token punctuation\\">.</span><span class=\\"token punctuation\\">[</span>ys_tb_Collection51<span class=\\"token punctuation\\">]</span> <span class=\\"token keyword\\">where</span> AC_ID<span class=\\"token operator\\">=</span><span class=\\"token number\\">4273</span>  <span class=\\"token operator\\">or</span> AC_ID<span class=\\"token operator\\">=</span><span class=\\"token number\\">4274</span>\\n<span class=\\"token comment\\">----------</span>\\n<span class=\\"token keyword\\">select</span> <span class=\\"token variable\\">@end_date</span> <span class=\\"token operator\\">=</span> getdate<span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> \\n<span class=\\"token keyword\\">select</span> datediff<span class=\\"token punctuation\\">(</span>ms<span class=\\"token punctuation\\">,</span><span class=\\"token variable\\">@begin_date</span><span class=\\"token punctuation\\">,</span><span class=\\"token variable\\">@end_date</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">as</span> <span class=\\"token string\\">'用时/毫秒'</span>\\n\\n<span class=\\"token comment\\">-- sqlserver查询慢sql  </span>\\n<span class=\\"token keyword\\">SELECT</span> t<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">text</span><span class=\\"token punctuation\\">,</span>\\n       <span class=\\"token punctuation\\">(</span>qs<span class=\\"token punctuation\\">.</span>total_elapsed_time <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count                                                          <span class=\\"token keyword\\">AS</span> avg_elapsed_time<span class=\\"token punctuation\\">,</span>\\n       <span class=\\"token punctuation\\">(</span>qs<span class=\\"token punctuation\\">.</span>total_worker_time <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count                                                           <span class=\\"token keyword\\">AS</span> avg_cpu_time<span class=\\"token punctuation\\">,</span>\\n       <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>qs<span class=\\"token punctuation\\">.</span>total_elapsed_time <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">-</span>\\n       <span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span>qs<span class=\\"token punctuation\\">.</span>total_worker_time <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count<span class=\\"token punctuation\\">)</span>                                                         <span class=\\"token keyword\\">AS</span> avg_wait_time<span class=\\"token punctuation\\">,</span>\\n       qs<span class=\\"token punctuation\\">.</span>total_logical_reads <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count                                                                  <span class=\\"token keyword\\">AS</span> avg_logical_reads<span class=\\"token punctuation\\">,</span>\\n       qs<span class=\\"token punctuation\\">.</span>total_logical_writes <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count                                                                 <span class=\\"token keyword\\">AS</span> avg_writes<span class=\\"token punctuation\\">,</span>\\n       <span class=\\"token punctuation\\">(</span>qs<span class=\\"token punctuation\\">.</span>total_elapsed_time <span class=\\"token operator\\">/</span> <span class=\\"token number\\">1000</span><span class=\\"token punctuation\\">)</span>                                                                               <span class=\\"token keyword\\">AS</span> cumulative_elapsed_time_all_executions\\n<span class=\\"token keyword\\">FROM</span> sys<span class=\\"token punctuation\\">.</span>dm_exec_query_stats qs\\n         <span class=\\"token keyword\\">CROSS</span> <span class=\\"token keyword\\">apply</span> sys<span class=\\"token punctuation\\">.</span>Dm_exec_sql_text <span class=\\"token punctuation\\">(</span>sql_handle<span class=\\"token punctuation\\">)</span> t\\n<span class=\\"token keyword\\">WHERE</span> t<span class=\\"token punctuation\\">.</span><span class=\\"token keyword\\">text</span> <span class=\\"token operator\\">like</span> <span class=\\"token string\\">'%具体的表名%'</span>\\n  <span class=\\"token operator\\">and</span> qs<span class=\\"token punctuation\\">.</span>creation_time\\n    <span class=\\"token operator\\">&gt;</span> <span class=\\"token string\\">'2023-12-05 16:00:00'</span>\\n<span class=\\"token keyword\\">ORDER</span> <span class=\\"token keyword\\">BY</span> <span class=\\"token punctuation\\">(</span>qs<span class=\\"token punctuation\\">.</span>total_elapsed_time <span class=\\"token operator\\">/</span> qs<span class=\\"token punctuation\\">.</span>execution_count<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">DESC</span>\\n</code></pre></div>","autoDesc":true}`);export{S as comp,q as data};
