import{_ as t}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as o,o as e,c,a as s,d as n,e as p,b as l}from"./app-qB9_Bjjp.js";const u="/kbms/common/1619275723568-76314154-3a86-4dfc-8ded-e3a55a17f645.png",i="/kbms/common/1619275723493-dd3526a5-9584-489c-8457-e982ed15c82b.webp",k="/kbms/common/1619275723682-5352ef15-55d6-42aa-8359-7b00123d9b69.webp",r="/kbms/common/1619275723610-0ee8d117-ecca-488e-bdfc-6d493076bb61.webp",d={},m=l(`<h2 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h2><h3 id="发放优惠券" tabindex="-1"><a class="header-anchor" href="#发放优惠券"><span>发放优惠券</span></a></h3><p>大体就是用户有一些优惠券，系统会根据用户订单情况，筛选可以使用的优惠券供用户选择，用户选择后会计算出优惠后金额。</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token namespace">Microsoft<span class="token punctuation">.</span>Extensions<span class="token punctuation">.</span>Logging</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">RulesEngine<span class="token punctuation">.</span>Extensions</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">RulesEngine<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>CompilerServices</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">RulesEngineSample<span class="token punctuation">.</span>Services</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CouponService</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICouponService</span></span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ILogger<span class="token punctuation">&lt;</span>CouponService<span class="token punctuation">&gt;</span></span> _logger<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">List<span class="token punctuation">&lt;</span>Coupon<span class="token punctuation">&gt;</span></span> _userCoupons<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">Order</span> _order<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">User</span> _user<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token function">CouponService</span><span class="token punctuation">(</span><span class="token class-name">ILogger<span class="token punctuation">&lt;</span>CouponService<span class="token punctuation">&gt;</span></span> logger<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _logger <span class="token operator">=</span> logger<span class="token punctuation">;</span>
            <span class="token comment">//假装用户用的优惠券</span>
            _userCoupons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Coupon<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coupon</span>
                <span class="token punctuation">{</span>
                    ID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    Code<span class="token operator">=</span><span class="token string">&quot;YH01&quot;</span><span class="token punctuation">,</span>
                    Name <span class="token operator">=</span> <span class="token string">&quot;满500减20&quot;</span><span class="token punctuation">,</span>
                    BeginTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2021-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    EndTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2021-06-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Expression <span class="token operator">=</span> <span class="token string">&quot;input1.Details.Sum(s =&gt; s.Price * Convert.ToDecimal(s.Quantity))&gt;= 500&quot;</span><span class="token punctuation">,</span>
                    Symbol<span class="token operator">=</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span>
                    Number<span class="token operator">=</span><span class="token number">20</span>

                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coupon</span>
                <span class="token punctuation">{</span>
                    ID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                    Code<span class="token operator">=</span><span class="token string">&quot;YH02&quot;</span><span class="token punctuation">,</span>
                    Name <span class="token operator">=</span> <span class="token string">&quot;新人5元券&quot;</span><span class="token punctuation">,</span>
                    BeginTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2021-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    EndTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2021-06-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Expression <span class="token operator">=</span> <span class="token string">&quot;input1.Details.Count&gt;0&quot;</span><span class="token punctuation">,</span>
                    Symbol<span class="token operator">=</span><span class="token string">&quot;-&quot;</span><span class="token punctuation">,</span>
                    Number<span class="token operator">=</span><span class="token number">5</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coupon</span>
                <span class="token punctuation">{</span>
                    ID <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                    Code<span class="token operator">=</span><span class="token string">&quot;YH03&quot;</span><span class="token punctuation">,</span>
                    Name <span class="token operator">=</span> <span class="token string">&quot;商品C五折&quot;</span><span class="token punctuation">,</span>
                    BeginTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2021-01-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    EndTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;2021-06-01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Expression <span class="token operator">=</span> <span class="token string">&quot;input1.Details.Where(s=&gt;s.GoodsID==\\&quot;SP0000003\\&quot;).Count()&gt;0&quot;</span><span class="token punctuation">,</span>
                    Symbol<span class="token operator">=</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span>
                    Number<span class="token operator">=</span><span class="token number">0.5f</span><span class="token punctuation">,</span>
                    GoodsID<span class="token operator">=</span><span class="token string">&quot;SP0000003&quot;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//假装当前用户的订单</span>
            _order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Order</span>
            <span class="token punctuation">{</span>
                OrderNo <span class="token operator">=</span> <span class="token string">&quot;NO00000001&quot;</span><span class="token punctuation">,</span>
                OrderTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
                Details <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Detail<span class="token punctuation">&gt;</span></span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Detail</span><span class="token punctuation">{</span> GoodsID<span class="token operator">=</span><span class="token string">&quot;SP0000001&quot;</span><span class="token punctuation">,</span> Name<span class="token operator">=</span><span class="token string">&quot;商品A&quot;</span><span class="token punctuation">,</span> Price<span class="token operator">=</span><span class="token number">12.5m</span><span class="token punctuation">,</span> Quantity<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Detail</span><span class="token punctuation">{</span> GoodsID<span class="token operator">=</span><span class="token string">&quot;SP0000002&quot;</span><span class="token punctuation">,</span> Name<span class="token operator">=</span><span class="token string">&quot;商品B&quot;</span><span class="token punctuation">,</span> Price<span class="token operator">=</span><span class="token number">100m</span><span class="token punctuation">,</span> Quantity<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Detail</span><span class="token punctuation">{</span> GoodsID<span class="token operator">=</span><span class="token string">&quot;SP0000003&quot;</span><span class="token punctuation">,</span> Name<span class="token operator">=</span><span class="token string">&quot;商品C&quot;</span><span class="token punctuation">,</span> Price<span class="token operator">=</span><span class="token number">22.3m</span><span class="token punctuation">,</span> Quantity<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            _user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span> <span class="token punctuation">{</span> ID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> UserName <span class="token operator">=</span> <span class="token string">&quot;zhangsan&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// 适配优惠券</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">SelectCouponAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> workRules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RulesEngine<span class="token punctuation">.</span>Models<span class="token punctuation">.</span>WorkflowRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            workRules<span class="token punctuation">.</span>WorkflowName <span class="token operator">=</span> <span class="token string">&quot;优惠券&quot;</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> rules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>Rule<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> coupon <span class="token keyword">in</span> _userCoupons<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>BeginTime <span class="token operator">&lt;</span> DateTime<span class="token punctuation">.</span>Now <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">.</span>EndTime <span class="token operator">&gt;</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> rule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rule</span>
                <span class="token punctuation">{</span>
                    RuleName <span class="token operator">=</span> coupon<span class="token punctuation">.</span>Name<span class="token punctuation">,</span>
                    SuccessEvent <span class="token operator">=</span> coupon<span class="token punctuation">.</span>Code<span class="token punctuation">,</span>
                    ErrorMessage <span class="token operator">=</span> <span class="token string">&quot;规则应用失败&quot;</span><span class="token punctuation">,</span>
                    ErrorType <span class="token operator">=</span> ErrorType<span class="token punctuation">.</span>Error<span class="token punctuation">,</span>
                    RuleExpressionType <span class="token operator">=</span> RuleExpressionType<span class="token punctuation">.</span>LambdaExpression<span class="token punctuation">,</span>
                    Expression <span class="token operator">=</span> coupon<span class="token punctuation">.</span>Expression
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                rules<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>rule<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            workRules<span class="token punctuation">.</span>Rules <span class="token operator">=</span> rules<span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> rulesEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">RulesEngine<span class="token punctuation">.</span>RulesEngine</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">WorkflowRules<span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> workRules <span class="token punctuation">}</span><span class="token punctuation">,</span> _logger<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ReSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> ruleResults <span class="token operator">=</span> <span class="token keyword">await</span> rulesEngine<span class="token punctuation">.</span><span class="token function">ExecuteAllRulesAsync</span><span class="token punctuation">(</span><span class="token string">&quot;优惠券&quot;</span><span class="token punctuation">,</span> _order<span class="token punctuation">,</span> _user<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// var valueCoupons = new List&lt;string&gt;();</span>
            <span class="token comment">//处理结果</span>
            <span class="token class-name"><span class="token keyword">var</span></span> discountCoupons <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> ruleResult <span class="token keyword">in</span> ruleResults<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>ruleResult<span class="token punctuation">.</span>IsSuccess<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    discountCoupons<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$&quot;可以使用的优惠券 “</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_userCoupons<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Code <span class="token operator">==</span> ruleResult<span class="token punctuation">.</span>Rule<span class="token punctuation">.</span>SuccessEvent<span class="token punctuation">)</span><span class="token punctuation">?.</span>Name</span><span class="token punctuation">}</span></span><span class="token string">”, Code是：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">ruleResult<span class="token punctuation">.</span>Rule<span class="token punctuation">.</span>SuccessEvent</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//valueCoupons.Add(ruleResult.Rule.SuccessEvent);</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//resultList.OnSuccess((eventName) =&gt;</span>
            <span class="token comment">//{</span>
            <span class="token comment">//    discountOffered += $&quot;可以使用的优惠券“{userCoupons.SingleOrDefault(s =&gt; s.Code == eventName)?.Name}”,Code是：{eventName} &quot;;</span>
            <span class="token comment">//});</span>
            ruleResults<span class="token punctuation">.</span><span class="token function">OnFail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                discountCoupons<span class="token punctuation">.</span><span class="token function">AppendLine</span><span class="token punctuation">(</span><span class="token string">&quot;您没有适合的优惠券！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> discountCoupons<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// 计算订单支付总额</span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>summary</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>code<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token doc-comment comment">/// <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>returns</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>returns</span><span class="token punctuation">&gt;</span></span></span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">GetOrderAmount</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> code<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>            
            <span class="token class-name"><span class="token keyword">var</span></span> selectCoupon <span class="token operator">=</span> _userCoupons<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Code <span class="token operator">==</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> orderAmount <span class="token operator">=</span> <span class="token number">0m</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>selectCoupon<span class="token punctuation">.</span>Symbol<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token string">&quot;-&quot;</span><span class="token punctuation">:</span>
                    orderAmount <span class="token operator">=</span> _order<span class="token punctuation">.</span>Details<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Price <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>Quantity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>selectCoupon<span class="token punctuation">.</span>Number<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>selectCoupon<span class="token punctuation">.</span>GoodsID<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        orderAmount <span class="token operator">=</span> _order<span class="token punctuation">.</span>Details<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Price <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>Quantity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name"><span class="token keyword">var</span></span> detail <span class="token operator">=</span> _order<span class="token punctuation">.</span>Details<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>GoodsID <span class="token operator">==</span> selectCoupon<span class="token punctuation">.</span>GoodsID<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>detail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            orderAmount <span class="token operator">-=</span> detail<span class="token punctuation">.</span>Price <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>detail<span class="token punctuation">.</span>Quantity<span class="token punctuation">)</span> <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> selectCoupon<span class="token punctuation">.</span>Number<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        orderAmount <span class="token operator">=</span> _order<span class="token punctuation">.</span>Details<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Price <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>Quantity<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>selectCoupon<span class="token punctuation">.</span>Number<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">$&quot;订单总金额：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_order<span class="token punctuation">.</span>Details<span class="token punctuation">.</span><span class="token function">Sum</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span>Price <span class="token operator">*</span> Convert<span class="token punctuation">.</span><span class="token function">ToDecimal</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>Quantity<span class="token punctuation">)</span><span class="token punctuation">)</span> </span><span class="token punctuation">}</span></span><span class="token string">，优惠后请支付：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">orderAmount</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Coupon</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Code <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> BeginTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> EndTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Expression <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Symbol <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> Number <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> GoodsID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> ID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> OrderNo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> OrderTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>Detail<span class="token punctuation">&gt;</span></span> Details <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Detail</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> GoodsID <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">float</span></span> Quantity <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Price <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>api  /selectcoupon是查询可使用的优惠券 <img src="`+u+'" alt="" loading="lazy"></p><p>/getamount 按优惠券code，计算本次订单的应付金额：</p><p>优惠券YH01 <img src="'+i+'" alt="" loading="lazy"></p><p>优惠券YH02 <img src="'+k+'" alt="" loading="lazy"></p><p>优惠券YH03 <img src="'+r+'" alt="" loading="lazy"></p><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2>',10),v={href:"https://mp.weixin.qq.com/s/X0p4tVpmYTjWw2xTfcJ7Wg",target:"_blank",rel:"noopener noreferrer"},g={href:"https://mp.weixin.qq.com/s/OG0o3OKWS6-7a0eATp_ixw",target:"_blank",rel:"noopener noreferrer"},y=s("p",null,"https://mp.weixin.qq.com/s/yDJXXH61vcVjmxd5xCi0TQ | C# 规则引擎 RulesEngine",-1);function w(b,f){const a=o("ExternalLinkIcon");return e(),c("div",null,[m,s("p",null,[n("规则引擎库："),s("a",v,[n("https://mp.weixin.qq.com/s/X0p4tVpmYTjWw2xTfcJ7Wg"),p(a)]),s("a",g,[n("https://mp.weixin.qq.com/s/OG0o3OKWS6-7a0eATp_ixw"),p(a)]),n(" | C# 规则引擎 RulesEngine")]),y])}const T=t(d,[["render",w],["__file","rulesengine.html.vue"]]),q=JSON.parse('{"path":"/middleware/guizeyinqing/rulesengine.html","title":"RulesEngine","lang":"zh-CN","frontmatter":{"title":"RulesEngine","lang":"zh-CN","date":"2023-09-10T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["middleware"],"tag":["无"],"filename":"rulesengine","slug":"gaxe65","docsId":"44227660","description":"示例 发放优惠券 大体就是用户有一些优惠券，系统会根据用户订单情况，筛选可以使用的优惠券供用户选择，用户选择后会计算出优惠后金额。 api /selectcoupon是查询可使用的优惠券 /getamount 按优惠券code，计算本次订单的应付金额： 优惠券YH01 优惠券YH02 优惠券YH03 资料 规则引擎库：https://mp.weixin...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/middleware/guizeyinqing/rulesengine.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"RulesEngine"}],["meta",{"property":"og:description","content":"示例 发放优惠券 大体就是用户有一些优惠券，系统会根据用户订单情况，筛选可以使用的优惠券供用户选择，用户选择后会计算出优惠后金额。 api /selectcoupon是查询可使用的优惠券 /getamount 按优惠券code，计算本次订单的应付金额： 优惠券YH01 优惠券YH02 优惠券YH03 资料 规则引擎库：https://mp.weixin..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/common/1619275723568-76314154-3a86-4dfc-8ded-e3a55a17f645.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-01-01T06:04:02.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-09-10T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-01-01T06:04:02.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"RulesEngine\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/common/1619275723568-76314154-3a86-4dfc-8ded-e3a55a17f645.png\\",\\"https://azrng.gitee.io/kbms/kbms/common/1619275723493-dd3526a5-9584-489c-8457-e982ed15c82b.webp\\",\\"https://azrng.gitee.io/kbms/kbms/common/1619275723682-5352ef15-55d6-42aa-8359-7b00123d9b69.webp\\",\\"https://azrng.gitee.io/kbms/kbms/common/1619275723610-0ee8d117-ecca-488e-bdfc-6d493076bb61.webp\\"],\\"datePublished\\":\\"2023-09-10T00:00:00.000Z\\",\\"dateModified\\":\\"2024-01-01T06:04:02.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"示例","slug":"示例","link":"#示例","children":[{"level":3,"title":"发放优惠券","slug":"发放优惠券","link":"#发放优惠券","children":[]}]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[]}],"git":{"createdTime":1697724028000,"updatedTime":1704089042000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":2}]},"readingTime":{"minutes":2.55,"words":766},"filePathRelative":"middleware/guizeyinqing/rulesengine.md","localizedDate":"2023年9月10日","excerpt":"<h2>示例</h2>\\n<h3>发放优惠券</h3>\\n<p>大体就是用户有一些优惠券，系统会根据用户订单情况，筛选可以使用的优惠券供用户选择，用户选择后会计算出优惠后金额。</p>\\n<div class=\\"language-csharp\\" data-ext=\\"cs\\" data-title=\\"cs\\"><pre class=\\"language-csharp\\"><code><span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">Microsoft<span class=\\"token punctuation\\">.</span>Extensions<span class=\\"token punctuation\\">.</span>Logging</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">RulesEngine<span class=\\"token punctuation\\">.</span>Extensions</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">RulesEngine<span class=\\"token punctuation\\">.</span>Models</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">System</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">System<span class=\\"token punctuation\\">.</span>Collections<span class=\\"token punctuation\\">.</span>Generic</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">System<span class=\\"token punctuation\\">.</span>Linq</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">System<span class=\\"token punctuation\\">.</span>Runtime<span class=\\"token punctuation\\">.</span>CompilerServices</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">System<span class=\\"token punctuation\\">.</span>Text</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">using</span> <span class=\\"token namespace\\">System<span class=\\"token punctuation\\">.</span>Threading<span class=\\"token punctuation\\">.</span>Tasks</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">namespace</span> <span class=\\"token namespace\\">RulesEngineSample<span class=\\"token punctuation\\">.</span>Services</span>\\n<span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">CouponService</span> <span class=\\"token punctuation\\">:</span> <span class=\\"token type-list\\"><span class=\\"token class-name\\">ICouponService</span></span>\\n    <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">readonly</span> <span class=\\"token class-name\\">ILogger<span class=\\"token punctuation\\">&lt;</span>CouponService<span class=\\"token punctuation\\">&gt;</span></span> _logger<span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">readonly</span> <span class=\\"token class-name\\">List<span class=\\"token punctuation\\">&lt;</span>Coupon<span class=\\"token punctuation\\">&gt;</span></span> _userCoupons<span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">readonly</span> <span class=\\"token class-name\\">Order</span> _order<span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">private</span> <span class=\\"token keyword\\">readonly</span> <span class=\\"token class-name\\">User</span> _user<span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token function\\">CouponService</span><span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\">ILogger<span class=\\"token punctuation\\">&lt;</span>CouponService<span class=\\"token punctuation\\">&gt;</span></span> logger<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token punctuation\\">{</span>\\n            _logger <span class=\\"token operator\\">=</span> logger<span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token comment\\">//假装用户用的优惠券</span>\\n            _userCoupons <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">List<span class=\\"token punctuation\\">&lt;</span>Coupon<span class=\\"token punctuation\\">&gt;</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Coupon</span>\\n                <span class=\\"token punctuation\\">{</span>\\n                    ID <span class=\\"token operator\\">=</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span>\\n                    Code<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"YH01\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Name <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"满500减20\\"</span><span class=\\"token punctuation\\">,</span>\\n                    BeginTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Parse</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"2021-01-01\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n                    EndTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Parse</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"2021-06-01\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n                    Expression <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"input1.Details.Sum(s =&gt; s.Price * Convert.ToDecimal(s.Quantity))&gt;= 500\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Symbol<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"-\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Number<span class=\\"token operator\\">=</span><span class=\\"token number\\">20</span>\\n\\n                <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n                <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Coupon</span>\\n                <span class=\\"token punctuation\\">{</span>\\n                    ID <span class=\\"token operator\\">=</span> <span class=\\"token number\\">2</span><span class=\\"token punctuation\\">,</span>\\n                    Code<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"YH02\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Name <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"新人5元券\\"</span><span class=\\"token punctuation\\">,</span>\\n                    BeginTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Parse</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"2021-01-01\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n                    EndTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Parse</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"2021-06-01\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n                    Expression <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"input1.Details.Count&gt;0\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Symbol<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"-\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Number<span class=\\"token operator\\">=</span><span class=\\"token number\\">5</span>\\n                <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n                <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Coupon</span>\\n                <span class=\\"token punctuation\\">{</span>\\n                    ID <span class=\\"token operator\\">=</span> <span class=\\"token number\\">3</span><span class=\\"token punctuation\\">,</span>\\n                    Code<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"YH03\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Name <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"商品C五折\\"</span><span class=\\"token punctuation\\">,</span>\\n                    BeginTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Parse</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"2021-01-01\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n                    EndTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Parse</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"2021-06-01\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span>\\n                    Expression <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"input1.Details.Where(s=&gt;s.GoodsID==\\\\\\"SP0000003\\\\\\").Count()&gt;0\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Symbol<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"*\\"</span><span class=\\"token punctuation\\">,</span>\\n                    Number<span class=\\"token operator\\">=</span><span class=\\"token number\\">0.5f</span><span class=\\"token punctuation\\">,</span>\\n                    GoodsID<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"SP0000003\\"</span>\\n                <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n            <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token comment\\">//假装当前用户的订单</span>\\n            _order <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Order</span>\\n            <span class=\\"token punctuation\\">{</span>\\n                OrderNo <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"NO00000001\\"</span><span class=\\"token punctuation\\">,</span>\\n                OrderTime <span class=\\"token operator\\">=</span> DateTime<span class=\\"token punctuation\\">.</span>Now<span class=\\"token punctuation\\">,</span>\\n                Details <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">List<span class=\\"token punctuation\\">&lt;</span>Detail<span class=\\"token punctuation\\">&gt;</span></span>\\n                <span class=\\"token punctuation\\">{</span>\\n                    <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Detail</span><span class=\\"token punctuation\\">{</span> GoodsID<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"SP0000001\\"</span><span class=\\"token punctuation\\">,</span> Name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"商品A\\"</span><span class=\\"token punctuation\\">,</span> Price<span class=\\"token operator\\">=</span><span class=\\"token number\\">12.5m</span><span class=\\"token punctuation\\">,</span> Quantity<span class=\\"token operator\\">=</span><span class=\\"token number\\">3</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n                    <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Detail</span><span class=\\"token punctuation\\">{</span> GoodsID<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"SP0000002\\"</span><span class=\\"token punctuation\\">,</span> Name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"商品B\\"</span><span class=\\"token punctuation\\">,</span> Price<span class=\\"token operator\\">=</span><span class=\\"token number\\">100m</span><span class=\\"token punctuation\\">,</span> Quantity<span class=\\"token operator\\">=</span><span class=\\"token number\\">4</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n                    <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Detail</span><span class=\\"token punctuation\\">{</span> GoodsID<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"SP0000003\\"</span><span class=\\"token punctuation\\">,</span> Name<span class=\\"token operator\\">=</span><span class=\\"token string\\">\\"商品C\\"</span><span class=\\"token punctuation\\">,</span> Price<span class=\\"token operator\\">=</span><span class=\\"token number\\">22.3m</span><span class=\\"token punctuation\\">,</span> Quantity<span class=\\"token operator\\">=</span><span class=\\"token number\\">5</span><span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span>\\n                <span class=\\"token punctuation\\">}</span>\\n            <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\n            _user <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">User</span> <span class=\\"token punctuation\\">{</span> ID <span class=\\"token operator\\">=</span> <span class=\\"token number\\">1</span><span class=\\"token punctuation\\">,</span> UserName <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"zhangsan\\"</span> <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>summary</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token doc-comment comment\\">/// 适配优惠券</span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>summary</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>returns</span><span class=\\"token punctuation\\">&gt;</span></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>returns</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">async</span> <span class=\\"token return-type class-name\\">Task<span class=\\"token punctuation\\">&lt;</span><span class=\\"token keyword\\">string</span><span class=\\"token punctuation\\">&gt;</span></span> <span class=\\"token function\\">SelectCouponAsync</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token punctuation\\">{</span>\\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> workRules <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">RulesEngine<span class=\\"token punctuation\\">.</span>Models<span class=\\"token punctuation\\">.</span>WorkflowRules</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            workRules<span class=\\"token punctuation\\">.</span>WorkflowName <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"优惠券\\"</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> rules <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">List<span class=\\"token punctuation\\">&lt;</span>Rule<span class=\\"token punctuation\\">&gt;</span></span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token keyword\\">foreach</span> <span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> coupon <span class=\\"token keyword\\">in</span> _userCoupons<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Where</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>BeginTime <span class=\\"token operator\\">&lt;</span> DateTime<span class=\\"token punctuation\\">.</span>Now <span class=\\"token operator\\">&amp;&amp;</span> s<span class=\\"token punctuation\\">.</span>EndTime <span class=\\"token operator\\">&gt;</span> DateTime<span class=\\"token punctuation\\">.</span>Now<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n            <span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> rule <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">Rule</span>\\n                <span class=\\"token punctuation\\">{</span>\\n                    RuleName <span class=\\"token operator\\">=</span> coupon<span class=\\"token punctuation\\">.</span>Name<span class=\\"token punctuation\\">,</span>\\n                    SuccessEvent <span class=\\"token operator\\">=</span> coupon<span class=\\"token punctuation\\">.</span>Code<span class=\\"token punctuation\\">,</span>\\n                    ErrorMessage <span class=\\"token operator\\">=</span> <span class=\\"token string\\">\\"规则应用失败\\"</span><span class=\\"token punctuation\\">,</span>\\n                    ErrorType <span class=\\"token operator\\">=</span> ErrorType<span class=\\"token punctuation\\">.</span>Error<span class=\\"token punctuation\\">,</span>\\n                    RuleExpressionType <span class=\\"token operator\\">=</span> RuleExpressionType<span class=\\"token punctuation\\">.</span>LambdaExpression<span class=\\"token punctuation\\">,</span>\\n                    Expression <span class=\\"token operator\\">=</span> coupon<span class=\\"token punctuation\\">.</span>Expression\\n                <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">;</span>\\n                rules<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Add</span><span class=\\"token punctuation\\">(</span>rule<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token punctuation\\">}</span>\\n            workRules<span class=\\"token punctuation\\">.</span>Rules <span class=\\"token operator\\">=</span> rules<span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> rulesEngine <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">RulesEngine<span class=\\"token punctuation\\">.</span>RulesEngine</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">WorkflowRules<span class=\\"token punctuation\\">[</span><span class=\\"token punctuation\\">]</span></span> <span class=\\"token punctuation\\">{</span> workRules <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">,</span> _logger<span class=\\"token punctuation\\">,</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">ReSettings</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> ruleResults <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">await</span> rulesEngine<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ExecuteAllRulesAsync</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"优惠券\\"</span><span class=\\"token punctuation\\">,</span> _order<span class=\\"token punctuation\\">,</span> _user<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n           <span class=\\"token comment\\">// var valueCoupons = new List&lt;string&gt;();</span>\\n            <span class=\\"token comment\\">//处理结果</span>\\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> discountCoupons <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">new</span> <span class=\\"token constructor-invocation class-name\\">StringBuilder</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token keyword\\">foreach</span> <span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> ruleResult <span class=\\"token keyword\\">in</span> ruleResults<span class=\\"token punctuation\\">)</span>\\n            <span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>ruleResult<span class=\\"token punctuation\\">.</span>IsSuccess<span class=\\"token punctuation\\">)</span>\\n                <span class=\\"token punctuation\\">{</span>\\n                    discountCoupons<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">AppendLine</span><span class=\\"token punctuation\\">(</span><span class=\\"token interpolation-string\\"><span class=\\"token string\\">$\\"可以使用的优惠券 “</span><span class=\\"token interpolation\\"><span class=\\"token punctuation\\">{</span><span class=\\"token expression language-csharp\\">_userCoupons<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">SingleOrDefault</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>Code <span class=\\"token operator\\">==</span> ruleResult<span class=\\"token punctuation\\">.</span>Rule<span class=\\"token punctuation\\">.</span>SuccessEvent<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">?.</span>Name</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token string\\">”, Code是：</span><span class=\\"token interpolation\\"><span class=\\"token punctuation\\">{</span><span class=\\"token expression language-csharp\\">ruleResult<span class=\\"token punctuation\\">.</span>Rule<span class=\\"token punctuation\\">.</span>SuccessEvent</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token string\\">\\"</span></span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n                    <span class=\\"token comment\\">//valueCoupons.Add(ruleResult.Rule.SuccessEvent);</span>\\n                <span class=\\"token punctuation\\">}</span>\\n            <span class=\\"token punctuation\\">}</span>\\n            <span class=\\"token comment\\">//resultList.OnSuccess((eventName) =&gt;</span>\\n            <span class=\\"token comment\\">//{</span>\\n            <span class=\\"token comment\\">//    discountOffered += $\\"可以使用的优惠券“{userCoupons.SingleOrDefault(s =&gt; s.Code == eventName)?.Name}”,Code是：{eventName} \\";</span>\\n            <span class=\\"token comment\\">//});</span>\\n            ruleResults<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">OnFail</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">=&gt;</span>\\n            <span class=\\"token punctuation\\">{</span>\\n                discountCoupons<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">AppendLine</span><span class=\\"token punctuation\\">(</span><span class=\\"token string\\">\\"您没有适合的优惠券！\\"</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token punctuation\\">}</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token keyword\\">return</span> discountCoupons<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToString</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>summary</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token doc-comment comment\\">/// 计算订单支付总额</span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>summary</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>param</span> <span class=\\"token attr-name\\">name</span><span class=\\"token attr-value\\"><span class=\\"token punctuation attr-equals\\">=</span><span class=\\"token punctuation\\">\\"</span>code<span class=\\"token punctuation\\">\\"</span></span><span class=\\"token punctuation\\">&gt;</span></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>param</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token doc-comment comment\\">/// <span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;</span>returns</span><span class=\\"token punctuation\\">&gt;</span></span><span class=\\"token tag\\"><span class=\\"token tag\\"><span class=\\"token punctuation\\">&lt;/</span>returns</span><span class=\\"token punctuation\\">&gt;</span></span></span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> <span class=\\"token function\\">GetOrderAmount</span><span class=\\"token punctuation\\">(</span><span class=\\"token class-name\\"><span class=\\"token keyword\\">string</span></span> code<span class=\\"token punctuation\\">)</span>\\n        <span class=\\"token punctuation\\">{</span>            \\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> selectCoupon <span class=\\"token operator\\">=</span> _userCoupons<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">SingleOrDefault</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>Code <span class=\\"token operator\\">==</span> code<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> orderAmount <span class=\\"token operator\\">=</span> <span class=\\"token number\\">0m</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token keyword\\">switch</span> <span class=\\"token punctuation\\">(</span>selectCoupon<span class=\\"token punctuation\\">.</span>Symbol<span class=\\"token punctuation\\">)</span>\\n            <span class=\\"token punctuation\\">{</span>\\n                <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">\\"-\\"</span><span class=\\"token punctuation\\">:</span>\\n                    orderAmount <span class=\\"token operator\\">=</span> _order<span class=\\"token punctuation\\">.</span>Details<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Sum</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>Price <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>s<span class=\\"token punctuation\\">.</span>Quantity<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">-</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>selectCoupon<span class=\\"token punctuation\\">.</span>Number<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n                    <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>\\n                <span class=\\"token keyword\\">case</span> <span class=\\"token string\\">\\"*\\"</span><span class=\\"token punctuation\\">:</span>\\n                    <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span><span class=\\"token operator\\">!</span><span class=\\"token keyword\\">string</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">IsNullOrWhiteSpace</span><span class=\\"token punctuation\\">(</span>selectCoupon<span class=\\"token punctuation\\">.</span>GoodsID<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span>\\n                    <span class=\\"token punctuation\\">{</span>\\n                        orderAmount <span class=\\"token operator\\">=</span> _order<span class=\\"token punctuation\\">.</span>Details<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Sum</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>Price <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>s<span class=\\"token punctuation\\">.</span>Quantity<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n                        <span class=\\"token class-name\\"><span class=\\"token keyword\\">var</span></span> detail <span class=\\"token operator\\">=</span> _order<span class=\\"token punctuation\\">.</span>Details<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">SingleOrDefault</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>GoodsID <span class=\\"token operator\\">==</span> selectCoupon<span class=\\"token punctuation\\">.</span>GoodsID<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n                        <span class=\\"token keyword\\">if</span> <span class=\\"token punctuation\\">(</span>detail <span class=\\"token operator\\">!=</span> <span class=\\"token keyword\\">null</span><span class=\\"token punctuation\\">)</span>\\n                        <span class=\\"token punctuation\\">{</span>\\n                            orderAmount <span class=\\"token operator\\">-=</span> detail<span class=\\"token punctuation\\">.</span>Price <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>detail<span class=\\"token punctuation\\">.</span>Quantity<span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span><span class=\\"token number\\">1</span> <span class=\\"token operator\\">-</span> selectCoupon<span class=\\"token punctuation\\">.</span>Number<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n                        <span class=\\"token punctuation\\">}</span>\\n                    <span class=\\"token punctuation\\">}</span>\\n                    <span class=\\"token keyword\\">else</span>\\n                    <span class=\\"token punctuation\\">{</span>\\n                        orderAmount <span class=\\"token operator\\">=</span> _order<span class=\\"token punctuation\\">.</span>Details<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Sum</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>Price <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>s<span class=\\"token punctuation\\">.</span>Quantity<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>selectCoupon<span class=\\"token punctuation\\">.</span>Number<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n                    <span class=\\"token punctuation\\">}</span>\\n                    <span class=\\"token keyword\\">break</span><span class=\\"token punctuation\\">;</span>\\n            <span class=\\"token punctuation\\">}</span>\\n            <span class=\\"token keyword\\">return</span> <span class=\\"token interpolation-string\\"><span class=\\"token string\\">$\\"订单总金额：</span><span class=\\"token interpolation\\"><span class=\\"token punctuation\\">{</span><span class=\\"token expression language-csharp\\">_order<span class=\\"token punctuation\\">.</span>Details<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Sum</span><span class=\\"token punctuation\\">(</span>s <span class=\\"token operator\\">=&gt;</span> s<span class=\\"token punctuation\\">.</span>Price <span class=\\"token operator\\">*</span> Convert<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">ToDecimal</span><span class=\\"token punctuation\\">(</span>s<span class=\\"token punctuation\\">.</span>Quantity<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> </span><span class=\\"token punctuation\\">}</span></span><span class=\\"token string\\">，优惠后请支付：</span><span class=\\"token interpolation\\"><span class=\\"token punctuation\\">{</span><span class=\\"token expression language-csharp\\">orderAmount</span><span class=\\"token punctuation\\">}</span></span><span class=\\"token string\\">\\"</span></span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Coupon</span>\\n    <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">int</span></span> ID <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> Code <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> Name <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\">DateTime</span> BeginTime <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\">DateTime</span> EndTime <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> Expression <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> Symbol <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">float</span></span> Number <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> GoodsID <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">User</span>\\n    <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">int</span></span> ID <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> UserName <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Order</span>\\n    <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> OrderNo <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\">DateTime</span> OrderTime <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\">List<span class=\\"token punctuation\\">&lt;</span>Detail<span class=\\"token punctuation\\">&gt;</span></span> Details <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token punctuation\\">}</span>\\n    <span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">class</span> <span class=\\"token class-name\\">Detail</span>\\n    <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> GoodsID <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">float</span></span> Quantity <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">decimal</span></span> Price <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n        <span class=\\"token keyword\\">public</span> <span class=\\"token return-type class-name\\"><span class=\\"token keyword\\">string</span></span> Name <span class=\\"token punctuation\\">{</span> <span class=\\"token keyword\\">get</span><span class=\\"token punctuation\\">;</span> <span class=\\"token keyword\\">set</span><span class=\\"token punctuation\\">;</span> <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span>\\n</code></pre></div>","autoDesc":true}');export{T as comp,q as data};
