import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as p,o,c as i,b as n,e as s,f as t,d as l}from"./app-CBxp4zeL.js";const c={},r=n("h2",{id:"概述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#概述"},[n("span",null,"概述")])],-1),u=n("p",null,".NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。",-1),d={href:"https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview",target:"_blank",rel:"noopener noreferrer"},k=l(`<h2 id="运行环境" tabindex="-1"><a class="header-anchor" href="#运行环境"><span>运行环境</span></a></h2><ul><li>.NET 8(强依赖，小于此版本无法运行）</li><li>Aspire的工作负载</li><li>Docker Desktop</li><li>VS 2022 17.9+</li></ul><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment"># 确认当前已安装项</span>
dotnet workload list

<span class="token comment"># 安装Aspire</span>
dotnet workload <span class="token function">install</span> aspire

<span class="token comment"># 更新工作负载</span>
dotnet workload update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h2><h3 id="快速上手" tabindex="-1"><a class="header-anchor" href="#快速上手"><span>快速上手</span></a></h3><p>使用命令行创建一个项目</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>dotnet new aspire-starter
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>然后在磁盘上就可以看到Aspire项目，项目内容如下</p><ul><li>aspire.learn.ApiService --- 模拟WebApi项目</li><li>aspire.learn.AppHost --- aspire的宿主项目</li><li>aspire.learn.ServiceDefaults --- aspire的服务配置项目</li><li>aspire.learn.Web --- web前端的模拟项目</li></ul><p>四个目录中，和Aspire关系最密切的项目就是中间的AppHost和ServiceDefaults这两个项目，另外两个项目（ApiService和Web）属于业务性项目。接下来我们分别来说说这两个项目。 <strong>AppHost</strong>：这个项目从名字上我们就不难看出，这是个宿主项目，官方对这个项目的定义是协调器项目，用于协调Aspire项目中的各种资源。从个人在实践过程中的感觉来说，除了官方说的协调各种资源外，他还具备如下职责：</p><ul><li>在开发阶段中，他最重要的职责是，做为Aspire的可视化宿主，也叫Dashboard的启动器。</li><li>在发布阶段，他最重要的职责是，生成可以直接被容器化平台使用的脚本。目前原生支持Azure（毕竟是亲生的），有第三方工具提供了K8s和Docker Compose的支持（ Aspir8）</li></ul><p>**ServiceDefaults：**这个项目，属于公共库，他要被ApiService以及Web这两个业务项目引用，并在Program.cs中调用如下方法：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>builder.AddServiceDefaults();
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过这个方法，把Aspire的相关特性，分别注入到两个业务项目中。</p><h3 id="已有项目中使用aspire" tabindex="-1"><a class="header-anchor" href="#已有项目中使用aspire"><span>已有项目中使用Aspire</span></a></h3><p>在已有项目中使用Aspire：https://mp.weixin.qq.com/s/mjUoZ0-9y1wv81yO02MISg</p><h2 id="日志" tabindex="-1"><a class="header-anchor" href="#日志"><span>日志</span></a></h2><h3 id="serilog对接" tabindex="-1"><a class="header-anchor" href="#serilog对接"><span>Serilog对接</span></a></h3><p>将日志输出到支持OTLP协议Aspire中展示，安装nuget包</p><div class="language-xml line-numbers-mode" data-ext="xml" data-title="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Serilog.AspNetCore<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>8.0.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Serilog.Sinks.Async<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1.5.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Serilog.Sinks.OpenTelemetry<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>3.0.0-dev-00298<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Swashbuckle.AspNetCore<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>6.4.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>示例代码如下</p><div class="language-csharp line-numbers-mode" data-ext="cs" data-title="cs"><pre class="language-csharp"><code>builder<span class="token punctuation">.</span>Host<span class="token punctuation">.</span><span class="token function">UseSerilog</span><span class="token punctuation">(</span><span class="token punctuation">(</span>hbc<span class="token punctuation">,</span> lc<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> logLevel <span class="token operator">=</span> LogEventLevel<span class="token punctuation">.</span>Error<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hbc<span class="token punctuation">.</span>HostingEnvironment<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        logLevel <span class="token operator">=</span> LogEventLevel<span class="token punctuation">.</span>Information<span class="token punctuation">;</span>

    lc<span class="token punctuation">.</span>ReadFrom<span class="token punctuation">.</span><span class="token function">Configuration</span><span class="token punctuation">(</span>hbc<span class="token punctuation">.</span>Configuration<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>MinimumLevel<span class="token punctuation">.</span><span class="token function">Override</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft&quot;</span><span class="token punctuation">,</span> logLevel<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>MinimumLevel<span class="token punctuation">.</span><span class="token function">Override</span><span class="token punctuation">(</span><span class="token string">&quot;System&quot;</span><span class="token punctuation">,</span> logLevel<span class="token punctuation">)</span>
      <span class="token punctuation">.</span>Enrich<span class="token punctuation">.</span><span class="token function">FromLogContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>WriteTo<span class="token punctuation">.</span><span class="token function">Async</span><span class="token punctuation">(</span>wt <span class="token operator">=&gt;</span>
      <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>hbc<span class="token punctuation">.</span>HostingEnvironment<span class="token punctuation">.</span><span class="token function">IsDevelopment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
              wt<span class="token punctuation">.</span><span class="token function">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          wt<span class="token punctuation">.</span><span class="token function">Console</span><span class="token punctuation">(</span><span class="token named-parameter punctuation">theme</span><span class="token punctuation">:</span> AnsiConsoleTheme<span class="token punctuation">.</span>Code<span class="token punctuation">)</span><span class="token punctuation">;</span>
          wt<span class="token punctuation">.</span><span class="token function">OpenTelemetry</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span>
          <span class="token punctuation">{</span>
              c<span class="token punctuation">.</span>Protocol <span class="token operator">=</span> OtlpProtocol<span class="token punctuation">.</span>Grpc<span class="token punctuation">;</span>
              c<span class="token punctuation">.</span>Endpoint <span class="token operator">=</span> <span class="token string">&quot;http://localhost:4317&quot;</span><span class="token punctuation">;</span>
              c<span class="token punctuation">.</span>Headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">&gt;</span></span>
                          <span class="token punctuation">{</span>
                              <span class="token punctuation">[</span><span class="token string">&quot;x-otlp-api-key&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span>
                                  <span class="token string">&quot;rVmuMdaqCEruWEbKANjmcIQMnKIhDiLUYSFHaZAVlMktmwDhMUAPIZyfizmoLuSwAePPVhhPigpJUIsAsPZcwfmaMnBxxRuxatrrHNSOKUxUVGFlYQtGtbqtOPasMvPd&quot;</span>
                          <span class="token punctuation">}</span><span class="token punctuation">;</span>
              c<span class="token punctuation">.</span>ResourceAttributes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">object</span><span class="token punctuation">&gt;</span></span>
                                     <span class="token punctuation">{</span>
                                         <span class="token punctuation">[</span><span class="token string">&quot;service.name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> builder<span class="token punctuation">.</span>Environment<span class="token punctuation">.</span>ApplicationName<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;service.version&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;1.0.0&quot;</span>
                                     <span class="token punctuation">}</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装-1" tabindex="-1"><a class="header-anchor" href="#安装-1"><span>安装</span></a></h2><h3 id="aspire-dashboard" tabindex="-1"><a class="header-anchor" href="#aspire-dashboard"><span>Aspire Dashboard</span></a></h3><p>通过下面内容可以部署出来一个支持日志、跟踪、指标的Dashboard</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">aspire_dashboard</span><span class="token punctuation">:</span> <span class="token comment"># aspire 可观测面板  登录界面的密码去容器内拷贝</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mcr.microsoft.com/dotnet/nightly/aspire<span class="token punctuation">-</span>dashboard<span class="token punctuation">:</span>8.0.0<span class="token punctuation">-</span>preview.6
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> aspire_dashboard
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> TZ=Asia/Shanghai
      <span class="token punctuation">-</span> DASHBOARD__OTLP__AUTHMODE=ApiKey <span class="token comment"># 认证模式</span>
      <span class="token punctuation">-</span> DASHBOARD__OTLP__PRIMARYAPIKEY=rVmuMdaqCEruWEbKANjmcIQMnKIhDiLUYSFHaZAVlMktmwDhMUAPIZyfizmoLuSwAePPVhhPigpJUIsAsPZcwfmaMnBxxRuxatrrHNSOKUxUVGFlYQtGtbqtOPasMvPd <span class="token comment"># 密钥</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;18888:18888&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;4317:18889&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2><p>快速入门：构建您的第一个 .NET Aspire 应用程序https://www.cnblogs.com/powertoolsteam/p/17835864.html</p>`,29),m={href:"https://www.bilibili.com/video/BV19a4y167Fr?spm_id_from=333.1245.0.0",target:"_blank",rel:"noopener noreferrer"},v=n("p",null,"aspire 示例：https://github.com/dotnet/aspire-samples/tree/main/samples/Metrics",-1),h=n("h2",{id:"视频教程",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#视频教程"},[n("span",null,"视频教程")])],-1),g={href:"https://www.bilibili.com/video/BV1CN4y1m7gR?spm_id_from=333.1245.0.0",target:"_blank",rel:"noopener noreferrer"},b=n("p",null,"单独使用 .NET Aspire 仪表板 - Qiitahttps://qiita.com/takashiuesaka/items/338ae64ca2033e078f7f如何使用为 .NET Aspire 提供的示例仪表板应用程序作为 OpenTelemetry 的容器（无需 Aspire）。",-1),f=n("p",null,"使用 .NET Aspire 处理数据库 - PostgreSQL 版 - Qiitahttps://qiita.com/takashiuesaka/items/137cb1450c3d9fbc8d1e了解如何在 .NET Aspire 应用程序中使用 PostgreSQL。本文还涉及在开发环境的容器中运行 PostgreSQL、填充初始值以及实际部署过程中的注意事项等内容。",-1);function A(y,_){const a=p("ExternalLinkIcon");return o(),i("div",null,[r,u,n("p",null,[s("官方文档："),n("a",d,[s("https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview"),t(a)])]),k,n("p",null,[n("a",m,[s("在 .NET 中正确测量和可视化度量指标"),t(a)])]),v,h,n("p",null,[n("a",g,[s("如何部署 .NET 8 的新 .NET Aspire 栈"),t(a)])]),b,f])}const w=e(c,[["render",A],["__file","dotNetAspire.html.vue"]]),N=JSON.parse('{"path":"/dotnet/dotNetAspire.html","title":".NET Aspire","lang":"zh-CN","frontmatter":{"title":".NET Aspire","lang":"zh-CN","date":"2023-11-25T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["dotNET"],"tag":["aspire"],"description":"概述 .NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。 官方文档：https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview 运行环境 .NET 8(强依赖，小于此版本无法运行） Aspire的工作负载 Docker Des...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/dotnet/dotNetAspire.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":".NET Aspire"}],["meta",{"property":"og:description","content":"概述 .NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。 官方文档：https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview 运行环境 .NET 8(强依赖，小于此版本无法运行） Aspire的工作负载 Docker Des..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-15T14:11:18.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"aspire"}],["meta",{"property":"article:published_time","content":"2023-11-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-05-15T14:11:18.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\".NET Aspire\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-11-25T00:00:00.000Z\\",\\"dateModified\\":\\"2024-05-15T14:11:18.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"运行环境","slug":"运行环境","link":"#运行环境","children":[]},{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"操作","slug":"操作","link":"#操作","children":[{"level":3,"title":"快速上手","slug":"快速上手","link":"#快速上手","children":[]},{"level":3,"title":"已有项目中使用Aspire","slug":"已有项目中使用aspire","link":"#已有项目中使用aspire","children":[]}]},{"level":2,"title":"日志","slug":"日志","link":"#日志","children":[{"level":3,"title":"Serilog对接","slug":"serilog对接","link":"#serilog对接","children":[]}]},{"level":2,"title":"安装","slug":"安装-1","link":"#安装-1","children":[{"level":3,"title":"Aspire Dashboard","slug":"aspire-dashboard","link":"#aspire-dashboard","children":[]}]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[]},{"level":2,"title":"视频教程","slug":"视频教程","link":"#视频教程","children":[]}],"git":{"createdTime":1700920704000,"updatedTime":1715782278000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":7},{"name":"zhangyunpeng","email":"zhang.yunpeng@synyi.com","commits":2}]},"readingTime":{"minutes":2.92,"words":875},"filePathRelative":"dotnet/dotNetAspire.md","localizedDate":"2023年11月25日","excerpt":"<h2>概述</h2>\\n<p>.NET Aspire 是一个云就绪堆栈，用于构建可观察的、生产就绪的分布式应用程序。</p>\\n<p>官方文档：<a href=\\"https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://learn.microsoft.com/zh-cn/dotnet/aspire/get-started/aspire-overview</a></p>\\n<h2>运行环境</h2>\\n<ul>\\n<li>.NET 8(强依赖，小于此版本无法运行）</li>\\n<li>Aspire的工作负载</li>\\n<li>Docker Desktop</li>\\n<li>VS 2022 17.9+</li>\\n</ul>","autoDesc":true}');export{w as comp,N as data};
