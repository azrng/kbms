import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,d as n}from"./app-S-drW72G.js";const l="/kbms/cloud/image-20231230214707056.png",e="/kbms/cloud/image-20231230214830875.png",h="/kbms/cloud/image-20231230220152384.png",t={},k=n(`<div class="hint-container tip"><p class="hint-container-title">提示</p><p>在Ubuntu服务器部署K3s，集群有问题，要搭建集群不适合看此文章</p></div><h2 id="k3s安装" tabindex="-1"><a class="header-anchor" href="#k3s安装"><span>K3S安装</span></a></h2><p>可以通过下面的命令进行安装k3s（执行官方的安装脚本）</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 默认地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.rancher.cn/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.rancher.cn/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">	INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">	 --system-default-registry</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;registry.cn-hangzhou.aliyuncs.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 国内镜像加速地址，安装特定版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">v1.25.3+k3s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">  INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 安装并设置默认镜像源地址，安装特定版本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> –sfL</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">     INSTALL_K3S_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">v1.25.3+k3s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --system-default-registry</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;registry.cn-hangzhou.aliyuncs.com&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+l+'" alt="image-20231230214707056" tabindex="0" loading="lazy"><figcaption>image-20231230214707056</figcaption></figure><p>验证是否安装成功</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nodes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="'+e+`" alt="image-20231230214830875" tabindex="0" loading="lazy"><figcaption>image-20231230214830875</figcaption></figure><p>可以看到控制平面和主节点一起运行，查看创建了那些容器(pods)</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pods</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --all-namespaces</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAMESPACE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                     READY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      RESTARTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   helm-install-traefik-cm8dv</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">               0/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             59d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   helm-install-traefik-crd-4zsbk</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           0/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Completed</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             59d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   svclb-traefik-dda3bd79-lrdr9</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             2/2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (9d </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)    59d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   local-path-provisioner-6f65f9b6d-9c68k</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (10h </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)   59d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   coredns-5cf45fb78d-drrdx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                 1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (9d </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)    59d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   metrics-server-7dbd8c95c-gdn4l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (10h </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)   59d</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kube-system</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   traefik-7f57b8d797-d4wls</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                 1/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     Running</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     3</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (9d </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">ago</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)    59d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到可用 pod 的列表，一个基本的 K3s 设置，包括：</p><ul><li><strong>Traefik</strong> 作为 HTTP 反向代理和负载均衡的入口控制器</li><li><strong>CoreDns</strong>管理集群和节点内的 DNS 解析</li><li><strong>Local Path Provisioner</strong>提供了一种在每个节点中利用本地存储的方法</li><li><strong>Helm</strong>我们可以使用它来打包、部署</li></ul><h3 id="添加节点-可选" tabindex="-1"><a class="header-anchor" href="#添加节点-可选"><span>添加节点(可选)</span></a></h3><p>如果我们想将节点添加到集群中，需要执行指向节点主机的相同命令</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 首先在做Master的节点服务器获取token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/lib/rancher/k3s/server/node-token</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">K108ac35d092658e48af38b9bb83843db4e42641f8b6914b6ee93e36249447b21d5::server:c7c7acbe927b401103e8950d9ad04dd5</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 在agent节点服务器上执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">v1.25.3+k3s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> K3S_URL</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">http://</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">node-host</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:6443</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> K3S_TOKEN</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">K108ac35d092658e48af38b9bb83843db4e42641f8b6914b6ee93e36249447b21d5::server:c7c7acbe927b401103e8950d9ad04dd5</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="添加私有镜像或镜像加速-可选" tabindex="-1"><a class="header-anchor" href="#添加私有镜像或镜像加速-可选"><span>添加私有镜像或镜像加速(可选)</span></a></h3><p>新增下面文件</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/rancher/k3s/registries.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将以下内容保存到文件中：</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mirrors:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  mirror.aliyuncs.com:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    endpoint:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;https://xxxxxx.mirror.aliyuncs.com&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 这里可选用自己的加速链接</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">configs:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  &quot;registry.cn-hangzhou.aliyuncs.com&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">:</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> # 如果有私有镜像库填这里，没有删掉即可</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    auth:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      username:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> xxxxxx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      password:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> xxxxxx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>比如我的配置如下</p><figure><img src="`+h+`" alt="image-20231230220152384" tabindex="0" loading="lazy"><figcaption>image-20231230220152384</figcaption></figure><p>保存后需要重启k3s才会生效</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>sudo systemctl restart k3s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>可以再次查看状态</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> node</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   ROLES</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                  AGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   VERSION</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">desktop-bmeog9q</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Ready</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    control-plane,master</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   59d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   v1.27.6+k3s1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还可以通过查看pods节点信息去查看节点从哪里下载的</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> describe</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pods</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">podsNam</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="k3s卸载" tabindex="-1"><a class="header-anchor" href="#k3s卸载"><span>K3s卸载</span></a></h2><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 在server节点执行如下：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@k3s-server </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# /usr/local/bin/k3s-uninstall.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 在agent节点执行如下：</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@k3s-agent </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# /usr/local/bin/k3s-agent-uninstall.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="其他内容安装-可选" tabindex="-1"><a class="header-anchor" href="#其他内容安装-可选"><span>其他内容安装(可选)</span></a></h2><h3 id="ingress-nginx安装" tabindex="-1"><a class="header-anchor" href="#ingress-nginx安装"><span>Ingress-Nginx安装</span></a></h3><p>此章节建议全部看完，再安装</p><h4 id="基本安装" tabindex="-1"><a class="header-anchor" href="#基本安装"><span>基本安装</span></a></h4><ol><li>下载ingress-naginx yaml(裸机版)</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.5.1/deploy/static/provider/baremetal/deploy.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>修改deploy.yaml中的镜像后缀，(image地址中的&quot;@&quot;及后面的字符全部删掉)</li><li>因为网络问题，需要单独下载yaml中的两个镜像,最简单的方法是本地代理下载下来然后传到国内镜像仓库再拉下来打tag</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 下载</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> registry.k8s.io/ingress-nginx/controller:v1.5.1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 上传，可以通过docker命令上传，我是直接打成压缩包然后通过华为云的压缩包上传的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> save</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> D:/webhook.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> save</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> D:/controller.tar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> registry.k8s.io/ingress-nginx/controller:v1.5.1</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#然后在页面中处理上传</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#下载镜像到k3s服务器并打tag,这是我自己打包的镜像,可以直接用</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> swr.cn-north-1.myhuaweicloud.com/rivenpub/kube-webhook-certgen:v20220916-gd32f8c343</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> swr.cn-north-1.myhuaweicloud.com/rivenpub/ingress-nginx-controller:v1.5.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> swr.cn-north-1.myhuaweicloud.com/rivenpub/kube-webhook-certgen:v20220916-gd32f8c343</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tag</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> swr.cn-north-1.myhuaweicloud.com/rivenpub/ingress-nginx-controller:v1.5.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> registry.k8s.io/ingress-nginx/controller:v1.5.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>安装<code>kubectl apply -f deploy.yaml</code></li></ol><h4 id="hostnetwork模式" tabindex="-1"><a class="header-anchor" href="#hostnetwork模式"><span>HostNetWork模式</span></a></h4><p><strong>特点：</strong></p><ul><li>该模式会占用主机的80和443端口。每个节点最多存在一个Pod。</li><li>该模式使用主机的DNS配置而非集群的kube-dns等。</li><li>好处是主机网络接口直接进入ingress而无需经过NodePort的网络转换。</li></ul><p><strong>K3S 安装注意事项</strong> 需要禁用k3s自带的负载均衡器，否则端口冲突，k3s安装命令后面加 <code>sh -s - --disable servicelb </code> K3s的完整安装命令为：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">v1.25.3+k3s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_EXEC</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server --docker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --disable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> servicelb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Yaml修改</strong> 修改 deploy.yaml 文件中 Deployment 部分，改完后大概如下</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apps/v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> DaemonSet</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #修改Deployment</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    app.kubernetes.io/component:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    app.kubernetes.io/instance:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    app.kubernetes.io/name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    app.kubernetes.io/part-of:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    app.kubernetes.io/version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1.5.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx-controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  namespace:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  minReadySeconds:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  revisionHistoryLimit:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  selector:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      app.kubernetes.io/component:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      app.kubernetes.io/instance:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      app.kubernetes.io/name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  template:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        app.kubernetes.io/component:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        app.kubernetes.io/instance:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        app.kubernetes.io/name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      hostNetwork:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #新增的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      containers:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> args:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /nginx-ingress-controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --election-id=ingress-nginx-leader</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --controller-class=k8s.io/ingress-nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --ingress-class=nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --configmap=$(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">POD_NAMESPACE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">)/ingress-nginx-controller</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --validating-webhook=:8443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --validating-webhook-certificate=/usr/local/certificates/cert</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --validating-webhook-key=/usr/local/certificates/key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        -</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --report-node-internal-ip-address</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"> #新增的</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="metallb" tabindex="-1"><a class="header-anchor" href="#metallb"><span>MetalLB</span></a></h4><p><strong>特点</strong> 这是个负载均衡器，可以在任何裸机集群中使用负载均衡的功能。但是云服务器基本都不支持(因为虚拟IP的缘故) 这种方式安装同样要禁用k3s的负载均衡器，所以k3s安装命令同HostNetWork模式</p><p><strong>ingress-nginx</strong> ingress-nginx 不使用裸机版的配置，改用负载均衡版：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.5.1/deploy/static/provider/cloud/deploy.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>同样修改里面的镜像后缀</p><p><strong>MetalLB安装：</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apply</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://raw.githubusercontent.com/metallb/metallb/v0.13.7/config/manifests/metallb-native.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建config文件 metallb-config.yaml: <code>kubectl apply -f metallb-config.yaml</code></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">metallb.io/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">IPAddressPool</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">metallb-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  addresses</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">192.168.0.100-192.168.0.103</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  #此处的ip地址段为虚拟ip段，不与dhcp分发的ip和节点ip等重复</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  autoAssign</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">apiVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">metallb.io/v1beta1</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">kind</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">L2Advertisement</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">metadata</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">default</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">metallb-system</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">spec</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">  ipAddressPools</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">default</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>使用:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@ecs-153442 k3s]## kubectl get ingress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">NAME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            CLASS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   HOSTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           ADDRESS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   AGE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">netcoretest</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   test.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">        192.168.0.101</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   80</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      38s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@ecs-153442 k3s]vim /etc/hosts</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#添加几行：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.0.100</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.0.101</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.0.102</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">192.168.0.103</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> test.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@ecs-153442 k3s]curl test.com</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ingress-nginx使用" tabindex="-1"><a class="header-anchor" href="#ingress-nginx使用"><span>Ingress-Nginx使用</span></a></h4><p>直接替换调ingress yaml文件中的<strong>ingressClassName</strong>为<strong>nginx</strong>即可，类似于下面</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">apiVersion:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> networking.k8s.io/v1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kind:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Ingress</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">metadata:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> netcoretest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">spec:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  ingressClassName:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">  #这里写成nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  rules:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> host:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> netcoretest.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">    http:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      paths:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">      -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pathType:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Prefix</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        path:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        backend:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">          service:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            name:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> netcoretest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">            port:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">              number:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果是HostNetWork模式 可以把ingress的nodeport端口固定，我固定成了30000和30001，主要是因为80端口有时候不可用 现在可以通过 http://netcoretest.com 和 http://netcoretest.com:30000 访问具体的服务了</p><p><strong>ingress-nginx 固定端口配置</strong></p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">kubectl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> edit</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ingress-nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> svc/ingress-nginx-controller</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>把ports配置改成下面这样就可以了. 也可以在最开始的ingress-nginx的deploy.yaml中直接改</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;"> ports</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">appProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">http</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    nodePort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30000</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">80</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">TCP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">http</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">appProtocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">https</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">https</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    nodePort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">30001</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    port</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">443</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    protocol</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">TCP</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">    targetPort</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">https</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="k3s使用主机docker" tabindex="-1"><a class="header-anchor" href="#k3s使用主机docker"><span>K3S使用主机Docker</span></a></h3><h4 id="方法一-安装时指定参数" tabindex="-1"><a class="header-anchor" href="#方法一-安装时指定参数"><span>方法一：安装时指定参数</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#1.在安装时通过环境变量INSTALL_K3S_EXEC</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_VERSION</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">v1.25.3+k3s1</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_EXEC</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;server --docker&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> INSTALL_K3S_MIRROR</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">cn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#2.或者直接传参</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sfL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="方法二-安装后修改配置文件" tabindex="-1"><a class="header-anchor" href="#方法二-安装后修改配置文件"><span>方法二：安装后修改配置文件</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#1.打开文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/systemd/system/multi-user.target.wants/k3s.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#2.修改ExecStart那几行的值为：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">/usr/local/bin/k3s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> server</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --docker</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --no-deploy</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> traefik</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#3.重启服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> k3s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="kubectl-客户端连接k3s" tabindex="-1"><a class="header-anchor" href="#kubectl-客户端连接k3s"><span>kubectl 客户端连接K3S</span></a></h3><p>将k3s主机点上的 /etc/rancher/k3s/k3s.yaml 文件拷贝到 kubectl所在机器的 ~/.kube/config 需要注意修改 yaml文件中的ip地址为 kubectl客户端可以访问到的地址</p><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2><p><a href="https://mp.weixin.qq.com/s/opW6n5vpPNZarcnAfMGPHw" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/opW6n5vpPNZarcnAfMGPHw</a> | 使用autok3s 安装k3s 集群 和 kuboard 管理集群</p><p>https://mp.weixin.qq.com/s/4Y3DJs6FqEQZ2WZt0udMvQ | 使用 k3sup 一分钟快速搭建 K3s 集群</p><p>https://www.cnblogs.com/hujinzhong/p/15014487.html k3s安装与部署</p>`,76),p=[k];function r(d,g){return a(),i("div",null,p)}const o=s(t,[["render",r],["__file","install.html.vue"]]),F=JSON.parse('{"path":"/cloud/k3s/install.html","title":"安装以及配置","lang":"zh-CN","frontmatter":{"title":"安装以及配置","lang":"zh-CN","date":"2023-09-24T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["cloud"],"tag":["无"],"filename":"anzhuangyijipeizhi","slug":"vtb64ufleemxdcw6","docsId":"110427807","description":"提示 在Ubuntu服务器部署K3s，集群有问题，要搭建集群不适合看此文章 K3S安装 可以通过下面的命令进行安装k3s（执行官方的安装脚本） image-20231230214707056image-20231230214707056 验证是否安装成功 image-20231230214830875image-20231230214830875 可以...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/cloud/k3s/install.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"安装以及配置"}],["meta",{"property":"og:description","content":"提示 在Ubuntu服务器部署K3s，集群有问题，要搭建集群不适合看此文章 K3S安装 可以通过下面的命令进行安装k3s（执行官方的安装脚本） image-20231230214707056image-20231230214707056 验证是否安装成功 image-20231230214830875image-20231230214830875 可以..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://azrng.gitee.io/kbms/kbms/cloud/image-20231230214707056.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-09-08T15:49:37.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-09-24T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-09-08T15:49:37.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"安装以及配置\\",\\"image\\":[\\"https://azrng.gitee.io/kbms/kbms/cloud/image-20231230214707056.png\\",\\"https://azrng.gitee.io/kbms/kbms/cloud/image-20231230214830875.png\\",\\"https://azrng.gitee.io/kbms/kbms/cloud/image-20231230220152384.png\\"],\\"datePublished\\":\\"2023-09-24T00:00:00.000Z\\",\\"dateModified\\":\\"2024-09-08T15:49:37.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"K3S安装","slug":"k3s安装","link":"#k3s安装","children":[{"level":3,"title":"添加节点(可选)","slug":"添加节点-可选","link":"#添加节点-可选","children":[]},{"level":3,"title":"添加私有镜像或镜像加速(可选)","slug":"添加私有镜像或镜像加速-可选","link":"#添加私有镜像或镜像加速-可选","children":[]}]},{"level":2,"title":"K3s卸载","slug":"k3s卸载","link":"#k3s卸载","children":[]},{"level":2,"title":"其他内容安装(可选)","slug":"其他内容安装-可选","link":"#其他内容安装-可选","children":[{"level":3,"title":"Ingress-Nginx安装","slug":"ingress-nginx安装","link":"#ingress-nginx安装","children":[{"level":4,"title":"基本安装","slug":"基本安装","link":"#基本安装","children":[]},{"level":4,"title":"HostNetWork模式","slug":"hostnetwork模式","link":"#hostnetwork模式","children":[]},{"level":4,"title":"MetalLB","slug":"metallb","link":"#metallb","children":[]},{"level":4,"title":"Ingress-Nginx使用","slug":"ingress-nginx使用","link":"#ingress-nginx使用","children":[]}]},{"level":3,"title":"K3S使用主机Docker","slug":"k3s使用主机docker","link":"#k3s使用主机docker","children":[{"level":4,"title":"方法一：安装时指定参数","slug":"方法一-安装时指定参数","link":"#方法一-安装时指定参数","children":[]},{"level":4,"title":"方法二：安装后修改配置文件","slug":"方法二-安装后修改配置文件","link":"#方法二-安装后修改配置文件","children":[]}]},{"level":3,"title":"kubectl 客户端连接K3S","slug":"kubectl-客户端连接k3s","link":"#kubectl-客户端连接k3s","children":[]}]},{"level":2,"title":"资料","slug":"资料","link":"#资料","children":[]}],"git":{"createdTime":1695541854000,"updatedTime":1725810577000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":2}]},"readingTime":{"minutes":6.23,"words":1869},"filePathRelative":"cloud/k3s/install.md","localizedDate":"2023年9月24日","excerpt":"<div class=\\"hint-container tip\\">\\n<p class=\\"hint-container-title\\">提示</p>\\n<p>在Ubuntu服务器部署K3s，集群有问题，要搭建集群不适合看此文章</p>\\n</div>\\n<h2>K3S安装</h2>\\n<p>可以通过下面的命令进行安装k3s（执行官方的安装脚本）</p>\\n<div class=\\"language-shell line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"shell\\" data-title=\\"shell\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic\\"># 默认地址</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> curl</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -sfL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> https://rancher-mirror.rancher.cn/k3s/k3s-install.sh</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#ABB2BF\\"> |</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\"> INSTALL_K3S_MIRROR</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">cn</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\"> sh</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> -</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> curl</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -sfL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> https://rancher-mirror.rancher.cn/k3s/k3s-install.sh</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#ABB2BF\\"> |</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\"> \\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">\\tINSTALL_K3S_MIRROR</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">cn</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\"> sh</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -s</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> -</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\"> \\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\">\\t --system-default-registry</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> \\"registry.cn-hangzhou.aliyuncs.com\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic\\"># 国内镜像加速地址，安装特定版本</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> curl</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -sfL</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#ABB2BF\\"> |</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\"> INSTALL_K3S_VERSION</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">v1.25.3+k3s1</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">  INSTALL_K3S_MIRROR</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">cn</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\"> sh</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> -</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic\\"># 安装并设置默认镜像源地址，安装特定版本</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">sudo</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> curl</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> –sfL</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\"> \\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">     https://rancher-mirror.oss-cn-beijing.aliyuncs.com/k3s/k3s-install.sh</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#ABB2BF\\"> |</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\"> \\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\">     INSTALL_K3S_VERSION</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">v1.25.3+k3s1</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#E06C75\\"> INSTALL_K3S_MIRROR</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#56B6C2\\">=</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">cn</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\"> sh</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\"> -s</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> -</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\"> \\\\</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\">     --system-default-registry</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> \\"registry.cn-hangzhou.aliyuncs.com\\"</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{o as comp,F as data};
