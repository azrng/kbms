import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as s,b as e}from"./app-DMmdIwn0.js";const t={},p=e(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>使用yaml文件管理将容器部署到k8s的过程。</p><h2 id="操作" tabindex="-1"><a class="header-anchor" href="#操作"><span>操作</span></a></h2><h3 id="创建文件" tabindex="-1"><a class="header-anchor" href="#创建文件"><span>创建文件</span></a></h3><p>创建backend-deploy.yml文件并添加下面的内容</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pizzabackend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pizzabackend
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pizzabackend
        <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>YOUR DOCKER USER NAME<span class="token punctuation">]</span>/pizzabackend<span class="token punctuation">:</span>latest
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ASPNETCORE_URLS
          <span class="token key atrule">value</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//<span class="token important">*:</span><span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pizzabackend
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pizzabackend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pizzabackend
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将占位符 [YOUR DOCKER USER NAME] 替换为实际的 Docker 用户名。</p><p>文件描述： 第一部分定义了将部署到k8s中容器的部署规范。指定有一个副本，在哪里可以找到容器镜像，在容器上打开哪些端口，并设置了一些环境变量。还定义了引用容器和规范的标签和名称。 第二部分定义了容器作为Kubernetes ClusterIp运行(此类服务不会公开外部IP地址，只能从同一个k8s集群中运行的其他服务访问)。</p><h3 id="部署并运行服务" tabindex="-1"><a class="header-anchor" href="#部署并运行服务"><span>部署并运行服务</span></a></h3><p>使用命令行并转到上面backend-deploy.yml文件的同一个目录，然后运行命令</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>kubectl apply <span class="token punctuation">-</span>f backend<span class="token punctuation">-</span>deploy.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这个命令将指示k8s运行已经创建的文件，会从docker hub下载镜像并创建容器。</p><p>这里kubectl apply 命令将快速返回。 但容器可能需要一段时间才能创建完成。 若要查看进度，请使用以下代码。</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>kubectl get pods
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在生成的输出中，你将在“名称”列下看到一个包含“pizzabackend”后跟一串随机字符的行。 一切准备就绪后，“就绪”列下会显示“1/1”，“状态”列下会显示“正在运行”。</p><p>然后这个时候去访问服务，提示404，出现这的原因是无法从外部访问后端服务。</p><h3 id="创建前端服务" tabindex="-1"><a class="header-anchor" href="#创建前端服务"><span>创建前端服务</span></a></h3><p>创建一个名字为frontend-deploy.yml的文件，并设置内容为</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pizzafrontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> pizzafrontend
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pizzafrontend
        <span class="token key atrule">image</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>YOUR DOCKER USER NAME<span class="token punctuation">]</span>/pizzafrontend<span class="token punctuation">:</span>latest
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ASPNETCORE_URLS
          <span class="token key atrule">value</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//<span class="token important">*:</span><span class="token number">80</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> backendUrl
          <span class="token key atrule">value</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//pizzabackend
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> pizzafrontend
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pizzafrontend
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> LoadBalancer
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> pizzafrontend
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将占位符 [YOUR DOCKER USERNAME] 替换为实际的 Docker 用户名。</p><p>此文件类似于我们为后端微服务创建的文件。 但有三点不同之处：</p><ul><li>我们指定了一个不同的容器在部署的 spec.template.spec.containers.image 值下运行。</li><li>spec.template.spec.containers.env 部分下有一个新的环境变量。 “pizzafrontend”应用程序中的代码调用后端，但由于我们还没有指定一个完全限定的域名，也不知道后端微服务的 IP 地址，因此我们使用在 Deployment 的 metadata.name 节点下指定的名称。 然后，Kubernetes 将处理其余部分。</li><li>在服务部分，我们为 spec.type 指定了 LoadBalancer 值。 并且端口 80 处于打开状态。 我们现在可以通过导航到 <strong>http://localhost</strong> 来浏览前端。</li></ul><p>通过下面的命令将容器部署到k8s</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code>kubectl apply <span class="token punctuation">-</span>f frontend<span class="token punctuation">-</span>deploy.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>同样，可以使用 kubectl get pods 来查看部署状态。成功部署后，就可以浏览前端服务了。</p>`,25),l=[p];function c(i,o){return a(),s("div",null,l)}const r=n(t,[["render",c],["__file","bushuwenjian.html.vue"]]),d=JSON.parse('{"path":"/cloud/k8s/bushuwenjian.html","title":"部署文件","lang":"zh-CN","frontmatter":{"title":"部署文件","lang":"zh-CN","date":"2023-03-14T00:00:00.000Z","publish":true,"author":"azrng","isOriginal":true,"category":["cloud"],"tag":["无"],"filename":"bushuwenjian","slug":"fdzz0bgif58zgzhv","docsId":"117975710","description":"概述 使用yaml文件管理将容器部署到k8s的过程。 操作 创建文件 创建backend-deploy.yml文件并添加下面的内容 将占位符 [YOUR DOCKER USER NAME] 替换为实际的 Docker 用户名。 文件描述： 第一部分定义了将部署到k8s中容器的部署规范。指定有一个副本，在哪里可以找到容器镜像，在容器上打开哪些端口，并设置...","head":[["meta",{"property":"og:url","content":"https://azrng.gitee.io/kbms/kbms/cloud/k8s/bushuwenjian.html"}],["meta",{"property":"og:site_name","content":"知识库"}],["meta",{"property":"og:title","content":"部署文件"}],["meta",{"property":"og:description","content":"概述 使用yaml文件管理将容器部署到k8s的过程。 操作 创建文件 创建backend-deploy.yml文件并添加下面的内容 将占位符 [YOUR DOCKER USER NAME] 替换为实际的 Docker 用户名。 文件描述： 第一部分定义了将部署到k8s中容器的部署规范。指定有一个副本，在哪里可以找到容器镜像，在容器上打开哪些端口，并设置..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-09-24T07:50:54.000Z"}],["meta",{"property":"article:author","content":"azrng"}],["meta",{"property":"article:tag","content":"无"}],["meta",{"property":"article:published_time","content":"2023-03-14T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-09-24T07:50:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"部署文件\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-03-14T00:00:00.000Z\\",\\"dateModified\\":\\"2023-09-24T07:50:54.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"azrng\\"}]}"]]},"headers":[{"level":2,"title":"概述","slug":"概述","link":"#概述","children":[]},{"level":2,"title":"操作","slug":"操作","link":"#操作","children":[{"level":3,"title":"创建文件","slug":"创建文件","link":"#创建文件","children":[]},{"level":3,"title":"部署并运行服务","slug":"部署并运行服务","link":"#部署并运行服务","children":[]},{"level":3,"title":"创建前端服务","slug":"创建前端服务","link":"#创建前端服务","children":[]}]}],"git":{"createdTime":1695541854000,"updatedTime":1695541854000,"contributors":[{"name":"azrng","email":"itzhangyunpeng@163.com","commits":1}]},"readingTime":{"minutes":2.67,"words":802},"filePathRelative":"cloud/k8s/bushuwenjian.md","localizedDate":"2023年3月14日","excerpt":"<h2>概述</h2>\\n<p>使用yaml文件管理将容器部署到k8s的过程。</p>\\n<h2>操作</h2>\\n<h3>创建文件</h3>\\n<p>创建backend-deploy.yml文件并添加下面的内容</p>\\n<div class=\\"language-yaml\\" data-ext=\\"yml\\" data-title=\\"yml\\"><pre class=\\"language-yaml\\"><code><span class=\\"token punctuation\\">---</span>\\n<span class=\\"token key atrule\\">apiVersion</span><span class=\\"token punctuation\\">:</span> apps/v1\\n<span class=\\"token key atrule\\">kind</span><span class=\\"token punctuation\\">:</span> Deployment\\n<span class=\\"token key atrule\\">metadata</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> pizzabackend\\n<span class=\\"token key atrule\\">spec</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">replicas</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">1</span>\\n  <span class=\\"token key atrule\\">template</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">metadata</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token key atrule\\">labels</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token key atrule\\">app</span><span class=\\"token punctuation\\">:</span> pizzabackend\\n    <span class=\\"token key atrule\\">spec</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token key atrule\\">containers</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> pizzabackend\\n        <span class=\\"token key atrule\\">image</span><span class=\\"token punctuation\\">:</span> <span class=\\"token punctuation\\">[</span>YOUR DOCKER USER NAME<span class=\\"token punctuation\\">]</span>/pizzabackend<span class=\\"token punctuation\\">:</span>latest\\n        <span class=\\"token key atrule\\">ports</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">containerPort</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">80</span>\\n        <span class=\\"token key atrule\\">env</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> ASPNETCORE_URLS\\n          <span class=\\"token key atrule\\">value</span><span class=\\"token punctuation\\">:</span> http<span class=\\"token punctuation\\">:</span>//<span class=\\"token important\\">*:</span><span class=\\"token number\\">80</span>\\n  <span class=\\"token key atrule\\">selector</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">matchLabels</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token key atrule\\">app</span><span class=\\"token punctuation\\">:</span> pizzabackend\\n<span class=\\"token punctuation\\">---</span>\\n<span class=\\"token key atrule\\">apiVersion</span><span class=\\"token punctuation\\">:</span> v1\\n<span class=\\"token key atrule\\">kind</span><span class=\\"token punctuation\\">:</span> Service\\n<span class=\\"token key atrule\\">metadata</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> pizzabackend\\n<span class=\\"token key atrule\\">spec</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">type</span><span class=\\"token punctuation\\">:</span> ClusterIP\\n  <span class=\\"token key atrule\\">ports</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">80</span>\\n  <span class=\\"token key atrule\\">selector</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">app</span><span class=\\"token punctuation\\">:</span> pizzabackend\\n</code></pre></div>","autoDesc":true}');export{r as comp,d as data};
